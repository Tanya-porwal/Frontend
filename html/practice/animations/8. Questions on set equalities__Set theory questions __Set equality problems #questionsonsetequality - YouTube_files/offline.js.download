(function(g){var window=this;'use strict';var kCp=function(){kq.apply(this,arguments)},XFi=function(Z,I){return{id:Z,
channelId:I.channelId,title:I.title,avatar:I.thumbnail}},t6v=function(){kq.apply(this,arguments)},$KW=function(){kq.apply(this,arguments)},xK$=function(){var Z,I;
return g.h(function(d){if(d.L==1)return g.m(d,g.k_(),2);if(d.L!=3){Z=d.D;if(!Z)throw g.Pk("rvdfd");return g.m(d,g.rJ(Z),3)}I=d.D;return d.return(g.Xn(I,["index","media"],{mode:"readwrite",OU:!0},function(Y){var T={};return g.BT(Y.objectStore("index"),{},function(f){var P=f.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),O=g.WD.resolve(void 0);if(P){var a=P[1];P=P[2];T[a]=T[a]||{};var W;T[a][P]=g.aWD((W=f.getValue())==null?void 0:W.fmts)}else O=f.delete().then(function(){});
return g.WD.all([g.w1(f),O]).then(function(e){return g.t(e).next().value})}).then(function(){for(var f={},P=g.t(Object.keys(T)),O=P.next();!O.done;O=P.next()){O=O.value;
var a=T[O].v;f[O]=T[O].a&&a?1:2}var W=pFg(f);return g.igl(Y.objectStore("media"),{},function(e){var B=e.cursor.key.match(g.qgJ);B&&f[B[1]]||Y.objectStore("media").delete(e.cursor.key);return g.fjn(e)}).then(function(){return W})})}))})},KS$=function(){kq.apply(this,arguments)},C9p=function(){kq.apply(this,arguments)},EH0=function(Z,I){Z.L&&(Z.j=I,XQ(Z))},b73=function(){kq.apply(this,arguments)},H7d=function(){kq.apply(this,arguments)},cbE=function(Z,I){var d,Y;
return g.h(function(T){if(T.L==1)return g.m(T,g.k_(),2);if(T.L!=3){d=T.D;if(!d)throw g.Pk("wct");return g.m(T,g.rJ(d),3)}Y=T.D;return g.m(T,g.Xn(Y,["captions"],{mode:"readwrite",OU:!0},function(f){var P=[];f=f.objectStore("captions");for(var O=0;O<I.length;O++){var a=g.ti(f,I[O],Z+"|"+I[O].metadata.vss_id);P.push(a)}return g.WD.all(P)}),0)})},gHi=function(Z){var I=new g.vz("und",new g.PA("Default","und",!0));
I.captionTracks=Z.captionTracks;return I},M6t=function(){kq.apply(this,arguments)},rb3=function(){kq.apply(this,arguments)},Zcu=function(){this.actions=[]},dVg=function(Z,I){var d,Y;
return g.h(function(T){switch(T.L){case 1:return d=tP(I),g.ez(T,2),Y=g.VU(I.entityKey).entityId,Y==="!*$_ALL_ENTITIES_!*$"?g.m(T,$q(Z.L,I,Z.Z),5):g.m(T,pT(Y,Z.L,I,Z.Z),6);case 6:return g.m(T,Ift(Z.L,I.entityKey),5);case 5:g.gE(T,3);break;case 2:return g.Bj(T),T.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",d,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return T.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
d))}})},ofg=function(Z,I){return KT(Z,{mode:"readwrite",
OU:!0},function(d){return CT(d,I)})},YB3=function(){kq.apply(this,arguments)},jzE=function(){kq.apply(this,arguments)},P_g=function(Z,I){var d,Y,T,f,P,O,a,W,e,B,w,V,N,q,A,F;
return g.h(function(J){switch(J.L){case 1:return d=tP(I),Y=g.VU(I.entityKey),T=Y.entityId,f=[],g.ez(J,2),g.m(J,TLV(Z,T),4);case 4:f=J.D;if((P=f)==null||!P.length){J.xS(5);break}return g.m(J,icu(Z.L,I.entityKey),5);case 5:g.gE(J,3);break;case 2:return O=g.Bj(J),a="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",W="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O instanceof g.ox&&O.type==="QUOTA_EXCEEDED"&&(a="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",W="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
J.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",d,void 0,a,W));case 3:return e=[],g.m(J,fft(Z.L,"musicTrack",f),7);case 7:f=J.D;if(f.length)for(B=g.t(f),w=B.next();!w.done;w=B.next())if(V=w.value,N=V.offlineVideoData,q=void 0,(q=N)==null?0:q.videoId)A=void 0,F=Number(((A=I.actionMetadata)==null?void 0:A.priority)||0)+1,e.push(EP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",N.videoId,"musicTrack",F,bH,H5(I,N,T)));return J.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d,e))}})},
Qz$=function(Z,I){var d=[];
if(Z.thumbnailStyleData){Z=g.t(Z.thumbnailStyleData);for(var Y=Z.next();!Y.done;Y=Z.next()){var T=void 0,f=void 0,P=void 0;d=d.concat(c5((T=Y.value)==null?void 0:(f=T.value)==null?void 0:(P=f.collageThumbnail)==null?void 0:P.coverThumbnail))}}I=c5(I);return d.concat(I)},eo$=function(Z,I,d,Y,T){var f,P,O,a,W,e;
return g.h(function(B){switch(B.L){case 1:if(f=Y){B.xS(2);break}return g.m(B,OcL([I]),3);case 3:P=B.D,O=P[0],f=afi(O);case 2:return g.m(B,Wsg(Z,f,I,T,d),4);case 4:a=B.D;W=a.musicTrackEntity;e=a.Jr;var w=c5(W.thumbnailDetails),V=[];e&&(V=c5(e.thumbnailDetails));return g.m(B,gs(w.concat(V)),0)}})},Ms=function(Z){Z.L=void 0;
Z.B=void 0;Z.N.stop()},IF=function(Z,I,d,Y){var T;
return g.h(function(f){if(f.L==1){if(!Z.L)return rs(Z,"saveTransferState: "+I),f.return();Z.L.transferState=I;Z.L.failureReason=Y;g.ez(f,2);return g.m(f,BLE(Z,function(P){return d?ZP(P,"offlineVideoStreams",Z.L.offlineVideoStreams).then(function(O){for(var a=g.t(O),W=a.next();!W.done;W=a.next())if((W=W.value)&&W.streamsProgress){W=g.t(W.streamsProgress);for(var e=W.next();!e.done;e=W.next())e.value.streamState=d}return wRM(P,O.filter(function(B){return!!B}),"offlineVideoStreams")}):g.WD.resolve(void 0)}),
4)}if(f.L!=2)return g.gE(f,0);
T=g.Bj(f);return T instanceof g.ox&&T.type==="QUOTA_EXCEEDED"?g.m(f,Z.IM("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):f.xS(0)})},szg=function(Z,I,d){d=d===void 0?!1:d;
var Y,T,f,P,O,a,W,e,B,w,V,N,q,A,F;return g.h(function(J){switch(J.L){case 1:return Y=g.y(I.actionMetadata,VqM),T=g.VU(I.entityKey).entityId,f=g.Es(T,"downloadStatusEntity"),g.m(J,KT(Z.L,{mode:"readonly",OU:!0},function(v){var l=dT(v,f,"downloadStatusEntity");v=dT(v,g.Es(T,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.WD.all([l,v])}),2);
case 2:return P=J.D,O=g.t(P),a=O.next().value,W=O.next().value,e=a,B=W,w="TRANSFER_STATE_TRANSFER_IN_QUEUE",((V=e)==null?void 0:V.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(w="TRANSFER_STATE_PAUSED_BY_USER"),A={key:I.entityKey,transferState:w,cotn:g.LY(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(N=Y)==null?void 0:N.maximumDownloadQuality,preferredAudioTrack:(q=Y)==null?void 0:q.preferredAudioTrack,transferRetryCount:0,isRefresh:d,hasLoggedFirstStarted:!1},g.m(J,KT(Z.L,
{mode:"readwrite",OU:!0},function(v){var l=[];d&&l.push(CT(v,g.Es(T,"offlineVideoStreams")));l.push(oF(v,A,"transfer"));return g.WD.all(l)}),3);
case 3:if(!d){J.xS(4);break}return g.m(J,NLi(T),4);case 4:Fs0({videoId:T,bW:A,offlineModeType:(F=B)==null?void 0:F.offlineModeType}),g.v6(J)}})},nfp=function(){kq.apply(this,arguments)},hoL=function(){kq.apply(this,arguments)},mVg=function(){kq.apply(this,arguments)},Yd=function(Z,I){var d=g.Yz(I);
if(d===1||d===0)return Promise.resolve();(d=qBg(Z,I))&&d.stopVideo();Z.Z=0;return NLi(I)},SBW=function(){kq.apply(this,arguments)},ADv=function(){kq.apply(this,arguments)},DV3=function(){var Z,I,d,Y,T,f;
return g.h(function(P){switch(P.L){case 1:return g.m(P,ju(),2);case 2:Z=P.D;if(!Z)return P.return([]);I=Date.now()/1E3;return g.m(P,Tp(Z,"offlineVideoPolicy"),3);case 3:d=P.D,Y=g.t(d),T=Y.next();case 4:if(T.done){P.xS(6);break}f=T.value;if(!(f.expirationTimestamp&&Number(f.expirationTimestamp)<I)){P.xS(5);break}f.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";f.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.m(P,ih(Z,f,"offlineVideoPolicy"),5);
case 5:T=Y.next();P.xS(4);break;case 6:return P.return(d.map(function(O){return O.key}))}})},TLV=function(Z,I,d){var Y,T,f;
return g.h(function(P){switch(P.L){case 1:return g.m(P,JDt([I]),2);case 2:return Y=P.D,g.m(P,Rog(Z,Y[0],d),3);case 3:return T=P.D,f=c5(T.thumbnailDetails),g.m(P,gs(f),4);case 4:return P.return(Y[0].videos)}})},yDi=function(Z,I,d){I=I===void 0?43200:I;
d=d===void 0?!0:d;var Y=Y===void 0?!1:Y;var T,f;return g.h(function(P){switch(P.L){case 1:if(!Z.j.QQ())return P.return([]);T=[];g.ez(P,2);return g.m(P,Ls0(I,d,Y),4);case 4:T=P.D;g.gE(P,3);break;case 2:g.Bj(P);case 3:return f=UVv(Z,T,d,"musicPlaylist"),P.return(f)}})},vfi=function(Z,I){var d=Z.L.objectStore("EntityAssociationStore");
return d.index("byParentEntityKey").getAll(IDBKeyRange.only(I)).then(function(Y){var T=[];Y=g.t(Y);for(var f=Y.next();!f.done;f=Y.next())f=f.value,T.push(d.index("byChildEntityKey").getAll(f.childEntityKey));return g.WD.all(T)}).then(function(Y){var T=[];
Y=g.t(Y);for(var f=Y.next();!f.done;f=Y.next())f=f.value,f.length===1&&T.push(f[0].childEntityKey);return T})},lfW=function(){kq.apply(this,arguments)},fJ=function(Z,I){I=I===void 0?!1:I;
var d;return g.h(function(Y){if(Y.L==1){if(Z.L)throw Error("Already downloading a video");Z.LS=0;Z.X=!1;return g.m(Y,uqi(Z),2)}return Y.L!=4?(d=Y.D,GoM(Z.w4,!d),d&&Z.j.QQ()?I?g.m(Y,new Promise(function(T){g.lo(T,1E3)}),4):Y.xS(4):(!d&&Z.L&&Ms(Z),Y.xS(0))):g.m(Y,zot(Z,d),0)})},XRg=function(Z,I){var d,Y,T,f,P,O,a,W;
return g.h(function(e){switch(e.L){case 1:return d=g.Lh(),Y={context:g.p9(),videoPlaybackPositionEntities:Z,lastSyncTimestampUsec:I},T=g.R$(kou),g.ez(e,2),P={H0:!0},g.m(e,g.L9(d,Y,T,void 0,P),4);case 4:f=e.D;g.gE(e,3);break;case 2:O=g.Bj(e);if(O instanceof g.lX)throw a="VPPS network manager error: "+O.message,PL(a,O),Error(a);PL("VPPS fetch request error",O);throw Error("VPPS fetch request error");case 3:W=QM(f);if(f)W!==void 0&&O9(W,"position sync");else throw PL("Network request failed for position sync"),
Error("Network request failed for position sync");return e.return(f)}})},xVg=function(Z,I,d,Y){var T=tqi(Z.D,1);
return dT(Z,I,Y).then(function(f){if(f){f=g.pV(f,d);var P={key:I,entityType:Y,data:$VM(T,f,I),version:1};return g.WD.all([g.ti(Z.L.objectStore("EntityStore"),P),pRi(Z,f,Y)])}}).then(function(){aF(Z,I,Y);
return I})},KsL=function(){kq.apply(this,arguments)},C_$=function(){WL.apply(this,arguments);
this.In="mainVideoEntity"},eu=function(Z){this.token=Z},bcg=function(Z,I,d,Y){var T,f,P,O,a,W,e,B,w,V,N,q,A,F,J,v,l,X,H,x,Id,TB,dD,Qu,Zr,sJ,bL,TL,jt,yu;
return g.h(function(UJ){switch(UJ.L){case 1:return g.m(UJ,ju(),2);case 2:T=UJ.D;if(!T)return UJ.return([]);f=[];if((P=Y)==null?0:P.length){f=Y;UJ.xS(3);break}return g.m(UJ,Tp(T,"mainPlaylistEntity"),4);case 4:f=UJ.D;case 3:if(!f.length)return UJ.return([]);O=[];a=Date.now()/1E3;W=g.t(f);e=W.next();case 5:if(e.done)return O.length?g.m(UJ,EfV(O),10):UJ.return([]);B=e.value;if(!B.downloadState){w=void 0;UJ.xS(8);break}return g.m(UJ,BL(T,B.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:w=
UJ.D;case 8:V=w;N=void 0;A=(q=(N=B)==null?void 0:N.entityMetadata)&&q.nextAutoRefreshIntervalSeconds?Number(q.nextAutoRefreshIntervalSeconds):NaN;F=Number.isNaN(A)?Z:A;v=J=void 0;l=((J=V)==null?0:J.lastSyncedTimestampMillis)?Number((v=V)==null?void 0:v.lastSyncedTimestampMillis)/1E3:0;H=X=void 0;x=((X=V)==null?0:X.addedTimestampMillis)?Number((H=V)==null?void 0:H.addedTimestampMillis)/1E3:0;if(d||!q||l+F<=a){Id=[];TB=void 0;if((TB=B.videos)==null?0:TB.length)for(dD=g.t(B.videos),Qu=dD.next();!Qu.done;Qu=
dD.next())Zr=Qu.value,sJ=JSON.parse(g.VU(Zr).entityId),sJ.videoId&&Id.push(sJ.videoId);bL="0";q&&(TL=void 0,bL=String(Number((TL=q.offlineLastModifiedTimestampSeconds)!=null?TL:0).toFixed()));jt={playlistId:B.playlistId,videoIds:Id,offlineLastModifiedTimestamp:bL,autoSync:I,offlineDateAddedTimestamp:String(x.toFixed())};O.push(jt)}e=W.next();UJ.xS(5);break;case 10:return yu=UJ.D,UJ.return(yu)}})},cDV=function(Z){return Hci[Z.transferState]!==void 0},BLE=function(Z,I){var d;
return g.h(function(Y){if(!Z.L)return Y.return();d=Z.L;return g.m(Y,KT(Z.D,{mode:"readwrite",OU:!0},function(T){var f=[oF(T,d,"transfer")];I&&f.push(I(T));return g.WD.all(f)}),0)})},afi=function(Z){for(var I,d=g.t(Z.additionalMetadatas),Y=d.next();!Y.done;Y=d.next())Y=Y.value,Y.offlineMusicVideoData&&(I=Y.offlineMusicVideoData);
var T,f,P,O,a;return{id:g.Es(Z.videoId,"musicTrack"),videoId:Z.videoId,title:Z.title,thumbnailDetails:Z.thumbnail,lengthMs:String(Number(Z.lengthSeconds)*1E3),albumTitle:(T=I)==null?void 0:T.releaseTitle,musicVideoType:(f=I)==null?void 0:f.musicVideoType,contentRating:{explicitType:(P=I)==null?void 0:P.explicitType},artistNames:((O=I)==null?void 0:O.byline)||((a=I)==null?void 0:a.channelName),downloadMetadata:g.Es(Z.videoId,"musicTrackDownloadMetadataEntity")}},gfE=function(){kq.apply(this,arguments)},
wT=function(Z){this.L=Z},MqM=function(){kq.apply(this,arguments)},VM=function(Z,I,d,Y){d=d===void 0?!1:d;
Y=Y===void 0?!0:Y;I=typeof I==="string"?I:I.videoDetails.videoId;if(g.Yz(I)===2){var T=qBg(Z,I);T&&T.stopVideo();g.wN(I,2);Z.Z=2;d?rDE(Z.L):Y&&ZgM(Z.L)}},Ijg=function(){kq.apply(this,arguments)},dju=function(Z,I,d){if(d.has(I))return g.WD.resolve(void 0);
d.add(I);return vfi(Z,I).then(function(Y){return Z.L.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(I)).then(function(){return Y})}).then(function(Y){var T=g.WD.resolve(void 0);
Y=g.t(Y);for(var f=Y.next(),P={};!f.done;P={oi:void 0},f=Y.next())P.oi=f.value,T=T.then(function(O){return function(){return dju(Z,O.oi,d)}}(P));
return T}).then(function(){})},oVW=function(){N8.apply(this,arguments)},Y2g=function(){kq.apply(this,arguments)},jK$=function(){kq.apply(this,arguments)},fj0=function(Z,I){var d,Y,T,f,P,O,a,W,e,B,w,V,N;
return g.h(function(q){switch(q.L){case 1:return d=tP(I),Y=g.VU(I.entityKey),T=Y.entityId,f=g.y(I.actionMetadata,Tzu),g.ez(q,2),g.m(q,eo$(Z,T,void 0,(P=f)==null?void 0:P.track,(O=f)==null?void 0:O.albumRelease),4);case 4:if((a=f)==null?0:a.playlistId){q.xS(5);break}return g.m(q,icu(Z.L,I.entityKey),5);case 5:g.gE(q,3);break;case 2:return W=g.Bj(q),e="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",B="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",W instanceof g.ox&&W.type==="QUOTA_EXCEEDED"&&
(e="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",B="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),q.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",d,void 0,e,B));case 3:V=Number(((w=I.actionMetadata)==null?void 0:w.priority)||0)+1;var A=(A=g.y(I.actionMetadata,Tzu))?{playbackDataActionMetadata:{maximumDownloadQuality:A.maximumDownloadQuality}}:void 0;N=EP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",T,"playbackData",V,igi,A);return q.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
d,[N]))}})},QKp=function(Z){var I=Pxg[Z];
if(I)return I;g.uL(new g.Wj("Entity model not found.",{entityType:Z}))},OgW=function(){kq.apply(this,arguments)},ajM=function(){kq.apply(this,arguments)},W$d=function(){kq.apply(this,arguments)},Bzg=function(Z){var I;
return g.h(function(d){if(d.L==1)return g.m(d,eQd(Z),2);I=d.D;g.g6("offlineStateSnapshot",I);g.v6(d)})},wI$=function(){kq.apply(this,arguments)},kq=function(){N8.apply(this,arguments)},VLM=function(){kq.apply(this,arguments)},Nzu=function(){kq.apply(this,arguments)},QM=function(Z){var I;
return(I=Z.errorMetadata)==null?void 0:I.status},F$p=function(){kq.apply(this,arguments)},sKg=function(){kq.apply(this,arguments)},nVu=function(Z,I){return KT(Z,{mode:"readwrite",
OU:!0},function(d){return wRM(d,I,"offlineOrchestrationActionWrapperEntity")})},hQp=function(){N8.apply(this,arguments)},mji=function(){kq.apply(this,arguments)},DjW=function(Z){var I,d,Y,T,f,P,O;
return g.h(function(a){if(a.L==1)return g.m(a,q2v(Z),2);I=a.D;d=[];Y=g.t(I);for(T=Y.next();!T.done;T=Y.next())f=T.value,P=g.VU(f.key),O=P.entityId,S2L(Z.L,O)||d.push(f);return g.m(a,AOM(Z,d),0)})},JOV=function(Z){return new F$("WRONG_DATA_TYPE",{yj:Z})},L$W=function(Z,I){var d,Y,T;
return g.h(function(f){d=g.t(I);for(Y=d.next();!Y.done;Y=d.next()){T=Y.value;var P=void 0,O=void 0,a=((O=T.action)==null?void 0:(P=O.actionMetadata)==null?void 0:P.retryScheduleIntervalsInSeconds)||[1,2,4];P=1;T.retryScheduleIndex<a.length&&(P=a[T.retryScheduleIndex]);T.L=P*1E3+Date.now();T.retryScheduleIndex++}return g.m(f,RQt(Z,I),0)})},c5=function(Z){if(!Z||!Z.thumbnails)return[];
var I=[];Z=g.t(Z.thumbnails);for(var d=Z.next();!d.done;d=Z.next())d=d.value,d.url&&I.push(d.url);return I},vVW=function(Z,I,d,Y){var T,f,P,O,a,W,e,B,w,V,N,q,A;
return g.h(function(F){switch(F.L){case 1:d||(d=Date.now().toString());f=(T=I.channel)==null?void 0:T.offlineChannelData;P={id:g.Es(I.videoId,"ytMainChannelEntity"),channelId:f.channelId,title:f.title,avatar:f.thumbnail};O={key:g.Es(I.videoId,"mainVideoDownloadStateEntity"),playbackData:g.Es(I.videoId,"playbackData"),addedTimestampMillis:d,videoDownloadContextEntity:g.Es(I.videoId,"videoDownloadContextEntity")};a={key:g.Es(I.videoId,"videoPlaybackPositionEntity"),videoId:I.videoId,lastPlaybackPositionSeconds:"0"};
Z.U.Y("html5_offline_playback_position_sync")&&(W={playbackPosition:a.key});e=g.Es(I.videoId,"mainVideoEntity");B={key:e,videoId:I.videoId,title:I.title,thumbnail:I.thumbnail,localizedStrings:{viewCount:I.shortViewCountText},userState:W,lengthSeconds:I.lengthSeconds?Number(I.lengthSeconds):void 0,publishedTimestampMillis:I.publishedTimestamp?(Number(I.publishedTimestamp)*1E3).toString():void 0,formattedDescription:I.description,owner:P.id,downloadState:O.key};if(!Z.U.Y("woffle_enable_main_downloads_library")||
!Y){F.xS(2);break}return g.m(F,UjV(Z.L,[e]),3);case 3:if(N=F.D)w=N.mainDownloadsLibraryEntity,V=N.mainDownloadsListEntity;case 2:return A=yOE,q={key:g.Es(I.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.tQ(O,A,q),g.m(F,KT(Z.L,{mode:"readwrite",OU:!0},function(J){var v=oF(J,P,"ytMainChannelEntity"),l=oF(J,O,"mainVideoDownloadStateEntity"),X=oF(J,B,"mainVideoEntity");v=[v,l,X];Z.U.Y("html5_offline_playback_position_sync")&&(l=oF(J,a,"videoPlaybackPositionEntity"),
v.push(l));w&&(l=oF(J,w,"mainDownloadsLibraryEntity"),v.push(l));V&&(l=oF(J,V,"mainDownloadsListEntity"),v.push(l));q&&(J=oF(J,q,"downloadStatusEntity"),v.push(J));return g.WD.all(v)}),4);
case 4:return F.return({mainVideoEntity:B,channelEntity:P})}})},eQd=function(Z){var I,d,Y,T,f,P,O,a,W,e,B,w,V,N,q,A,F,J,v,l,X,H,x,Id,TB,dD,Qu,Zr,sJ,bL,TL,jt,yu,UJ,X0,Ag,vE,oS,Ci,iL;
return g.h(function(Rv){if(Rv.L==1)return g.m(Rv,KT(Z,{mode:"readonly",OU:!0},function(D){return ZP(D,"playbackData").then(function(M){var FH=M.map(function(cO){return cO.transfer}).filter(function(cO){return!!cO}),YC=M.map(function(cO){return cO.offlineVideoPolicy}).filter(function(cO){return!!cO}),U5=M.filter(function(cO){return!!cO.key}).map(function(cO){return g.Es(g.VU(cO.key).entityId,"downloadStatusEntity")});
FH=ZP(D,"transfer",FH);YC=ZP(D,"offlineVideoPolicy",YC);U5=ZP(D,"downloadStatusEntity",U5);var fU=FH.then(function(cO){cO=cO.reduce(function(rD,Ah){(Ah==null?0:Ah.offlineVideoStreams)&&rD.push.apply(rD,g.c(Ah.offlineVideoStreams));return rD},[]).filter(function(rD){return!!rD});
return ZP(D,"offlineVideoStreams",cO)});
return g.WD.all([FH,YC,fU,U5]).then(function(cO){var rD=g.t(cO);cO=rD.next().value;var Ah=rD.next().value;var R=rD.next().value;rD=rD.next().value;return[M,cO,Ah,R,rD]})})}),2);
if(Rv.L!=3)return I=Rv.D,g.m(Rv,KT(Z,{mode:"readonly",OU:!0},function(D){return ZP(D,"mainDownloadsListEntity").then(function(M){var FH,YC;return(YC=(FH=M[0])==null?void 0:FH.downloads)!=null?YC:[]})}),3);
d=Rv.D;Y=g.t(I);T=Y.next().value;f=Y.next().value;P=Y.next().value;O=Y.next().value;a=Y.next().value;W=T;e=f;B=P;w=O;V=a;N={};q={};A={};F={};J={};v=[];l=g.t(e);for(X=l.next();!X.done;X=l.next())(H=X.value)&&(N[H.key]=H);x=g.t(B);for(Id=x.next();!Id.done;Id=x.next())(TB=Id.value)&&(q[TB.key]=TB);dD=g.t(V);for(Qu=dD.next();!Qu.done;Qu=dD.next())(Zr=Qu.value)&&(A[Zr.key]=Zr);sJ=g.t(w);for(bL=sJ.next();!bL.done;bL=sJ.next())(TL=bL.value)&&(F[TL.key]=TL);jt=g.t(d);for(yu=jt.next();!yu.done;yu=jt.next())UJ=
yu.value,X0=void 0,J[(X0=UJ.videoItem)!=null?X0:""]=!0,UJ.videoItem&&(vE=Ag=void 0,oS=(vE=(Ag=g.VU(UJ.videoItem))==null?void 0:Ag.entityId)!=null?vE:"",v.push({externalVideoId:oS}));Ci=W.filter(function(D){if(!D||!D.key||!D.offlineVideoPolicy)return!1;D=g.VU(D.key).entityId;D=g.Es(D,"downloadStatusEntity");var M;return!(D&&((M=A[D])==null?void 0:M.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
iL=Ci.map(function(D){var M=N[D.transfer],FH=[];if(M==null?0:M.offlineVideoStreams)for(var YC=g.t(M.offlineVideoStreams),U5=YC.next();!U5.done;U5=YC.next())(U5=F[U5.value])&&FH.push(U5);YC=q[D.offlineVideoPolicy];U5=J;var fU=D==null?void 0:D.playerResponseTimestamp,cO=g.VU(YC.key).entityId;D=g.Es(cO,"mainVideoEntity");if(YC.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var rD="OFFLINE_VIDEO_STATE_DISABLED";YC.expirationTimestamp&&Number(YC.expirationTimestamp)<Date.now()/1E3&&(rD="OFFLINE_VIDEO_STATE_EXPIRED")}else if(YC.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")rD="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(M==null?void 0:M.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":rD="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":rD="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":rD="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":rD="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":rD="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":rD="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:rD="OFFLINE_VIDEO_STATE_UNKNOWN"}if(rD==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(M==null?void 0:M.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":rD="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":rD="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":rD=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}cO={id:cO,videoState:rD};if(M==null?0:M.cotn)cO.cotn=M.cotn;if(M==null?0:M.maximumDownloadQuality)cO.selectedVideoQuality=M==null?void 0:M.maximumDownloadQuality;if(M==null?0:M.lastProgressTimeMs)cO.lastProgressTimeMs=M.lastProgressTimeMs;fU&&(cO.playerResponseSavedTimeMs=String(Number(fU)*1E3));M=String;fU=0;FH=g.t(FH);for(rD=FH.next();!rD.done;rD=FH.next())if(rD=rD.value,rD.streamsProgress){rD=g.t(rD.streamsProgress);for(var Ah=rD.next();!Ah.done;Ah=rD.next()){var R=
void 0;fU+=Number((R=Ah.value.numBytesDownloaded)!=null?R:0)}}cO.downloadedBytes=M(fU);cO.selectedOfflineMode=U5[D]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";YC.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(cO.offlinePlaybackDisabledReason=YC.offlinePlaybackDisabledReason);return cO});
return Rv.return({offlineVideos:iL,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:v}}})})},lj0=function(Z){var I;
Z=g.y((I=Z.getWatchNextResponse())==null?void 0:I.currentVideoEndpoint,g.CI);if(Z==null?0:Z.playlistId)var d=Z.playlistId;return d},uOW=function(Z){if(Z==null?0:Z.streamsProgress){var I=0;
Z=Z.streamsProgress;for(var d=0;d<Z.length;d++){var Y=Z[d];isNaN(Number(Y.numBytesDownloaded))?PL("stream progress bytes number invalid"):I+=Number(Y.numBytesDownloaded)}return I}return 0},s9=function(Z,I){Z.api.Rn("onOfflineOperationFailure",I);
var d;(d=Z.L)==null||d.postMessage(I)},GRv=function(){kq.apply(this,arguments)},zQg=function(Z){return Z instanceof Error?new F$("UNKNOWN_DECODE_ERROR",{originalMessage:Z.message}):new F$("UNKNOWN_DECODE_ERROR")},kRg=function(Z,I){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:Z},metadata:I,statusCode:void 0,csn:void 0,can:void 0}},Rog=function(Z,I,d){var Y,T,f,P,O,a,W,e,B,w,V,N,q,A;
return g.h(function(F){if(F.L==1){Y=I.additionalMetadadatas;T=void 0;if(Y&&Y.length>0)for(f=g.t(Y),P=f.next();!P.done;P=f.next())if(O=P.value,O.offlineMusicPlaylistData){T=O.offlineMusicPlaylistData;break}a=I.playlistId;W=XIE(I);e=W.qq;B=W.WA;w=d?(Number(d)*1E3).toString():Date.now().toString();V=I.lastModifiedTimestamp?(Number(I.lastModifiedTimestamp)*1E3).toString():"0";N={id:g.Es(a,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:B,lastModifiedTimestampMillis:V,addedTimestampMillis:w,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};q={id:g.Es(a,"musicAlbumRelease"),title:I.title,audioPlaylistId:a,trackCount:I.totalVideoCount,tracks:e,downloadMetadata:N.id};T&&(q.thumbnailDetails=(A=T.albumHqThumbnail)!=null?A:T.albumArtistThumbnail,q.artistDisplayName=T.albumArtistDisplayName,q.releaseDate=T.albumReleaseDate,q.contentRating={explicitType:T.albumReleaseExplicitType},q.releaseType=T.albumReleaseType);return g.m(F,KT(Z.L,{mode:"readwrite",OU:!0},function(J){var v=oF(J,q,"musicAlbumRelease");
J=oF(J,N,"musicAlbumReleaseDownloadMetadataEntity");return g.WD.all([v,J])}),2)}return F.return(q)})},tLp=function(Z,I){this.api=Z;
this.L=I;this.logger=new g.qj("woffle");this.D=!1;this.A9={Jm:this.Jm}},$jE=function(){kq.apply(this,arguments)},pIW=function(Z,I){Z=g.t(Z.observers);
for(var d=Z.next();!d.done;d=Z.next())d=d.value,d(I)},K$d=function(Z,I){var d;
return g.h(function(Y){return I.length?(d=xjd(),g.tQ(d,nJ,{isEnqueuedForExpiredStreamUrlRefetch:!0}),Z.api.D1("qrd",{v:I.length}),Y.return(hc(Z,I,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",d))):Y.return([])})},mJ=function(Z){return Z.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!Z.entityKey},F$=function(Z,I){I=I===void 0?{}:I;
g.Wj.call(this,g.P3$[Z],Object.assign({},{name:"PESEncoderError",type:Z},I));this.type=Z;this.level="WARNING";Object.setPrototypeOf(this,F$.prototype)},CxM=function(){kq.apply(this,arguments)},EVL=function(Z,I){var d=Hci[Z.transferState],Y=Hci[I.transferState];
return d!==Y?d-Y:Number(Z.enqueuedTimestampMs)-Number(I.enqueuedTimestampMs)},bg3=function(){kq.apply(this,arguments)},HgE=function(){kq.apply(this,arguments)},cOV=function(Z){return g.Mm((0,g.fXW)(),Z)},MLL=function(Z,I,d,Y){var T,f,P,O,a,W,e;
return g.h(function(B){switch(B.L){case 1:return g.m(B,JDt([I]),2);case 2:return T=B.D,g.m(B,gV0(Z,T[0],d,Y),3);case 3:return f=B.D,P=f.mainPlaylistEntity,O=f.wbJ,W=Qz$(P,(a=O)==null?void 0:a.avatar),g.ez(B,4),g.m(B,gs(W),6);case 6:g.gE(B,5);break;case 4:e=g.Bj(B),e instanceof Error&&e.message==="Failed to fetch"&&PL(e.message);case 5:return B.return(T[0].videos)}})},rO0=function(){N8.apply(this,arguments)},Zui=function(){kq.apply(this,arguments)},pFg=function(Z){var I=g.X9();
I=Object.assign({},I);Z=Object.assign({},Z);for(var d in I)Z[d]?(I[d]!==4&&(I[d]=Z[d]),delete Z[d]):I[d]!==2&&(I[d]=4);Object.assign(I,Z);g.vou(I);JSON.stringify(I);return I},IkW=function(){var Z,I,d,Y,T;
return g.h(function(f){if(f.L==1)return g.m(f,ju(),2);if(f.L!=3)return(Z=f.D)?g.m(f,Tp(Z,"refresh"),3):f.return(!1);I=f.D;if((d=I[0])==null||!d.refreshTime)return f.return(!1);Y=Number(I[0].refreshTime);T=Date.now()/1E3;return f.return(isFinite(Y)&&T>=Y)})},oei=function(Z,I,d){var Y=d20(I);
d=QKp(d);if(!d)return g.WD.resolve([]);d=new d(I);Z=Z.L.objectStore("EntityAssociationStore");I=[];d=g.t(d.D());for(var T=d.next();!T.done;T=d.next())I.push(g.ti(Z,{parentEntityKey:Y,childEntityKey:T.value}));return g.WD.all(I).then(function(f){return f.map(function(P){return P[1]})})},q8=function(Z,I){var d=I.videoId;
var Y=I.bW;I=I.offlineModeType;Z.encryptedVideoId=d;Z.cotn=Y==null?void 0:Y.cotn;Z.offlineabilityFormatType=Y==null?void 0:Y.maximumDownloadQuality;var T;Z.isRefresh=(T=Y==null?void 0:Y.isRefresh)!=null?T:!1;var f;Z.softErrorCount=(f=Y==null?void 0:Y.transferRetryCount)!=null?f:0;Z.offlineModeType=I!=null?I:"OFFLINE_NOW";(Z.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&Z.statusType==="UNKNOWN_STATUS_TYPE"||!Z.transferStatusType&&!Z.statusType)&&g.uL(Error("Woffle unknown transfer status"));
g.g6("offlineTransferStatusChanged",Z)},Su=function(Z){g.p.call(this);
var I=this;this.api=Z;this.A9={tn4:function(){return I.L},
YK5:function(){return I.D}};
typeof g.iN.BroadcastChannel!=="undefined"&&(this.L=new g.iN.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.U0()),this.L.onmessage=this.Z.bind(this),this.D=new g.iN.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.U0()),this.D.onmessage=this.N.bind(this))},Y0t=function(Z,I,d){var Y=this;
this.X=Z;this.In=I;this.visibility=d;this.B=this.V=this.j=this.Z=this.L=!1;this.N=new g.uX(function(){Y.f7()});
this.A9={Yt:function(){return Y.D},
f7:function(){Y.f7()},
waJ:function(){return Y.N}};
this.visibility.subscribe("visibilitystatechange",function(){Y.XQ()})},PL=function(Z,I,d){g.uL(new g.Wj("Woffle: "+Z,d?{cotn:d}:""));
I instanceof Error&&g.uL(I)},j_t=function(){kq.apply(this,arguments)},Pgp=function(Z,I,d){var Y,T;
g.h(function(f){switch(f.L){case 1:if(!Z.L)return rs(Z,"onTransferProgress: "+I),f.return();if(Z.L.transferState==="TRANSFER_STATE_TRANSFERRING"){f.xS(2);break}return g.m(f,TMv(Z),2);case 2:Y=Date.now();if(!(Y-Z.fS>1E3)){f.xS(4);break}Z.fS=Y;return g.m(f,iuL(Z.D,d.videoId,d.D,d.VR,d.bytesDownloaded,d.L),5);case 5:if(Z.In&&!(Z.In&&Y-Z.LS>Z.sZ)){f.xS(4);break}Z.LS=Y;return g.m(f,Ac(Z,I),7);case 7:T=f.D,fkV({videoId:I,bW:Z.L,offlineModeType:T},d.bytesDownloaded,d.L);case 4:Z.N.start(108E5),g.v6(f)}})},
Q_$=function(){},aku=function(Z){var I=Z.L.actions[0];
return Z.N?((I==null?void 0:I.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&Z.N[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Z.B=!0),Promise.resolve()):Ouu(Z)},WKV=function(){kq.apply(this,arguments)},GoM=function(Z,I){Z.L&&(Z.V=I,XQ(Z))},Fs0=function(Z){q8({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},Z)},eRE=function(){kq.apply(this,arguments)},wv0=function(Z,I){var d,Y,T,f,P,O,a,W,e,B,w,V;
return g.h(function(N){switch(N.L){case 1:return d=tP(I),g.m(N,Tp(Z.L,"videoPlaybackPositionEntity"),2);case 2:Y=N.D;if(Y.length===0)return N.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d));g.ez(N,3);return g.m(N,eu.getInstance(),5);case 5:T=N.D;if(!T)throw Error("prefStorage is undefined");return g.m(N,T.get("psi"),6);case 6:return f=N.D,a=(O=(P=f)==null?void 0:P.VY)!=null?O:"0",g.m(N,XRg(Y,a),7);case 7:return W=N.D,e={isPaused:W.watchHistoryPaused,VY:W.syncTimestampUsec},g.m(N,T.set("psi",
e),8);case 8:if(e.isPaused){N.xS(9);break}B=g.y(W.frameworkUpdates,DP);if(!W.frameworkUpdates||!B){N.xS(9);break}return g.m(N,BME(B),9);case 9:g.gE(N,4);break;case 3:return w=g.Bj(N),V="PPE handleRefresh error: "+(w instanceof Error?w.message:"unknown error"),PL(V),N.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",d,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return N.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
d))}})},tqi=function(Z,I){I=I===void 0?0:I;
Z=Z.L[I];if(!Z)throw I=new F$("INVALID_ENCODER_VERSION",{yj:I}),g.nl(I),I;return Z},VkV=function(){kq.apply(this,arguments)},NMt=function(){kq.apply(this,arguments)},FKv=function(){kq.apply(this,arguments)},neg=function(Z){var I;
return g.h(function(d){return d.L==1?g.m(d,ju(),2):(I=d.D)?g.m(d,KT(I,"readwrite",function(Y){for(var T={},f=g.t(Z),P=f.next(),O={};!P.done;O={lw:void 0,bX:void 0},P=f.next())O.lw=P.value,O.lw.entityKey&&s_W(O.lw)&&(O.bX=g.Hx(O.lw.payload),P=void 0,O.lw.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(P=function(a){return function(){return oF(Y,a.lw.payload[a.bX],a.bX)}}(O)),O.lw.type==="ENTITY_MUTATION_TYPE_DELETE"&&(P=function(a){return function(){return CT(Y,a.lw.entityKey)}}(O)),O.lw.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(P=function(a){return function(){return xVg(Y,a.lw.entityKey,a.lw.payload[a.bX],a.bX)}}(O)),P&&(T[O.lw.entityKey]=T[O.lw.entityKey]?T[O.lw.entityKey].then(P):P()));
return g.WD.all(Object.values(T))}),0):d.return()})},hRd=function(){kq.apply(this,arguments)},m23=function(){kq.apply(this,arguments)},q0L=function(){kq.apply(this,arguments)},XIE=function(Z){var I=Z.videos;
Z=[];var d=[];if(I){I=g.t(I);for(var Y=I.next();!Y.done;Y=I.next()){var T=Y.value.offlineVideoData.videoId;Y=g.Es(T,"musicTrack");T=g.Es(T,"musicTrackDownloadMetadataEntity");Z.push(Y);d.push(T)}}return{qq:Z,WA:d}},S0V=function(Z,I,d){this.L=Z;
this.U=I;this.Z=d},AyE=function(){kq.apply(this,arguments)},LKt=function(Z,I){var d={offlineOrchestrationContext:D2E(Z)};
I=kRg(I,d);Jy3(RRu(),I,Z.rootActionId)},U23=function(){kq.apply(this,arguments)},yyp=function(Z){return Z.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!Z.entityKey},ve3=function(){N8.apply(this,arguments)},TMv=function(Z){var I,d,Y;
return g.h(function(T){if(T.L==1){if(!Z.L)return rs(Z,"onTransferStart"),T.return();Z.N.start(108E5);return g.m(T,IF(Z,"TRANSFER_STATE_TRANSFERRING"),2)}I=Z.L;return(Y=((d=I)==null?0:d.key)?g.VU(I.key).entityId:"")&&Z.Z?g.m(T,Jc(Y,Z.Z,Z.D,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):T.xS(0)})},lkW=function(){kq.apply(this,arguments)},H5=function(Z,I,d){I={track:afi(I)};
d&&(I.playlistId=d);if(Z=g.y(Z.actionMetadata,uWu))I.maximumDownloadQuality=Z.maximumDownloadQuality;return{musicTrackEntityActionMetadata:I}},GY$=function(Z,I){var d,Y,T,f;
return g.h(function(P){if(P.L==1){d=I.clientPlaybackNonce;Y={cpn:d,offlineSourceVisualElement:g.p0(I.kS||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};I.D&&(Y.videoFmt=Number(I.D.itag));I.N&&(Y.audioFmt=Number(I.N.itag));if((T=lj0(I))&&I.videoId){var O=I.videoId;O=T!=="PPSV"?Promise.resolve(!1):Z.L.dk(O);P=g.m(P,O,3)}else P=P.xS(2);return P}P.L!=2&&(f=P.D)&&(Y.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");Z.D=d;g.g6("offlinePlaybackStarted",Y);g.v6(P)})},zRW=function(Z,
I){var d,Y,T,f,P;
return g.h(function(O){if(O.L==1)return d=g.VU(I.key),Y=d.entityId,T=g.Es(Y,"playbackData"),g.m(O,BL(Z.D,T,"playbackData"),2);f=O.D;if((P=f)==null?0:P.playerResponseJson)return O.return(JSON.parse(f.playerResponseJson));throw Error("No PlayerResponse found");})},$2g=function(Z,I){var d,Y,T,f;
return g.h(function(P){switch(P.L){case 1:return d=tP(I),g.ez(P,2),Y=g.VU(I.entityKey).entityId,Y==="!*$_ALL_ENTITIES_!*$"?g.m(P,kYd(Z.L,I,Z.Z,(T=I.actionMetadata)==null?void 0:(f=T.offlineLoggingData)==null?void 0:f.offlineDeleteReason),5):g.m(P,XvM(Y,Z.L,I,Z.Z),6);case 6:if(!Z.U.Y("woffle_enable_main_downloads_library")){P.xS(5);break}return g.m(P,tk$(Z.L,I.entityKey),5);case 5:g.gE(P,3);break;case 2:return g.Bj(P),P.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",d,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return P.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d))}})},JDt=function(Z){var I,d,Y,T,f,P,O,a;
return g.h(function(W){switch(W.L){case 1:return I=g.Lh(),d=pv3(Z),Y=g.R$(x2V),g.ez(W,2),f={H0:!0},g.m(W,g.L9(I,d,Y,void 0,f),4);case 4:T=W.D;g.gE(W,3);break;case 2:P=g.Bj(W);if(P instanceof g.lX)throw O="GetOffline network manager error for playlist: "+P.message,PL(O,P),Error(O);PL("GetOffline fetch request error for playlist",P);throw Error("GetOffline fetch request error for playlist");case 3:a=QM(T);if(!T)throw PL("Network request failed for playlist"),Error("Network request failed for playlist");
if(a!==void 0)O9(a,"playlist");else if(!T.playlists||!T.playlists.length)throw PL("No data for playlist"),Error("No data for playlist");return W.return(T.playlists.map(function(e){return e.offlinePlaylistData}))}})},BME=function(Z){var I;
return g.h(function(d){if(d.L==1){I=Z.mutations;if(!I||I.length<=0)return d.return();if(g.KG){var Y={type:"ENTITY_LOADED"};I!==void 0&&(Y.payload=I);g.KG.dispatch(Y)}return g.m(d,neg(I),2)}I.length=0;g.v6(d)})},kYd=function(Z,I,d,Y){var T,f,P,O,a,W,e,B,w;
return g.h(function(V){if(V.L==1)return T=g.Es("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),f=new Map,g.m(V,KT(Z,{mode:"readwrite",OU:!0},function(N){var q=ZP(N,"transfer"),A=ZP(N,"offlineOrchestrationActionWrapperEntity"),F=ZP(N,"videoDownloadContextEntity"),J=dT(N,T,"mainDownloadsListEntity");return g.WD.all([q,A,F,J]).then(function(v){v=g.t(v);var l=v.next().value;var X=v.next().value;var H=v.next().value;var x=v.next().value;v=KKi.map(function(TB){return Cgi(N,TB)});
X=g.t(X);for(var Id=X.next();!Id.done;Id=X.next())Id=Id.value,RF(I,Id.actionProto)||v.push(CT(N,Id.key,{jh:!0}));x&&(x.downloads=[],v.push(oF(N,x,"mainDownloadsListEntity")));if(H)for(H=g.t(H),x=H.next();!x.done;x=H.next())x=x.value,X=g.VU(x.key).entityId,X=g.Es(X,"transfer"),f.set(X,x.offlineModeType);return g.WD.all(v).then(function(){return l})})}),2);
P=V.D;O=g.t(P);for(a=O.next();!a.done;a=O.next())W=a.value,LJ(W,f.get(W.key)),e=g.VU(W.key).entityId,B={videoId:e,offlineDeleteReason:Y,cotn:W.cotn,offlineModeType:f.get(W.key)},U9(B),w=g.Es(e,"mainVideoEntity"),s9(d,{entityKey:w,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.m(V,Eeg(),0)})},bud=function(){kq.apply(this,arguments)},HuL=function(Z,I){var d,Y,T,f,P,O,a,W;
return g.h(function(e){d=c5(Z.thumbnailDetails);Y=g.t(I);for(T=Y.next();!T.done;T=Y.next())if(f=T.value,f.id!==Z.id)for(P=g.t(c5(f.thumbnailDetails)),O=P.next();!O.done;O=P.next())a=O.value,W=d.indexOf(a),W!==-1&&d.splice(W,1);return e.return(d)})},Eeg=function(){var Z;
return g.h(function(I){return I.L==1?g.m(I,cyE(),2):(Z=I.D)?I.return(Z.delete("yt-player-local-img")):I.return(!0)})},ge0=function(Z,I,d){I=I===void 0?43200:I;
d=d===void 0?!0:d;var Y=Y===void 0?!1:Y;var T,f,P;return g.h(function(O){switch(O.L){case 1:if(!Z.j.QQ())return O.return([]);T=[];g.ez(O,2);return g.m(O,bcg(I,d,Y),4);case 4:T=O.D;g.gE(O,3);break;case 2:f=g.Bj(O),f instanceof Error&&f.message==="No data"||f instanceof Error&&f.message==="Empty response body"&&PL(f.message);case 3:return P=UVv(Z,T,d,"mainPlaylistEntity"),O.return(P)}})},OcL=function(Z){var I,d,Y,T,f,P,O,a;
return g.h(function(W){switch(W.L){case 1:return I=g.Lh(),d=MkM(Z),Y=g.R$(x2V),g.ez(W,2),f={H0:!0},g.m(W,g.L9(I,d,Y,void 0,f),4);case 4:T=W.D;g.gE(W,3);break;case 2:P=g.Bj(W);if(P instanceof g.lX)throw O="GetOffline network manager error: "+P.message,PL(O,P),Error(O);PL("GetOffline fetch request error",P);throw Error("GetOffline fetch request error");case 3:a=QM(T);if(!T)throw PL("Network request failed"),Error("Network request failed");if(a!==void 0)O9(a);else if(!T.videos||!T.videos.length)throw PL("No data"),
Error("No data");return W.return(T.videos.map(function(e){return e.offlineVideoData}))}})},ZP=function(Z,I,d){return d?(d=d.map(function(Y){return dT(Z,Y,I)}),g.WD.all(d)):Z.L.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(I)).then(function(Y){return Y.map(function(T){return ryv(Z,T)})})},yM=function(Z){return{key:g.Es(Z.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:Z.action,parentActionId:Z.parentActionId,rootActionId:Z.rootActionId,childActionIds:Z.childActionIds,prereqActionId:Z.prereqActionId,postreqActionIds:Z.postreqActionIds,retryScheduleIndex:Z.retryScheduleIndex,hasChildActionFailed:Z.hasChildActionFailed,enqueueTimeSec:(Z.L/1E3).toFixed()}},Ift=function(Z,I){var d,Y,T,f,P,O,a;
return g.h(function(W){if(W.L==1)return d=g.Es("music_downloads_library_id","musicDownloadsLibraryEntity"),g.m(W,BL(Z,d,"musicDownloadsLibraryEntity"),2);Y=W.D;if(!Y)return W.xS(0);T=g.VU(I).entityType;T==="musicTrack"?f=Y.downloadedTracks:T==="musicPlaylist"&&(f=Y.downloadedPlaylists);if((P=f)==null?0:P.length)for(O=0;O<f.length;O++)if(a=f[O],a===I){f.splice(O,1);break}return g.m(W,ih(Z,Y,"musicDownloadsLibraryEntity"),0)})},o6V=function(Z){var I,d,Y,T,f;
g.h(function(P){switch(P.L){case 1:if(!Z.L)return rs(Z,"onTransferComplete"),P.return();I=Z.L;Z.N.stop();if(!I||!Z.B){P.xS(2);break}d=ZA0(Z.api.C(),I.cotn,Z.B);return g.m(P,Inv(Z,d),2);case 2:return g.m(P,IF(Z,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:T=((Y=I)==null?0:Y.key)?g.VU(I.key).entityId:"";if(!T||!Z.Z){P.xS(5);break}return g.m(P,Jc(T,Z.Z,Z.D,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.m(P,dDL(Z.D,T),7);case 7:return g.m(P,Ac(Z,T),8);case 8:f=P.D,q8({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:T,bW:I,offlineModeType:f}),Ms(Z),fJ(Z),g.v6(P)}})},Y73=function(){kq.apply(this,arguments)},jDW=function(){kq.apply(this,arguments)},ryv=function(Z,I){a:{Z=tqi(Z.D,I.version);
try{var d=Z.D(I.data,I.key);break a}catch(Y){Tn3(Y,zQg)}d=void 0}return d},iAV=function(){kq.apply(this,arguments)},QDg=function(Z,I){var d,Y,T,f,P,O,a,W,e,B,w,V,N;
return g.h(function(q){switch(q.L){case 1:return d=tP(I),Y=g.VU(I.entityKey),T=Y.entityId,f=g.y(I.actionMetadata,vL),O=!((P=f)==null?0:P.playlistId),g.ez(q,2),g.m(q,fnd(Z,T,void 0,(a=f)==null?void 0:a.offlineVideoData,O),4);case 4:g.gE(q,3);break;case 2:return W=g.Bj(q),e="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",B="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",W instanceof g.ox&&W.type==="QUOTA_EXCEEDED"&&(e="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",B="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
q.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",d,void 0,e,B));case 3:w=1;w=Number(((V=I.actionMetadata)==null?void 0:V.priority)||0)+1;var A=(A=g.y(I.actionMetadata,vL))?{playbackDataActionMetadata:{maximumDownloadQuality:A.maximumDownloadQuality}}:void 0;N=EP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",T,"playbackData",w,Prg,A);return q.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d,[N]))}})},an3=function(Z){var I;
return g.h(function(d){switch(d.L){case 1:if(!Z.D)return PL("transferManager is undefined"),d.return();if(Z.D.L){d.xS(2);break}return g.m(d,fJ(Z.D),2);case 2:if(!Z.U.Y("woffle_enable_main_downloads_library")){d.xS(4);break}return g.m(d,Z.aP(),4);case 4:if(!Z.U.Y("html5_offline_playback_position_sync")){d.xS(6);break}return g.m(d,Z.sJ(),7);case 7:return g.m(d,Z.LI(864E5),6);case 6:return g.m(d,Z.refreshAllStaleEntities(43200,!0),9);case 9:return g.m(d,Z.QG(),10);case 10:if(!Z.U.Y("html5_retry_downloads_for_expiration")){d.xS(11);
break}return g.m(d,Z.wg(),11);case 11:return Z.X=g.ly(function(){Z.refreshAllStaleEntities(43200,!0);Z.QG()},9E5),g.Zb(g.zF(),function(){return Z.o3()}),g.m(d,ju(),13);
case 13:return I=d.D,g.m(d,Bzg(I),14);case 14:OAd(Z.Z),g.v6(d)}})},pT=function(Z,I,d,Y,T){var f,P,O,a,W,e,B,w,V,N,q,A,F,J,v,l,X,H,x,Id;
return g.h(function(TB){switch(TB.L){case 1:return f=g.Es(Z,"musicTrack"),P=g.Es(Z,"transfer"),g.m(TB,KT(I,{mode:"readonly",OU:!0},function(dD){return g.WD.all([dT(dD,f,"musicTrack"),dT(dD,P,"transfer"),ZP(dD,"musicTrack"),ZP(dD,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:O=TB.D;a=g.t(O);W=a.next().value;e=a.next().value;B=a.next().value;w=a.next().value;V=W;N=e;q=B;A=w;if(!V){TB.xS(3);break}return g.m(TB,HuL(V,q),4);case 4:return F=TB.D,g.m(TB,lh(F),3);case 3:J=[];v=g.t(A);for(l=v.next();!l.done;l=v.next())X=l.value,H=g.VU(X.key).entityId,x=uh(X),Id=g.VU(x.action.entityKey).entityId,H!==Z&&Id!==Z||RF(d,X.actionProto)||J.push(X.key);return g.m(TB,KT(I,{mode:"readwrite",OU:!0},function(dD){var Qu=J.map(function(Zr){return CT(dD,Zr)});
Qu.push(CT(dD,f,{jh:!0}));return g.WD.all(Qu)}),6);
case 6:LJ(N),T&&U9(T),s9(Y,{entityKey:f,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.v6(TB)}})},wRM=function(Z,I,d){I=I.map(function(Y){return oF(Z,Y,d)});
return g.WD.all(I)},fft=function(Z,I,d){d=d===void 0?[]:d;
var Y,T,f,P,O,a,W,e,B,w,V,N,q;return g.h(function(A){if(A.L==1)return d.length?g.m(A,Tp(Z,I),2):A.return([]);Y=A.D;T=new Set;f=g.t(Y);for(P=f.next();!P.done;P=f.next())if(O=P.value,a=O.id||O.key)W=g.VU(a).entityId,T.add(W);e=[];B=g.t(d);for(w=B.next();!w.done;w=B.next())V=w.value,N=V.offlineVideoData,q=void 0,((q=N)==null?0:q.videoId)&&!T.has(N.videoId)&&e.push(V);return A.return(e)})},WDv=function(){kq.apply(this,arguments)},BnW=function(){var Z,I,d;
return g.h(function(Y){if(Y.L==1)return g.ez(Y,2),g.m(Y,g.k_(),4);if(Y.L!=2){Z=Y.D;if(!Z||!g.sc()||typeof g.iN.BroadcastChannel==="undefined")return Y.return();I=new eDL;return Y.return(new Gp(Z,I))}d=g.Bj(Y);d instanceof Error&&g.nl(d);return Y.return()})},wrg=function(){kq.apply(this,arguments)},V8g=function(){kq.apply(this,arguments)},gs=function(Z){var I,d;
return g.h(function(Y){if(Y.L==1)return g.m(Y,cyE(),2);if(Y.L!=3){I=Y.D;if(!I)throw Error("Cache API not supported");return Z.length?g.m(Y,I.open("yt-player-local-img"),3):Y.return()}d=Y.D;return g.m(Y,d.addAll(Z),0)})},Nng=function(){this.locks=navigator.locks},FDL=function(Z){return{context:g.p9(),
offlinePlaylistSyncChecks:Z}},sDg=function(){kq.apply(this,arguments)},n60=function(Z){var I,d,Y;
return g.h(function(T){if(T.L==1)return I=IDBKeyRange.bound(Z+"|",Z+"~"),g.m(T,g.k_(),2);if(T.L!=3){d=T.D;if(!d)throw g.Pk("gactfv");return g.m(T,g.rJ(d),3)}Y=T.D;return T.return(Y.getAll("captions",I))})},S7d=function(Z,I){var d,Y,T,f,P,O,a,W,e;
return g.h(function(B){switch(B.L){case 1:return d=I.entityKey,T=(Y=g.y(I.actionMetadata,nJ))==null?void 0:Y.isEnqueuedForExpiredStreamUrlRefetch,g.ez(B,2),f=void 0,g.m(B,hD$(Z,I),4);case 4:f=B.D;g.ez(B,5);var w=(w=g.y(I.actionMetadata,nJ))?{maximumDownloadQuality:w.maximumDownloadQuality}:void 0;return g.m(B,mD0(d,Z.U,{isEnqueuedForExpiredStreamUrlRefetch:T,Ma:w,offlineSourceData:f}),7);case 7:P=B.D;g.gE(B,6,2);break;case 5:return g.Bj(B,2),O=tP(I)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",PL("PDE handleAdd error"),B.return(zp(I,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",O,"DOWNLOAD_STATE_FAILED"));case 6:return g.m(B,q7L(Z,P,I),8);case 8:return B.return(zp(I,!0,P.orchestrationActions));case 2:return a=g.Bj(B),W="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",a instanceof g.ox&&a.type==="QUOTA_EXCEEDED"&&(W="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
e="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),PL("PDE handleAdd error"),B.return(zp(I,!1,void 0,W,e,"DOWNLOAD_STATE_FAILED"))}})},UVv=function(Z,I,d,Y){var T,f,P,O,a,W,e,B;
return g.h(function(w){switch(w.L){case 1:T=[],f=g.t(I),P=f.next();case 2:if(P.done){w.xS(4);break}O=P.value;if(O.upToDate||d&&!O.shouldAutoSyncMetadata||!O.playlistId){w.xS(3);break}a={};switch(Y){case "mainPlaylistEntity":W={nextAutoRefreshIntervalSeconds:O.checkInSeconds,autoSync:d};a={mainPlaylistEntityActionMetadata:W};break;case "musicPlaylist":e={autoSync:d},a={musicPlaylistEntityActionMetadata:e}}return g.m(w,hc(Z,[O.playlistId],Y,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",a),6);case 6:(B=
w.D)&&T.push.apply(T,g.c(B));case 3:P=f.next();w.xS(2);break;case 4:return w.return(T)}})},DDE=function(Z){var I;
if((I=Z.onResponseReceivedActions)!=null&&I.length){var d;Z=(d=g.y(g.y(Z.onResponseReceivedActions[0],A6d),g.iLp))==null?void 0:d.actions;if(Z!=null&&Z.length)return Z}},RDd=function(Z,I){var d,Y,T,f,P,O,a,W,e,B,w,V,N,q,A,F;
return g.h(function(J){switch(J.L){case 1:return d=tP(I),Y=g.VU(I.entityKey),T=Y.entityId,f=[],g.ez(J,2),g.m(J,J6u(Z,T),4);case 4:f=J.D;if((P=f)==null||!P.length){J.xS(5);break}return g.m(J,icu(Z.L,I.entityKey),5);case 5:g.gE(J,3);break;case 2:return O=g.Bj(J),a="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",W="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O instanceof g.ox&&O.type==="QUOTA_EXCEEDED"&&(a="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",W="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
J.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",d,void 0,a,W));case 3:return e=[],g.m(J,fft(Z.L,"musicTrack",f),7);case 7:f=J.D;if(f.length)for(B=g.t(f),w=B.next();!w.done;w=B.next())if(V=w.value,N=V.offlineVideoData,q=void 0,(q=N)==null?0:q.videoId)A=void 0,F=Number(((A=I.actionMetadata)==null?void 0:A.priority)||0)+1,e.push(EP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",N.videoId,"musicTrack",F,kd,H5(I,N,T)));return J.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d,e))}})},
LDE=function(Z,I){var d,Y;
return g.h(function(T){switch(T.L){case 1:return d=tP(I),g.ez(T,2),Y=g.VU(I.entityKey).entityId,Y==="!*$_ALL_ENTITIES_!*$"?g.m(T,$q(Z.L,I,Z.Z),5):g.m(T,X$(Y,"musicPlaylist",Z.L,I,Z.Z),6);case 6:return g.m(T,Ift(Z.L,I.entityKey),5);case 5:g.gE(T,3);break;case 2:return g.Bj(T),T.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",d,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return T.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
d))}})},Tn3=function(Z,I){Z=Z instanceof F$?Z:I(Z);
g.nl(Z);throw Z;},tc=function(Z){g.p.call(this);
this.L=Z;this.D=this.L.observe(this.Z.bind(this))},UDW=function(){kq.apply(this,arguments)},tP=function(Z){var I,d,Y;
return((Y=(I=Z.actionMetadata)==null?void 0:(d=I.retryScheduleIntervalsInSeconds)==null?void 0:d.length)!=null?Y:0)>0},y6E=function(){kq.apply(this,arguments)},XvM=function(Z,I,d,Y){var T,f,P,O,a,W,e,B,w,V,N,q,A,F,J,v,l,X,H,x,Id,TB,dD,Qu,Zr,sJ,bL,TL,jt,yu,UJ,X0,Ag,vE,oS,Ci,iL,Rv,D,M,FH,YC,U5,fU,cO,rD,Ah,R,S,L;
return g.h(function(u){switch(u.L){case 1:return T=g.Es(Z,"mainPlaylistEntity"),f=g.Es(Z,"ytMainChannelEntity"),g.m(u,KT(I,{mode:"readonly",OU:!0},function(E){return g.WD.all([dT(E,T,"mainPlaylistEntity"),dT(E,f,"ytMainChannelEntity"),ZP(E,"mainPlaylistEntity"),ZP(E,"mainDownloadsListEntity"),ZP(E,"ytMainChannelEntity"),ZP(E,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:P=u.D;O=g.t(P);a=O.next().value;W=O.next().value;e=O.next().value;B=O.next().value;w=O.next().value;V=O.next().value;N=a;q=W;A=e;F=B;J=w;v=V;if(!N&&!q){u.xS(3);break}l=N?Qz$(N):[];if(!q){X=[];u.xS(4);break}return g.m(u,v6g(q,J),5);case 5:X=u.D;case 4:return H=X,g.m(u,lh(l.concat(H)),3);case 3:x=[];Id=new Map;if(!N){u.xS(7);break}return g.m(u,lni(N,A,F),8);case 8:x=u.D;TB=g.t(x);for(dD=TB.next();!dD.done;dD=TB.next())Qu=dD.value,Id.set(Qu,{videoId:Qu,playlistId:Z,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.m(u,KT(I,{mode:"readonly",OU:!0},function(E){return g.WD.all([ZP(E,"transfer"),ZP(E,"videoDownloadContextEntity")])}),9);
case 9:Zr=u.D;sJ=g.t(Zr);bL=sJ.next().value;TL=sJ.next().value;jt=bL;yu=TL;UJ=g.t(jt);for(X0=UJ.next();!X0.done;X0=UJ.next())Ag=X0.value,vE=g.VU(Ag.key).entityId,(oS=Id.get(vE))&&Ag&&(oS.cotn=Ag.cotn);Ci=g.t(yu);for(iL=Ci.next();!iL.done;iL=Ci.next())Rv=iL.value,D=g.VU(Rv.key).entityId,(M=Id.get(D))&&Rv&&(M.offlineModeType=Rv.offlineModeType);case 7:FH=[];YC=g.t(v);for(U5=YC.next();!U5.done;U5=YC.next())fU=U5.value,cO=g.VU(fU.key).entityId,rD=uh(fU),cO!==Z&&rD.rootActionId!==Z||RF(d,fU.actionProto)||
FH.push(fU.key);Ah=g.Es(Z,"mainPlaylistEntity");return g.m(u,KT(I,{mode:"readwrite",OU:!0},function(E){var fl=FH.map(function(K){return CT(E,K)});
fl.push(CT(E,Ah,{jh:!0}));return g.WD.all(fl)}),10);
case 10:if(!N){u.xS(0);break}x.reverse();if(!x){u.xS(0);break}R=g.t(x);S=R.next();case 13:if(S.done){u.xS(0);break}L=S.value;return g.m(u,$d(L,I,d,Y,Id.get(L)),14);case 14:S=R.next(),u.xS(13)}})},uPu=function(){N8.apply(this,arguments)},GKi=function(Z){var I;
return g.h(function(d){if(d.L==1)return g.m(d,Tp(Z.D,"offlineOrchestrationActionWrapperEntity"),2);I=d.D;return g.m(d,AOM(Z,I),0)})},zDE=function(){kq.apply(this,arguments)},kKp=function(Z,I){var d,Y;
return g.h(function(T){switch(T.L){case 1:return d=tP(I),g.m(T,BL(Z.L,I.entityKey,"transfer"),2);case 2:Y=T.D;if(!Y||Y.transferState!=="TRANSFER_STATE_COMPLETE")return T.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d));g.ez(T,3);return g.m(T,szg(Z,I,!0),5);case 5:g.gE(T,4);break;case 3:return g.Bj(T),T.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",d,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return T.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d))}})},Xrv=function(Z){Z=(new TextEncoder).encode(Z).subarray(0,16);
var I=new Uint8Array(16);I.set(Z);return I},d20=function(Z){Z=Z.key||Z.id;
if(!Z)throw Error("Entity key is missing");return Z},N8=function(Z){this.L=Z},t80=function(){kq.apply(this,arguments)},$D$=function(Z,I){this.L=Z;
this.U=I},prt=function(){kq.apply(this,arguments)},pv3=function(Z){return{context:g.p9(),
playlistIds:Z}},KD$=function(Z,I){I=I===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":I;
var d,Y,T,f;return g.h(function(P){if(P.L==1)return Z.L||rs(Z,"setTransferToFailed: "+I),d="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",I==="TRANSFER_FAILURE_REASON_NETWORK"?d="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":I==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(d="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.m(P,IF(Z,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",I),2);if(P.L!=3)return s9(Z.kS,{entityKey:(Y=Z.L)==null?void 0:Y.key,failureReason:d}),
T=Z.L?g.VU(Z.L.key).entityId:"",g.m(P,Ac(Z,T),3);f=P.D;var O={videoId:T,bW:Z.L,offlineModeType:f},a=I,W={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};a&&(W.transferFailureReason=a,W.failureReason=xDE(a));q8(W,O);g.v6(P)})},$VM=function(Z,I,d){try{return Z.Z(I,d)}catch(Y){Tn3(Y,CrL)}},pJ=function(Z){return Z.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!Z.entityKey},bAv=function(Z){return g.h(function(I){if(I.L==1)I=g.m(I,xK$(),2);
else{var d=Z.Bj;var Y=g.X9();Y=Object.keys(Y);d=E6g(d,Y);I=g.m(I,d,0)}return I})},Jc=function(Z,I,d,Y,T){T=T===void 0?!1:T;
var f,P,O,a,W,e;return g.h(function(B){if(B.L==1)return f=g.Es(Z,I),P=g.Es(Z,"downloadStatusEntity"),g.m(B,KT(d,{mode:"readonly",OU:!0},function(w){return g.WD.all([dT(w,f,I),dT(w,P,"downloadStatusEntity")])}),2);
O=B.D;a=O.length?O[0]:void 0;if(!a)return B.xS(0);W=yOE;if(e=O.length>1?O[1]:void 0){if(e.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!T)return B.return();e.downloadState=Y}else e={key:P,downloadState:Y};g.tQ(a,W,e);return g.m(B,KT(d,{mode:"readwrite",OU:!0},function(w){return g.WD.all([oF(w,a,I),oF(w,e,"downloadStatusEntity")])}),0)})},HAi=function(){kq.apply(this,arguments)},c6E=function(Z){return KT(Z,{mode:"readwrite",
OU:!0},function(I){return Cgi(I,"videoPlaybackPositionEntity")})},g6t=function(){kq.apply(this,arguments)},Tp=function(Z,I,d){return KT(Z,{mode:"readonly",
OU:!0},function(Y){return ZP(Y,I,d)})},XQ=function(Z){Z.V&&Z.j&&Z.B&&Z.visibility.isBackground()?g.Zy(Z.N,6E4):Z.N.stop()},M8V=function(Z){q8({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},Z)},r6V=function(){kq.apply(this,arguments)},Gp=function(Z,I){g.p.call(this);
this.token=Z;this.L=I;this.observers=[];Z=new g.iN.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.U0());Z.onmessage=this.D.bind(this);this.channel=Z},ZtE=function(Z){return g.h(function(I){Z.api.Rn("onOrchestrationBecameLeader");
return g.m(I,Z.ST(),0)})},UjV=function(Z,I){var d,Y,T,f,P,O,a,W,e,B,w,V,N,q,A,F,J,v;
return g.h(function(l){if(l.L==1)return d=g.Es("main_downloads_library_id","mainDownloadsLibraryEntity"),Y=g.Es("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.m(l,KT(Z,{mode:"readonly",OU:!0},function(X){return g.WD.all([dT(X,d,"mainDownloadsLibraryEntity"),dT(X,Y,"mainDownloadsListEntity")])}),2);
T=l.D;f=g.t(T);P=f.next().value;O=f.next().value;a=P;W=O;a||(a={id:d});e=g.t(I);for(B=e.next();!B.done;B=e.next())if(w=B.value,w===g.zN){if(a.smartDownloadsList)return l.return();a.smartDownloadsList=w}else if(V=g.VU(w).entityType,N={},V==="mainPlaylistEntity"?N.playlistItem=w:V==="mainVideoEntity"&&(N.videoItem=w),!g.xG(N)){q=void 0;if((q=W)==null?0:q.downloads){A=!1;F=g.t(W.downloads);for(J=F.next();!J.done;J=F.next())if(v=J.value,v.playlistItem===w||v.videoItem===w){A=!0;break}A||W.downloads.push(N)}else W=
{id:Y,downloads:[N]};a.downloadsList=Y}return l.return({mainDownloadsLibraryEntity:a,mainDownloadsListEntity:W})})},Ac=function(Z,I){var d,Y,T;
return g.h(function(f){if(f.L==1)return g.m(f,BL(Z.D,g.Es(I,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);d=f.D;return f.return((T=(Y=d)==null?void 0:Y.offlineModeType)!=null?T:void 0)})},IL3=function(Z){var I=[],d=Z.videos;
d&&d.length>0&&I.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:d[0].offlineVideoData.thumbnail}}});if((Z=Z.additionalMetadadatas)&&Z.length>0)for(Z=g.t(Z),d=Z.next();!d.done;d=Z.next()){var Y=d.value.offlineBundleItemPlaylistData,T=void 0;d=(T=Y)==null?void 0:T.style;T=void 0;Y={collageThumbnail:{coverThumbnail:(T=Y)==null?void 0:T.coverThumbnail}};switch(d){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":I.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:Y});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":I.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:Y});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":I.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:Y});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":I.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:Y})}}return I},dRd=function(Z,I,d,Y){if(Z&&Z.streamsProgress){Y=Z;
a:{I=I.itag+";"+I.xtags;for(var T=Z.streamsProgress,f=0;f<T.length;f++){var P=JSON.parse(T[f].formatStreamBytes);if(P.itag+";"+P.xtags===I){T[f]=d;d=T;break a}}T.push(d);d=T}Y.streamsProgress=d}else Z={key:Y,streamsProgress:[d]};return Z},o0g=function(Z,I){return Z!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||I?Z==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&I?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":Z:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},
Y4v=function(){},jC0=function(){kq.apply(this,arguments)},T5d=function(){kq.apply(this,arguments)},itp=function(Z,I){this.L=Z;
this.Z=I},fLM=function(){this.L=new Map},AOM=function(Z,I){var d,Y,T,f,P,O,a,W,e,B,w,V;
return g.h(function(N){d=[];Y=Infinity;T=4E3;f=g.t(I);for(P=f.next();!P.done;P=f.next())O=P.value,a=Number(O.enqueueTimeSec),W=PfW(a),e=O.retryScheduleIndex,B=e!=null&&e>0,W>0&&B?(Y=Math.min(Y,a),T=Math.min(W,T)):d.push(O);isFinite(Y)&&(!Z.Z.isActive()||Y<Z.X)&&(Z.X=Y,Z.Z.start(T));Z.j.QQ()||(w=d.length,d=d.filter(function(q){var A;q=((A=q.actionProto)==null?void 0:A.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!QC3.includes(q)}),V=d.length<w,!Z.Z.isActive()&&V&&Z.Z.start(1));
d.length>0&&Ot3(Z,d);return g.m(N,aku(Z),0)})},WL=function(Z,I){var d=this;
this.U=Z;this.api=I;this.j=new g.HU;this.B=new g.f2;this.A9={Yt:function(){return d.Z.A9.Yt()},
Ti:function(){return d.j},
z$J:function(){return d.Z},
ZK:function(){return d.ZK()},
ST:function(){return d.ST()},
Yg:function(){return d.Yg()},
o3:function(){return d.o3()},
wg:function(){return d.wg()},
LI:function(Y){return d.LI(Y)}};
this.Z=new Y0t(function(){return ZtE(d)},function(){d.Yg()},this.api.f6(),this.api.Y.bind(this.api));
this.L=new Su(this.api);aLg(this.Z)},WUE=function(Z,I){this.L=Z;
this.Z=I},LJ=function(Z,I){if(Z&&Z.transferState!=="TRANSFER_STATE_COMPLETE"&&Z.transferState!=="TRANSFER_STATE_FAILED"){var d=g.VU(Z.key).entityId;
q8({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:d,bW:Z,offlineModeType:I})}},E6g=function(Z,I){var d,Y,T,f,P,O,a;
return g.h(function(W){switch(W.L){case 1:if(I.length===0)return W.return([]);d=I.map(function(e){return g.Es(e,"transfer")});
return g.m(W,Tp(Z.L,"transfer",d),2);case 2:Y=W.D;T=Y.filter(eki).map(function(e){return g.VU(e.key).entityId});
f=I.filter(function(e){return T.indexOf(e)===-1});
if(f.length===0)return W.return([]);P=g.t(f);O=P.next();case 3:if(O.done){W.xS(5);break}a=O.value;return g.m(W,NLi(a),4);case 4:O=P.next();W.xS(3);break;case 5:return W.return(f)}})},lni=function(Z,I,d){var Y,T,f,P,O,a,W,e,B,w,V,N,q,A,F,J,v,l,X,H,x,Id,TB;
return g.h(function(dD){Y=[];T=new Set;if(d.length)for(f=g.t(d),P=f.next();!P.done;P=f.next())if(O=P.value,a=void 0,(a=O.downloads)==null?0:a.length)for(W=g.t(O.downloads),e=W.next();!e.done;e=W.next())B=e.value,B.videoItem&&(w=g.VU(B.videoItem).entityId,T.add(w));if(Z.videos){V=g.t(Z.videos);for(N=V.next();!N.done;N=V.next())q=N.value,A=JSON.parse(g.VU(q).entityId),A.videoId&&!T.has(A.videoId)&&Y.push(A.videoId);F=g.t(I);for(J=F.next();!J.done;J=F.next())if(v=J.value,v.key!==Z.key&&(l=v.videos))for(X=
g.t(l),H=X.next();!H.done;H=X.next())x=H.value,Id=JSON.parse(g.VU(x).entityId),Id.videoId&&(TB=Y.indexOf(Id.videoId),TB!==-1&&Y.splice(TB,1))}return dD.return(Y)})},VKu=function(Z,I){var d,Y,T,f,P,O,a,W,e,B,w,V,N,q,A,F,J;
return g.h(function(v){switch(v.L){case 1:return d=tP(I),Y=g.VU(I.entityKey),T=Y.entityId,f=[],g.ez(v,2),g.m(v,MLL(Z,T),4);case 4:f=v.D;if(!(Z.U.Y("woffle_enable_main_downloads_library")&&((P=f)==null?0:P.length))){v.xS(5);break}return g.m(v,B5g(Z.L,[I.entityKey]),5);case 5:g.gE(v,3);break;case 2:return O=g.Bj(v),a="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",W="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O instanceof g.ox&&O.type==="QUOTA_EXCEEDED"?(a="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
W="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):PL("Playlist add error"),v.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",d,void 0,a,W));case 3:e=[];if(!Z.U.Y("html5_offline_prevent_redownload_downloaded_video")){v.xS(7);break}return g.m(v,fft(Z.L,"mainVideoEntity",f),8);case 8:f=v.D;case 7:if((B=f)==null?0:B.length)for(w=g.t(f),V=w.next();!V.done;V=w.next())if(N=V.value,q=N.offlineVideoData,A=void 0,(A=q)==null?0:A.videoId)F=void 0,J=Number(((F=I.actionMetadata)==null?void 0:F.priority)||
0)+1,e.push(EP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",q.videoId,"mainVideoEntity",J,xd,w7u(I,q,T)));return v.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d,e))}})},N5v=function(Z,I){var d,Y,T,f;
return g.h(function(P){d=I.videoId;Y=!0;if(I.captionTracks.length)T=gHi(I),Z.L=new g.k$(Z.Wj,I,T);else if(I.kF)f=g.sOa(I),Z.L=new g.kQ(Z.Wj,I.kF,d,f,I.kM,I.eventId),Y=I.kM;else return P.return();return P.return(new Promise(function(O){var a;(a=Z.L)==null||a.wW({GD:function(){return g.h(function(W){if(W.L==1)return g.m(W,Z.GD(d,Y),2);O();g.v6(W)})},
Eg:function(){}})}))})},zp=function(Z,I,d,Y,T,f){return new xq(I?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",tP(Z),d,Y,T,f)},FUd=function(Z,I){this.L=Z;
this.Z=I},eDL=function(){this.L={};
this.L[0]=new KJ;if(!g.x9("aes_pes_encoder_killswitch")){var Z=this.L;try{var I=g.U0();var d=Xrv(I);var Y=new wT(new g.Ry(d),new g.OJ(d))}catch(T){throw Z=T instanceof Error?new F$("KEY_CREATION_FAILED",{originalMessage:T.message}):new F$("KEY_CREATION_FAILED"),g.nl(Z),Z;}Z[1]=Y}},aF=function(Z,I,d){var Y=Z.Z[d];
Y||(Y=new Set,Z.Z[d]=Y);Y.add(I)},sC0=function(){kq.apply(this,arguments)},J6u=function(Z,I,d,Y){var T,f,P;
return g.h(function(O){switch(O.L){case 1:return g.m(O,JDt([I]),2);case 2:return T=O.D,g.m(O,n0p(Z,T[0],d,Y),3);case 3:return f=O.D,P=c5(f.thumbnailDetails),g.m(O,gs(P),4);case 4:return O.return(T[0].videos)}})},RRu=function(){hkW||(hkW=new fLM);
return hkW},mRu=function(Z){var I,d,Y;
return g.h(function(T){if(T.L==1)return Z?g.m(T,BL(Z,g.zN,"mainDownloadsListEntity"),2):T.return([]);I=T.D;return((d=I)==null?0:(Y=d.downloads)==null?0:Y.length)?T.return(I.downloads.map(function(f){var P;return(P=f.videoItem)!=null?P:""})):T.return([])})},gV0=function(Z,I,d,Y){var T,f,P,O,a,W,e,B,w,V,N,q,A,F,J,v,l;
return g.h(function(X){switch(X.L){case 1:T=Date.now().toString();d||(d=T);f=I.videos;P=I.playlistId;O=[];a=[];if(f)for(W=g.t(f),e=W.next();!e.done;e=W.next()){B=e.value;w=B.offlineVideoData;if(!w||!w.videoId)throw PL("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");V=w.videoId;N={videoId:V,playlistId:P};q={id:g.Es(JSON.stringify(N),"mainPlaylistVideoEntity"),video:g.Es(V,"mainVideoEntity")};O.push(q);a.push(q.id)}F={key:g.Es(P,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:d,lastSyncedTimestampMillis:T};J={key:g.Es(P,"mainPlaylistEntity"),playlistId:P,videos:a,title:I.title,thumbnailStyleData:IL3(I),visibility:q4u(I),downloadState:F.key};I.channel&&(v=I.channel.offlineChannelData,A=XFi(g.Es(P,"ytMainChannelEntity"),v),J.channelOwner=A.id);((l=J)==null?0:l.entityMetadata)?(J.entityMetadata.offlineLastModifiedTimestampSeconds=I.lastModifiedTimestamp,Y&&(J.entityMetadata.nextAutoRefreshIntervalSeconds=String(Y))):J&&(J.entityMetadata={nextAutoRefreshIntervalSeconds:Y?
String(Y):void 0,offlineLastModifiedTimestampSeconds:I.lastModifiedTimestamp});g.ez(X,2);return g.m(X,KT(Z.L,{mode:"readwrite",OU:!0},function(H){var x=oF(H,J,"mainPlaylistEntity"),Id=oF(H,F,"mainPlaylistDownloadStateEntity");x=[x,Id];Id=g.t(O);for(var TB=Id.next();!TB.done;TB=Id.next())x.push(oF(H,TB.value,"mainPlaylistVideoEntity"));A&&x.push(oF(H,A,"ytMainChannelEntity"));return g.WD.all(x)}),4);
case 4:g.gE(X,3);break;case 2:throw g.Bj(X),PL("PES failure for playlist"),Error("PES failure for playlist");case 3:return X.return({mainPlaylistEntity:J,wbJ:A,rf5:O})}})},hD$=function(Z,I){var d,Y,T,f;
return g.h(function(P){if(P.L==1)return d=g.VU(I.entityKey).entityId,Y=g.Es(d,"videoDownloadContextEntity"),g.m(P,BL(Z.L,Y,"videoDownloadContextEntity"),2);T=P.D;return(f=T)!=null&&f.offlineModeType?P.return({offlineModeType:T.offlineModeType}):P.return(void 0)})},s_W=function(Z){var I;
Z=(I=Z.options)==null?void 0:I.persistenceOption;return Z==="ENTITY_PERSISTENCE_OPTION_PERSIST"||Z==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},uh=function(Z){if(!Z.key)throw Error("Entity key is required.");
if(!Z.actionProto)throw Error("OfflineOrchestrationAction is required.");var I=g.VU(Z.key),d=g.VU(Z.actionProto.entityKey);return new CJ(d.entityType,I.entityId,Z.actionProto,Z.parentActionId,Z.rootActionId,Z.childActionIds,Z.prereqActionId,Z.postreqActionIds,Z.retryScheduleIndex,Z.hasChildActionFailed,Number(Z.enqueueTimeSec)*1E3)},S4v=function(){kq.apply(this,arguments)},RkE=function(Z,I){var d,Y,T,f,P,O,a,W,e,B,w,V,N,q,A,F,J,v,l,X,H,x,Id,TB,dD,Qu,Zr;
return g.h(function(sJ){switch(sJ.L){case 1:return d=tP(I),Y=[],g.m(sJ,eu.getInstance(),2);case 2:T=sJ.D;if(!T){sJ.xS(3);break}return g.m(sJ,T.get("sdois"),4);case 4:return f=sJ.D,g.m(sJ,(O=T)==null?void 0:O.get("lmqf"),5);case 5:P=sJ.D;case 3:g.ez(sJ,6);if(f===void 0)throw Error("prefStorage or opt-in state is undefined");a=[];if(f){sJ.xS(8);break}return g.m(sJ,mRu(Z.L),9);case 9:a=sJ.D,a.reverse();case 8:if(!a.length){sJ.xS(10);break}W=g.t(a);e=W.next();case 11:if(e.done){sJ.xS(10);break}B=e.value;
if(!B){sJ.xS(12);break}w=g.VU(B).entityId;return g.m(sJ,E9(Z.L,w),14);case 14:return V=sJ.D,V.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.m(sJ,$d(w,Z.L,{entityKey:B,actionType:I.actionType},Z.Z,V),12);case 12:e=W.next();sJ.xS(11);break;case 10:return g.m(sJ,Aei(f,(N=P)!=null?N:"SD"),16);case 16:return q=sJ.D,g.m(sJ,DRE(q),17);case 17:A=DDE(q);if(!Z.U.Y("woffle_enable_main_downloads_library")){sJ.xS(18);break}if(f){sJ.xS(19);break}return g.m(sJ,tk$(Z.L,g.zN),19);case 19:return g.m(sJ,
B5g(Z.L,[g.zN]),18);case 18:if((F=A)==null?0:F.length)for(J=g.t(A),v=J.next();!v.done;v=J.next())if(X=l=v.value,H=X.actionType,x=X.entityKey,Id=X.actionMetadata,H&&x&&Id&&!g.y(Id,Je$)){H==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Id.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(TB=g.y(l.actionMetadata,vL))TB.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",l.actionMetadata=Object.assign({},l.actionMetadata,{mainVideoEntityActionMetadata:TB});Y.push(l)}g.gE(sJ,
7);break;case 6:return dD=g.Bj(sJ),Qu="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Zr="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",dD instanceof g.ox&&dD.type==="QUOTA_EXCEEDED"&&(Qu="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Zr="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),sJ.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",d,void 0,Qu,Zr));case 7:return sJ.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d,Y))}})},xjd=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},LUu=function(Z){var I;
return g.h(function(d){if(d.L==1)return g.m(d,g.b4l(Z),2);I=d.D;return d.return(I.filter(function(Y){return!!Y.url}).map(function(Y){return Y.url}))})},lh=function(Z){var I,d;
return g.h(function(Y){if(Y.L==1)return g.m(Y,cyE(),2);if(Y.L!=3){I=Y.D;if(!I)throw Error("Cache API not supported");return Z.length?g.m(Y,I.open("yt-player-local-img"),3):Y.return()}d=Y.D;return g.m(Y,Promise.all(Z.map(function(T){return d.delete(T)})),0)})},ZgM=function(Z){var I,d,Y;
g.h(function(T){if(T.L==1){if(!Z.L)return rs(Z,"onTransferPausedByNetwork"),T.return();Z.N.stop();return g.m(T,IF(Z,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(T.L!=3)return I=Z.L,(Y=((d=I)==null?0:d.key)?g.VU(I.key).entityId:"")&&Z.Z?g.m(T,Jc(Y,Z.Z,Z.D,"DOWNLOAD_STATE_PAUSED"),3):T.xS(3);Ms(Z);g.v6(T)})},CJ=function(Z,I,d,Y,T,f,P,O,a,W,e){this.entityType=Z;
this.actionId=I;this.action=d;this.parentActionId=Y;this.rootActionId=T===void 0?I:T;this.childActionIds=f;this.prereqActionId=P;this.postreqActionIds=O;this.hasChildActionFailed=W;this.retryScheduleIndex=0;this.L=e||Date.now();this.retryScheduleIndex=a||0},URE=function(){kq.apply(this,arguments)},EP=function(Z,I,d,Y,T,f){I=g.Es(I,d);
Y=Object.assign({},f,{priority:Y,retryScheduleIntervalsInSeconds:T});return{actionType:Z,entityKey:I,actionMetadata:Y}},ju=function(){yeg||(yeg=BnW());
return yeg},v0$=function(){kq.apply(this,arguments)},rDE=function(Z){var I,d,Y,T;
g.h(function(f){switch(f.L){case 1:if(!Z.L){rs(Z,"onTransferPausedByUser");f.xS(2);break}I=Z.L;Z.N.stop();return g.m(f,IF(Z,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:Y=((d=I)==null?0:d.key)?g.VU(I.key).entityId:"";if(!Y||!Z.Z){f.xS(4);break}return g.m(f,Jc(Y,Z.Z,Z.D,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.m(f,Ac(Z,Y),6);case 6:T=f.D,lL0({videoId:Y,bW:I,offlineModeType:T});case 2:Ms(Z),fJ(Z),g.v6(f)}})},n0p=function(Z,I,d,Y){var T,f,P,O,a,W,e,B,w;
return g.h(function(V){return V.L==1?(T=I.playlistId,f=XIE(I),P=f.qq,O=f.WA,a=d?(Number(d)*1E3).toString():Date.now().toString(),W=I.lastModifiedTimestamp?(Number(I.lastModifiedTimestamp)*1E3).toString():"0",e={id:g.Es(T,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:O,lastModifiedTimestampMillis:W,addedTimestampMillis:a,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},B={id:g.Es(T,"musicPlaylist"),title:I.title,playlistId:T,thumbnailDetails:I.thumbnail,visibility:uZL(I),trackCount:I.totalVideoCount,
tracks:P,downloadMetadata:e.id},Y&&(((w=B)==null?0:w.entityMetadata)?B.entityMetadata.nextAutoRefreshIntervalSeconds=String(Y):B&&(B.entityMetadata={nextAutoRefreshIntervalSeconds:String(Y)})),g.m(V,KT(Z.L,{mode:"readwrite",OU:!0},function(N){var q=oF(N,B,"musicPlaylist");N=oF(N,e,"musicPlaylistDownloadMetadataEntity");return g.WD.all([q,N])}),2)):V.return(B)})},Gxi=function(Z,I){var d,Y,T,f,P,O,a,W,e,B,w,V,N,q,A,F,J,v,l,X,H,x,Id,TB,dD,Qu,Zr,sJ,bL,TL,jt,yu,UJ,X0,Ag,vE,oS,Ci,iL,Rv,D,M,FH,YC,U5,fU,
cO,rD,Ah,R,S,L,u,E,fl,K,od,G,S$;
return g.h(function(vO){switch(vO.L){case 1:return d=tP(I),Y=I.entityKey,T=g.VU(Y).entityId,f=[],P=!1,T==="!*$_ALL_ENTITIES_!*$"?(P=!0,g.m(vO,Tp(Z.L,"musicAlbumRelease"),5)):g.m(vO,BL(Z.L,Y,"musicAlbumRelease"),4);case 4:(O=vO.D)&&f.push(O);vO.xS(3);break;case 5:f=vO.D;case 3:if((a=f)==null||!a.length)return vO.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d));if(P){W=[];e=g.t(f);for(B=e.next();!B.done;B=e.next())w=B.value,V=g.VU(w.id).entityId,W.push(EP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
V,"musicAlbumRelease",0,bH));return vO.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d,W))}N=[];q=f[0];A=void 0;if(!q.downloadMetadata){vO.xS(6);break}return g.m(vO,BL(Z.L,q.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:F=vO.D,A=Number((v=(J=F)==null?void 0:J.addedTimestampMillis)!=null?v:"0")/1E3;case 6:return g.ez(vO,8),g.m(vO,TLV(Z,T,(l=A)==null?void 0:l.toString()),10);case 10:N=vO.D;g.gE(vO,9);break;case 8:X=g.Bj(vO);if(!(X instanceof Error&&X.message===
"No data")){if(X instanceof Error&&X.message==="Empty response body")PL(X.message);else return H="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.ox&&X.type==="QUOTA_EXCEEDED"&&(H="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),vO.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",d,void 0,H,x));vO.xS(9);break}return g.m(vO,X$(T,"musicAlbumRelease",Z.L,
I,Z.Z),9);case 9:Id=[];TB=new Map;if((dD=N)==null?0:dD.length)for(Qu=g.t(N),Zr=Qu.next();!Zr.done;Zr=Qu.next())sJ=Zr.value,bL=sJ.offlineVideoData,TL=void 0,((TL=bL)==null?0:TL.videoId)&&TB.set(bL.videoId,bL);jt=new Map;yu=[];if((UJ=q)==null?0:(X0=UJ.tracks)==null?0:X0.length)for(Ag=g.t(q.tracks),vE=Ag.next();!vE.done;vE=Ag.next())if(oS=vE.value,Ci=g.VU(oS).entityId)TB.has(Ci)?(jt.set(Ci,TB.get(Ci)),TB.delete(Ci)):yu.push(Ci);Rv=Number(((iL=I.actionMetadata)==null?void 0:iL.priority)||0)+1;D=g.t(TB.entries());
for(M=D.next();!M.done;M=D.next())FH=M.value,YC=g.t(FH),U5=YC.next().value,fU=YC.next().value,cO=U5,rD=fU,Id.push(EP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",cO,"musicTrack",Rv,bH,H5(I,rD)));Ah=g.t(jt.entries());for(R=Ah.next();!R.done;R=Ah.next())S=R.value,L=g.t(S),u=L.next().value,E=L.next().value,fl=u,K=E,Id.push(EP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",fl,"musicTrack",Rv,bH,H5(I,K)));od=g.t(yu);for(G=od.next();!G.done;G=od.next())S$=G.value,Id.push(EP("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
S$,"musicTrack",0,bH));return vO.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d,Id))}})},oF=function(Z,I,d){var Y=d20(I),T=tqi(Z.D,1),f=Object.assign({},I);
return Z.L.objectStore("EntityStore").get(Y).then(function(P){if(P){if(P.entityType!==d)throw Error("Incorrect entity type");f.entityMetadata||(P=ryv(Z,P),f.entityMetadata=P.entityMetadata)}}).then(function(){var P={key:Y,
entityType:d,data:$VM(T,f,Y),version:1};return g.WD.all([g.ti(Z.L.objectStore("EntityStore"),P),pRi(Z,f,d)])}).then(function(){aF(Z,Y,d);
return Y})},lL0=function(Z){q8({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},Z)},kx0=function(Z,I){var d,Y,T,f,P,O,a,W,e,B,w,V,N,q,A,F,J,v,l,X,H,x,Id,TB,dD,Qu,Zr,sJ,bL,TL,jt,yu,UJ,X0,Ag,vE,oS,Ci,iL,Rv,D,M,FH,YC,U5,fU,cO,rD,Ah,R,S,L,u,E,fl,K,od,G,S$,vO,Fn,Rd,k9,Dr,pU,cl,Zh,Ll,bN,lL,mg,$9,hY,q3;
return g.h(function(gu){switch(gu.L){case 1:return d=tP(I),Y=I.entityKey,T=g.VU(Y).entityId,f=[],P=!1,T==="!*$_ALL_ENTITIES_!*$"?(P=!0,g.m(gu,Tp(Z.L,"mainPlaylistEntity"),5)):g.m(gu,BL(Z.L,Y,"mainPlaylistEntity"),4);case 4:(O=gu.D)&&f.push(O);gu.xS(3);break;case 5:f=gu.D;case 3:if((a=f)==null||!a.length)return gu.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d));W=g.y(I.actionMetadata,zkt);B=(e=W)==null?void 0:e.nextAutoRefreshIntervalSeconds;V=(w=W)==null?void 0:w.autoSync;N=[];A=q=
!0;F=!1;if(!P&&V===!1){gu.xS(6);break}g.ez(gu,7);return g.m(gu,bcg(0,!!V,!0,f),9);case 9:N=gu.D;g.gE(gu,8);break;case 7:J=g.Bj(gu);if(!(J instanceof Error&&J.message==="No data")){J instanceof Error&&J.message==="Empty response body"&&PL(J.message);gu.xS(8);break}return T==="!*$_ALL_ENTITIES_!*$"?g.m(gu,kYd(Z.L,I,Z.Z,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.m(gu,XvM(T,Z.L,I,Z.Z),8);case 8:if(!N.length||!P&&N[0].playlistId!==T)return gu.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
d));case 6:if(P){v=[];l=g.t(N);for(X=l.next();!X.done;X=l.next())H=X.value,H.upToDate||V&&!H.shouldAutoSyncMetadata||!H.playlistId||(x={nextAutoRefreshIntervalSeconds:H.checkInSeconds,autoSync:V},v.push(EP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",H.playlistId,"mainPlaylistEntity",0,xd,{mainPlaylistEntityActionMetadata:x})));return gu.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d,v))}N.length&&(Id=N[0],F=!!Id.upToDate,V&&(q=(TB=Id.shouldAutoSyncMetadata)!=null?TB:!0,A=(dD=Id.shouldAutoSyncVideos)!=
null?dD:!0,Id.checkInSeconds&&(B=Id.checkInSeconds)));if(F||!q)return gu.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d));Qu=[];Zr=f[0];if(!Zr.downloadState){sJ=void 0;gu.xS(15);break}return g.m(gu,BL(Z.L,Zr.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:sJ=gu.D;case 15:return bL=sJ,jt=((TL=bL)==null?0:TL.addedTimestampMillis)?String(bL.addedTimestampMillis):void 0,g.ez(gu,17),g.m(gu,MLL(Z,T,jt,B),19);case 19:Qu=gu.D;g.gE(gu,18);break;case 17:yu=g.Bj(gu);if(!(yu instanceof
Error&&yu.message==="No data for playlist")){if(yu instanceof Error&&yu.message==="Empty response body for playlist")PL(yu.message);else return UJ="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",X0="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",yu instanceof g.ox&&yu.type==="QUOTA_EXCEEDED"&&(UJ="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",X0="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),gu.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",d,void 0,UJ,X0));
gu.xS(18);break}return g.m(gu,XvM(T,Z.L,I,Z.Z),18);case 18:if(!A)return gu.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d));Ag=[];vE=new Map;if((oS=Qu)==null?0:oS.length)for(Ci=g.t(Qu),iL=Ci.next();!iL.done;iL=Ci.next())Rv=iL.value,D=Rv.offlineVideoData,M=void 0,((M=D)==null?0:M.videoId)&&vE.set(D.videoId,D);FH=new Map;YC=[];if((U5=Zr)==null?0:(fU=U5.videos)==null?0:fU.length)for(cO=g.t(Zr.videos),rD=cO.next();!rD.done;rD=cO.next())if(Ah=rD.value,R=JSON.parse(g.VU(Ah).entityId),S=R.videoId)vE.has(S)?
(FH.set(S,vE.get(S)),vE.delete(S)):YC.push(S);u=Number(((L=I.actionMetadata)==null?void 0:L.priority)||0)+1;E=g.t(vE.entries());for(fl=E.next();!fl.done;fl=E.next())K=fl.value,od=g.t(K),G=od.next().value,S$=od.next().value,vO=G,Fn=S$,Ag.push(EP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",vO,"mainVideoEntity",u,xd,w7u(I,Fn,T)));Rd=g.t(FH.entries());for(k9=Rd.next();!k9.done;k9=Rd.next())Dr=k9.value,pU=g.t(Dr),cl=pU.next().value,Zh=pU.next().value,Ll=cl,bN=Zh,Ag.push(EP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
Ll,"mainVideoEntity",u,xd,w7u(I,bN,T)));lL=g.t(YC);for(mg=lL.next();!mg.done;mg=lL.next())$9=mg.value,hY={playlistId:T},q3={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:hY},Ag.push(EP("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",$9,"mainVideoEntity",0,xd,q3));return gu.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d,Ag))}})},X7g=function(Z,I){var d,Y,T,f,P,O,a,W,e,B;
return g.h(function(w){switch(w.L){case 1:return d=tP(I),g.ez(w,2),Y=g.VU(I.entityKey).entityId,Y==="!*$_ALL_ENTITIES_!*$"?g.m(w,kYd(Z.L,I,Z.Z,(e=I.actionMetadata)==null?void 0:(B=e.offlineLoggingData)==null?void 0:B.offlineDeleteReason),5):g.m(w,E9(Z.L,Y),6);case 6:T=w.D;f=g.y(I.actionMetadata,vL);if(O=(P=f)==null?void 0:P.playlistId)T.playlistId=O;T.offlineDeleteReason=(a=I.actionMetadata)==null?void 0:(W=a.offlineLoggingData)==null?void 0:W.offlineDeleteReason;return g.m(w,$d(Y,Z.L,I,Z.Z,T),7);
case 7:if(!Z.U.Y("woffle_enable_main_downloads_library")){w.xS(5);break}return g.m(w,tk$(Z.L,I.entityKey),5);case 5:g.gE(w,3);break;case 2:return g.Bj(w),w.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",d,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return w.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d))}})},xDE=function(Z){switch(Z){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
tKM=function(Z,I,d){I=ZA0(Z.U,d.cotn,I);
d=g.Lv(I);return g.dIL(I,d,Z.U)},$Rg=function(Z,I){var d,Y,T,f,P,O,a,W,e,B,w,V,N,q,A;
return g.h(function(F){switch(F.L){case 1:return d=tP(I),Y=g.VU(I.entityKey),T=Y.entityId,g.m(F,BL(Z.L,I.entityKey,"musicTrack"),2);case 2:f=F.D;if(!f){P=void 0;F.xS(3);break}return g.m(F,BL(Z.L,f.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:P=F.D;case 3:O=P;if(!f||!O)return F.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d));W=g.y(I.actionMetadata,Tzu);g.ez(F,5);return g.m(F,eo$(Z,T,O.addedTimestampMillis,(e=W)==null?void 0:e.track,(B=W)==null?void 0:B.albumRelease),
7);case 7:V=Number(((w=I.actionMetadata)==null?void 0:w.priority)||0)+1;a=EP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",T,"playbackData",V,igi);g.gE(F,6);break;case 5:N=g.Bj(F);if(!(N instanceof Error&&N.message==="No data")){if(N instanceof Error&&N.message==="Empty response body")PL(N.message);else return q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",A="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",N instanceof g.ox&&N.type==="QUOTA_EXCEEDED"&&(q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
A="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),F.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",d,void 0,q,A));F.xS(6);break}return g.m(F,pT(T,Z.L,I,Z.Z),6);case 6:return F.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d,a?[a]:void 0))}})},B5g=function(Z,I){var d;
return g.h(function(Y){return Y.L==1?g.m(Y,UjV(Z,I),2):(d=Y.D)?g.m(Y,KT(Z,{mode:"readwrite",OU:!0},function(T){var f=[oF(T,d.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];d.mainDownloadsListEntity&&f.push(oF(T,d.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.WD.all(f)}),0):Y.xS(0)})},p7W=function(Z,I){var d,Y,T;
return g.h(function(f){switch(f.L){case 1:d=tP(I);g.ez(f,2);Y=g.VU(I.entityKey).entityId;if(Y==="!*$_ALL_ENTITIES_!*$")return g.m(f,c6E(Z.L),5);T=g.Es(Y,"videoPlaybackPositionEntity");return g.m(f,ofg(Z.L,T),5);case 5:g.gE(f,3);break;case 2:return g.Bj(f),f.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",d,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return f.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
d))}})},xRg=function(){kq.apply(this,arguments)},RF=function(Z,I){return Z.actionType===I.actionType&&Z.entityKey===I.entityKey},E9=function(Z,I){var d,Y,T,f,P,O,a,W,e,B,w;
return g.h(function(V){if(V.L==1)return d=g.Es(I,"transfer"),Y=g.Es(I,"videoDownloadContextEntity"),g.m(V,KT(Z,{mode:"readonly",OU:!0},function(N){return g.WD.all([dT(N,d,"transfer"),dT(N,Y,"videoDownloadContextEntity")])}),2);
T=V.D;f=g.t(T);P=f.next().value;O=f.next().value;a=P;W=O;w={videoId:I,cotn:(e=a)==null?void 0:e.cotn,offlineModeType:(B=W)==null?void 0:B.offlineModeType};return V.return(w)})},fnd=function(Z,I,d,Y,T){var f,P,O,a,W,e;
return g.h(function(B){switch(B.L){case 1:if(f=Y){B.xS(2);break}return g.m(B,OcL([I]),3);case 3:P=B.D,f=P[0];case 2:return g.m(B,vVW(Z,f,d,T),4);case 4:O=B.D;a=O.mainVideoEntity;W=O.channelEntity;g.ez(B,5);var w=c5(a.thumbnail),V=c5(W.avatar);return g.m(B,gs(w.concat(V)),7);case 7:g.gE(B,0);break;case 5:e=g.Bj(B),e instanceof Error&&e.message==="Failed to fetch"&&PL(e.message),g.v6(B)}})},CrL=function(Z){return Z instanceof Error?new F$("UNKNOWN_ENCODE_ERROR",{originalMessage:Z.message}):new F$("UNKNOWN_ENCODE_ERROR")},
bh=function(Z){this.L=Z},dDL=function(Z,I){var d,Y,T,f,P;
return g.h(function(O){if(O.L==1)return d=g.Es(I,"offlineVideoStreams"),g.m(O,BL(Z,d,"offlineVideoStreams"),2);Y=O.D;if(!Y||!Y.streamsProgress)return O.return();T=g.t(Y.streamsProgress);for(f=T.next();!f.done;f=T.next())P=f.value,P.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",P.numTotalBytes!==P.numBytesDownloaded&&(P.numBytesDownloaded=P.numTotalBytes);return g.m(O,ih(Z,Y,"offlineVideoStreams"),0)})},$q=function(Z,I,d){var Y,T,f,P,O,a,W;
return g.h(function(e){if(e.L==1)return g.m(e,KT(Z,{mode:"readwrite",OU:!0},function(B){var w=ZP(B,"transfer"),V=ZP(B,"offlineOrchestrationActionWrapperEntity");return g.WD.all([w,V]).then(function(N){N=g.t(N);var q=N.next().value;var A=N.next().value;N=KUv.map(function(l){return Cgi(B,l)});
A=g.t(A);for(var F=A.next();!F.done;F=A.next()){F=F.value;var J=g.VU(F.actionProto.entityKey).entityType==="musicTrack",v=F.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";RF(I,F.actionProto)||J&&(!J||v)||N.push(CT(B,F.key,{jh:!0}))}return g.WD.all(N).then(function(){return q})})}),2);
Y=e.D;T=g.t(Y);for(f=T.next();!f.done;f=T.next())P=f.value,LJ(P),O=g.VU(P.key).entityId,a={videoId:O,offlineDeleteReason:void 0,cotn:P.cotn},U9(a),W=g.Es(O,"musicTrack"),s9(d,{entityKey:W,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.m(e,Eeg(),0)})},Cf$=function(Z,I){var d,Y,T,f,P,O,a,W,e,B,w,V,N,q,A,F,J;
return g.h(function(v){switch(v.L){case 1:return d=tP(I),Y=g.VU(I.entityKey),T=Y.entityId,g.m(v,BL(Z.L,I.entityKey,"mainVideoEntity"),2);case 2:f=v.D;if(!f){P=void 0;v.xS(3);break}return g.m(v,BL(Z.L,f.downloadState,"mainVideoDownloadStateEntity"),4);case 4:P=v.D;case 3:O=P;if(!f||!O)return v.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d));g.ez(v,5);return g.m(v,fnd(Z,T,O.addedTimestampMillis,(W=g.y(I.actionMetadata,vL))==null?void 0:W.offlineVideoData),7);case 7:e=1;e=Number(((B=
I.actionMetadata)==null?void 0:B.priority)||0)+1;a=EP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",T,"playbackData",e,Prg);g.gE(v,6);break;case 5:w=g.Bj(v);if(!(w instanceof Error&&w.message==="No data")){if(w instanceof Error&&w.message==="Empty response body")PL(w.message);else return V="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",w instanceof g.ox&&w.type==="QUOTA_EXCEEDED"&&(V="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),v.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",d,void 0,V,N));v.xS(6);break}return g.m(v,E9(Z.L,T),9);case 9:q=v.D;A=g.y(I.actionMetadata,vL);if(J=(F=A)==null?void 0:F.playlistId)q.playlistId=J;q.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.m(v,$d(T,Z.L,I,Z.Z,q),6);case 6:return v.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d,a?[a]:void 0))}})},q4u=function(Z){switch(Z.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},E00=function(Z,I,d){this.L=Z;
this.U=I;this.Z=d},v6g=function(Z,I){var d,Y,T,f,P,O,a,W;
return g.h(function(e){d=c5(Z.avatar);Y=g.t(I);for(T=Y.next();!T.done;T=Y.next())if(f=T.value,f.id!==Z.id)for(P=g.t(c5(f.avatar)),O=P.next();!O.done;O=P.next())a=O.value,W=d.indexOf(a),W!==-1&&d.splice(W,1);return e.return(d)})},DRE=function(Z){var I;
return g.h(function(d){I=g.y(Z.frameworkUpdates,DP);return Z.frameworkUpdates&&I?g.m(d,BME(I),0):d.return()})},btg=function(){kq.apply(this,arguments)},BL=function(Z,I,d){return KT(Z,{mode:"readonly",
OU:!0},function(Y){return dT(Y,I,d)})},dT=function(Z,I,d){return Z.L.objectStore("EntityStore").get(I).then(function(Y){if(Y){if(d&&Y.entityType!==d)throw Error("Incorrect entity type");
return ryv(Z,Y)}})},Htt=function(){kq.apply(this,arguments)},ceL=function(){kq.apply(this,arguments)},g00=function(){kq.apply(this,arguments)},MKd=function(Z,I){var d,Y,T;
return g.h(function(f){switch(f.L){case 1:return g.ez(f,2),g.m(f,Aei(Z,I),4);case 4:return Y=f.D,g.m(f,DRE(Y),5);case 5:d=DDE(Y);g.gE(f,3);break;case 2:T=g.Bj(f),PL("getAndProcessSmartDownloadsResponse request or processing error",T);case 3:return f.return(d)}})},ZGE=function(Z){return g.Mm(reg(),Z)},w7u=function(Z,I,d){I={offlineVideoData:I,
playlistId:d};if(Z=g.y(Z.actionMetadata,zkt))I.maximumDownloadQuality=Z.maximumDownloadQuality;return{mainVideoEntityActionMetadata:I}},IMW=function(Z){var I;
return g.h(function(d){if(d.L==1)return g.m(d,n60(Z),2);I=d.D;return d.return(!!I&&I.length>0)})},Aei=function(Z,I){var d,Y,T,f,P,O,a,W,e,B;
return g.h(function(w){switch(w.L){case 1:return d=g.Lh(),g.m(w,ju(),2);case 2:Y=w.D;if(!Y){w.xS(3);break}return g.m(w,eQd(Y),4);case 4:T=w.D;case 3:var V=T;f={context:g.p9(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:Z},offlineClientState:V,clientStateRequestData:{preferredFormatType:I}}}};P=g.R$(dfW);g.ez(w,5);a={H0:!0};return g.m(w,g.L9(d,f,P,void 0,a),7);case 7:O=w.D;g.gE(w,6);break;case 5:W=g.Bj(w);if(W instanceof g.lX)throw e=
"DPS network manager error for smart downloads: "+W.message,PL(e,W),Error(e);PL("DPS fetch request error for smart downloads",W);throw Error("DPS fetch request error for smart downloads");case 6:B=QM(O);if(O)B!==void 0&&O9(B,"smart downloads");else throw PL("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return w.return(O)}})},RQt=function(Z,I){if(I.length===0)return Promise.resolve([]);
I=I.map(function(d){return yM(d)});
return nVu(Z.D,I)},oS0=function(Z,I,d){this.L=Z;
this.U=I;this.Z=d},Yy3=function(){kq.apply(this,arguments)},KT=function(Z,I,d){var Y,T,f,P;
return g.h(function(O){if(O.L==1)return g.m(O,ZGE(Z.token),2);if(O.L!=3)return Y=O.D,g.m(O,g.Xn(Y,["EntityStore","EntityAssociationStore"],I,function(a){T=new jZd(a,Z.L);return d(T)}),3);
f=O.D;T&&(P=T.Z,Object.keys(P).length>0&&(Z.channel.postMessage(P),pIW(Z,P)));return O.return(f)})},Ttg=function(Z,I){return Z.L.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(I))},EfV=function(Z){var I,d,Y,T,f,P,O,a;
return g.h(function(W){switch(W.L){case 1:return I=g.Lh(),d=FDL(Z),Y=g.R$(iGd),g.ez(W,2),f={H0:!0},g.m(W,g.L9(I,d,Y,void 0,f),4);case 4:T=W.D;g.gE(W,3);break;case 2:P=g.Bj(W);if(P instanceof g.lX)throw O="offlinePlaylistSyncCheck network manager error: "+P.message,PL(O,P),Error(O);PL("offlinePlaylistSyncCheck fetch request error",P);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:a=QM(T);if(!T)throw PL("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(a!==void 0)O9(a,"playlist sync");else if(!T.offlinePlaylistSyncCheckDatas||!T.offlinePlaylistSyncCheckDatas.length)throw PL("No data for playlist sync"),Error("No data for playlist sync");return W.return(T.offlinePlaylistSyncCheckDatas.map(function(e){return e.offlinePlaylistSyncCheckData}))}})},fM$=function(){kq.apply(this,arguments)},$d=function(Z,I,d,Y,T){var f,P,O,a,W,e,B,w,V,N,q,A,F,J,v,l,X,H,x,Id,TB,dD,Qu,Zr,sJ,bL,TL,jt,yu,UJ,X0;
return g.h(function(Ag){switch(Ag.L){case 1:return f=g.Es(Z,"mainVideoEntity"),P=g.Es(Z,"ytMainChannelEntity"),O=g.Es(Z,"transfer"),a=g.Es(Z,"videoDownloadContextEntity"),g.m(Ag,KT(I,{mode:"readonly",OU:!0},function(vE){return g.WD.all([dT(vE,f,"mainVideoEntity"),dT(vE,P,"ytMainChannelEntity"),dT(vE,O,"transfer"),dT(vE,a,"videoDownloadContextEntity"),ZP(vE,"ytMainChannelEntity"),ZP(vE,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:W=Ag.D;e=g.t(W);B=e.next().value;w=e.next().value;V=e.next().value;N=e.next().value;q=e.next().value;A=e.next().value;F=B;J=w;v=V;l=N;X=q;H=A;if(!F&&!J){Ag.xS(3);break}x=F?c5(F.thumbnail):[];if(!J){Id=[];Ag.xS(4);break}return g.m(Ag,v6g(J,X),5);case 5:Id=Ag.D;case 4:return TB=Id,g.m(Ag,lh(x.concat(TB)),3);case 3:dD=[];Qu=g.Es(Z,"downloadStatusEntity");Zr=g.t(H);for(sJ=Zr.next();!sJ.done;sJ=Zr.next())bL=sJ.value,TL=g.VU(bL.key).entityId,jt=uh(bL),yu=g.VU(jt.action.entityKey).entityId,TL!==Z&&
yu!==Z||RF(d,bL.actionProto)||dD.push(bL.key);return g.m(Ag,KT(I,{mode:"readwrite",OU:!0},function(vE){var oS=dD.map(function(Ci){return CT(vE,Ci)});
oS.push(CT(vE,f,{jh:!0}));oS.push(CT(vE,Qu,{jh:!0}));return g.WD.all(oS)}),7);
case 7:X0=(UJ=l)==null?void 0:UJ.offlineModeType,T&&(U9(T),T.offlineModeType&&(X0=T.offlineModeType)),LJ(v,X0),s9(Y,{entityKey:f,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.v6(Ag)}})},PUg=function(){N8.apply(this,arguments)},pRi=function(Z,I,d){var Y=d20(I);
return Ttg(Z,Y).then(function(){return oei(Z,I,d)})},KJ=function(){},HL=function(){},QZ0=function(Z){var I,d;
return g.h(function(Y){if(Y.L==1)return g.m(Y,g.k_(),2);if(Y.L!=3)return(I=Y.D)?g.m(Y,g.rJ(I),3):Y.return();d=Y.D;return Y.return(g.Xn(d,["index","media","captions"],{mode:"readwrite",OU:!0},function(T){var f=IDBKeyRange.bound(Z+"|",Z+"~");T=[T.objectStore("index").delete(f),T.objectStore("media").delete(f),T.objectStore("captions").delete(f)];return g.WD.all(T).then(function(){})}))})},OGp=function(Z,I,d,Y){Y=Y===void 0?[]:Y;
I={offlineOrchestrationContext:D2E(Z,I,d,Y)};I=kRg(3,I);Jy3(RRu(),I,Z.rootActionId)},X$=function(Z,I,d,Y,T){var f,P,O,a,W,e,B,w,V,N,q,A,F,J,v,l,X,H,x,Id,TB,dD,Qu,Zr,sJ,bL,TL,jt,yu,UJ,X0,Ag,vE,oS,Ci,iL;
return g.h(function(Rv){switch(Rv.L){case 1:return f=g.Es(Z,I),P=g.Es("music_downloads_library_id","musicDownloadsLibraryEntity"),g.m(Rv,KT(d,{mode:"readonly",OU:!0},function(D){return g.WD.all([dT(D,f,I),dT(D,P,"musicDownloadsLibraryEntity"),ZP(D,I),ZP(D,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:O=Rv.D;a=g.t(O);W=a.next().value;e=a.next().value;B=a.next().value;w=a.next().value;V=W;N=e;q=B;A=w;if(!V){Rv.xS(3);break}return g.m(Rv,HuL(V,q),4);case 4:return F=Rv.D,g.m(Rv,lh(F),3);case 3:J=[];v=new Map;if(!V){Rv.xS(6);break}return g.m(Rv,aMt(V,q,N),7);case 7:J=Rv.D;l=g.t(J);for(X=l.next();!X.done;X=l.next())H=X.value,x=g.VU(H).entityId,v.set(x,{videoId:x,playlistId:Z,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.m(Rv,Tp(d,"transfer"),8);case 8:for(Id=Rv.D,TB=
g.t(Id),dD=TB.next();!dD.done;dD=TB.next())Qu=dD.value,Zr=g.VU(Qu.key).entityId,(sJ=v.get(Zr))&&Qu&&(sJ.cotn=Qu.cotn);case 6:bL=[];TL=g.t(A);for(jt=TL.next();!jt.done;jt=TL.next())yu=jt.value,UJ=g.VU(yu.key).entityId,X0=uh(yu),UJ!==Z&&X0.rootActionId!==Z||RF(Y,yu.actionProto)||bL.push(yu.key);Ag=g.Es(Z,I);return g.m(Rv,KT(d,{mode:"readwrite",OU:!0},function(D){var M=bL.map(function(FH){return CT(D,FH)});
M.push(CT(D,Ag,{jh:!0}));return g.WD.all(M)}),9);
case 9:if(!V){Rv.xS(0);break}J.reverse();if(!J.length){Rv.xS(0);break}vE=g.t(J);oS=vE.next();case 12:if(oS.done){Rv.xS(0);break}Ci=oS.value;iL=g.VU(Ci).entityId;if(!iL){Rv.xS(13);break}return g.m(Rv,pT(iL,d,Y,T,v.get(iL)),13);case 13:oS=vE.next(),Rv.xS(12)}})},cL=function(){WL.apply(this,arguments);
this.In="musicTrack"},Wcu=function(Z,I,d){var Y,T,f,P,O,a,W,e,B,w,V,N;
return g.h(function(q){switch(q.L){case 1:Y=I.retryScheduleIndex+2===3;if(d.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){q.xS(2);break}if(d.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){q.xS(0);break}OGp(I,d,Y);if(d.L&&I.retryScheduleIndex+1<3)return g.m(q,L$W(Z,[I]),0);f=((T=d)==null?0:T.D)?d.D:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";P={entityKey:I.action.entityKey,failureReason:f};O=void 0;g.qN(Z.U)?O="mainVideoDownloadStateEntity":g.vl(Z.U)&&(O="musicTrackDownloadMetadataEntity");
if(!O||!d.downloadState){q.xS(7);break}a=g.VU(I.action.entityKey).entityId;return g.m(q,Jc(a,O,Z.D,d.downloadState),7);case 7:s9(Z.V,P);if(d.downloadState==="DOWNLOAD_STATE_FAILED"&&Z.U.Y("html5_auto_retry_failed_pde_actions")){q.xS(0);break}PL("Orchestration result is not retryable, deleting action");return g.m(q,ofg(Z.D,yM(I).key),0);case 2:W=void 0;try{W=(e=d.N)==null?void 0:e.map(function(A){return Z.createAction(A,I)})}catch(A){return OGp(I,d,Y),B={entityKey:I.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},s9(Z.V,B),PL("Orchestration subactions creation error",A),q.return()}OGp(I,d,Y,W);if(!W){q.xS(12);break}w=W.map(function(A){return yM(A)});
V=0;case 13:if(!(V<W.length)||Z.B){q.xS(15);break}return g.m(q,KT(Z.D,{mode:"readwrite",OU:!0},function(A){var F=[];F.push(wRM(A,w.slice(V,V+10),"offlineOrchestrationActionWrapperEntity"));return g.WD.all(F)}),16);
case 16:V+=10;q.xS(13);break;case 15:if(Z.B)return Z.B=!1,q.return();case 12:return N=yM(I),g.m(q,ofg(Z.D,N.key),17);case 17:LKt(I,4),g.v6(q)}})},e_V=function(){kq.apply(this,arguments)},Bt3=function(Z,I){var d,Y;
return g.h(function(T){switch(T.L){case 1:return d=tP(I),g.ez(T,2),Y=g.VU(I.entityKey).entityId,Y==="!*$_ALL_ENTITIES_!*$"?g.m(T,$q(Z.L,I,Z.Z),5):g.m(T,X$(Y,"musicAlbumRelease",Z.L,I,Z.Z),6);case 6:return g.m(T,Ift(Z.L,I.entityKey),5);case 5:g.gE(T,3);break;case 2:return g.Bj(T),T.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",d,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return T.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
d))}})},MkM=function(Z){return{context:g.p9(),
videoIds:Z}},w6i=function(Z,I){var d,Y,T,f,P,O,a,W,e,B,w,V,N,q,A,F,J,v,l,X,H,x,Id,TB,dD,Qu,Zr,sJ,bL,TL,jt,yu,UJ,X0,Ag,vE,oS,Ci,iL,Rv,D,M,FH,YC,U5,fU,cO,rD,Ah,R,S,L,u,E,fl,K,od,G,S$,vO,Fn,Rd,k9,Dr,pU,cl,Zh,Ll,bN,lL,mg;
return g.h(function($9){switch($9.L){case 1:return d=tP(I),Y=I.entityKey,T=g.VU(Y).entityId,f=[],P=!1,T==="!*$_ALL_ENTITIES_!*$"?(P=!0,g.m($9,Tp(Z.L,"musicPlaylist"),5)):g.m($9,BL(Z.L,Y,"musicPlaylist"),4);case 4:(O=$9.D)&&f.push(O);$9.xS(3);break;case 5:f=$9.D;case 3:if((a=f)==null||!a.length)return $9.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d));W=g.y(I.actionMetadata,uWu);B=(e=W)==null?void 0:e.autoSync;w=[];N=V=!0;q=!1;A=void 0;if(!P&&B===!1){$9.xS(6);break}g.ez($9,7);return g.m($9,
Ls0(0,!!B,!0,f),9);case 9:w=$9.D;g.gE($9,8);break;case 7:F=g.Bj($9);if(!(F instanceof Error&&F.message==="No data")){F instanceof Error&&F.message==="Empty response body"&&PL(F.message);$9.xS(8);break}return T==="!*$_ALL_ENTITIES_!*$"?g.m($9,$q(Z.L,I,Z.Z),8):g.m($9,X$(T,"musicPlaylist",Z.L,I,Z.Z),8);case 8:if(!w.length||!P&&w[0].playlistId!==T)return $9.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d));case 6:if(P){J=[];v=g.t(w);for(l=v.next();!l.done;l=v.next())X=l.value,X.upToDate||
B&&!X.shouldAutoSyncMetadata||!X.playlistId||(H={autoSync:B},J.push(EP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",X.playlistId,"musicPlaylist",0,kd,{musicPlaylistEntityActionMetadata:H})));return $9.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d,J))}w.length&&(x=w[0],q=!!x.upToDate,B&&(V=(Id=x.shouldAutoSyncMetadata)!=null?Id:!0,N=(TB=x.shouldAutoSyncVideos)!=null?TB:!0,x.checkInSeconds&&(A=x.checkInSeconds)));if(q||!V)return $9.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
d));dD=[];Qu=f[0];Zr=void 0;if(!Qu.downloadMetadata){$9.xS(15);break}return g.m($9,BL(Z.L,Qu.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:sJ=$9.D,Zr=Number((TL=(bL=sJ)==null?void 0:bL.addedTimestampMillis)!=null?TL:"0")/1E3;case 15:return g.ez($9,17),g.m($9,J6u(Z,T,(jt=Zr)==null?void 0:jt.toString(),A),19);case 19:dD=$9.D;g.gE($9,18);break;case 17:yu=g.Bj($9);if(!(yu instanceof Error&&yu.message==="No data")){if(yu instanceof Error&&yu.message==="Empty response body")PL(yu.message);
else return UJ="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",X0="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",yu instanceof g.ox&&yu.type==="QUOTA_EXCEEDED"&&(UJ="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",X0="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),$9.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",d,void 0,UJ,X0));$9.xS(18);break}return g.m($9,X$(T,"musicPlaylist",Z.L,I,Z.Z),18);case 18:if(!N)return $9.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
d));Ag=[];vE=new Map;if((oS=dD)==null?0:oS.length)for(Ci=g.t(dD),iL=Ci.next();!iL.done;iL=Ci.next())Rv=iL.value,D=Rv.offlineVideoData,M=void 0,((M=D)==null?0:M.videoId)&&vE.set(D.videoId,D);FH=new Map;YC=[];if((U5=Qu)==null?0:(fU=U5.tracks)==null?0:fU.length)for(cO=g.t(Qu.tracks),rD=cO.next();!rD.done;rD=cO.next())if(Ah=rD.value,R=g.VU(Ah).entityId)vE.has(R)?(FH.set(R,vE.get(R)),vE.delete(R)):YC.push(R);L=Number(((S=I.actionMetadata)==null?void 0:S.priority)||0)+1;u=g.t(vE.entries());for(E=u.next();!E.done;E=
u.next())fl=E.value,K=g.t(fl),od=K.next().value,G=K.next().value,S$=od,vO=G,Ag.push(EP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",S$,"musicTrack",L,kd,H5(I,vO)));Fn=g.t(FH.entries());for(Rd=Fn.next();!Rd.done;Rd=Fn.next())k9=Rd.value,Dr=g.t(k9),pU=Dr.next().value,cl=Dr.next().value,Zh=pU,Ll=cl,Ag.push(EP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Zh,"musicTrack",L,kd,H5(I,Ll)));bN=g.t(YC);for(lL=bN.next();!lL.done;lL=bN.next())mg=lL.value,Ag.push(EP("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",mg,"musicTrack",
0,kd));return $9.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d,Ag))}})},FcL=function(Z){var I,d;
return g.h(function(Y){if(Y.L==1)return g.m(Y,ju(),2);if(Y.L!=3){I=Y.D;if(!I)return PL("PES is undefined"),Y.return();Z.D=new VJ3(I,Z.api,Z.Z,Z.L);d=Z.WH(I);return g.m(Y,NtM(I,d,Z.Z,Z.L,Z.U),3)}Z.V=Y.D;return g.m(Y,an3(Z),0)})},sZp=function(Z){return g.h(function(I){if(I.L==1)return Z.B?g.m(I,Yd(Z.V,Z.B.videoDetails.videoId),3):I.xS(0);
Ms(Z);g.v6(I)})},xq=function(Z,I,d,Y,T,f){this.status=Z;
this.L=I;this.N=d;this.D=Y;this.Z=T;this.downloadState=f},nSu=function(Z){this.Wj=Z;
this.L=void 0},Inv=function(Z,I){var d,Y,T;
return g.h(function(f){switch(f.L){case 1:return g.ez(f,2),(d=!!I.captionTracks.length||!!I.kF)?g.m(f,IMW(I.videoId),4):f.return();case 4:return(Y=f.D)?f.return():g.m(f,N5v(Z.on,I),5);case 5:g.gE(f,0);break;case 2:T=g.Bj(f),PL("Caption downloading error",T,I.cotn),g.v6(f)}})},q2v=function(Z,I){var d;
return g.h(function(Y){if(Y.L==1)return g.m(Y,Tp(Z.D,"offlineOrchestrationActionWrapperEntity",I),2);d=Y.D;return Y.return(d.filter(eki))})},NtM=function(Z,I,d,Y,T){var f;
return g.h(function(P){if(P.L==1)return f=new gT(Z,I,d,Y,T),g.m(P,GKi(f),2);aku(f);return P.return(f)})},h_p=function(){return g.h(function(Z){if(M8!==void 0)return Z.return(M8);
M8=new Promise(function(I){var d;return g.h(function(Y){switch(Y.L){case 1:return g.ez(Y,2),g.m(Y,rT.open("test-only"),4);case 4:return g.m(Y,rT.delete("test-only"),5);case 5:g.gE(Y,3);break;case 2:if(d=g.Bj(Y),d instanceof Error&&d.name==="SecurityError")return I(!1),Y.return();case 3:I("caches"in window),g.v6(Y)}})});
return Z.return(M8)})},mfg=function(){kq.apply(this,arguments)},CT=function(Z,I,d){if(d==null?0:d.jh){var Y=new Set;
return dju(Z,I,Y).then(function(){for(var f=[],P=g.t(Y),O=P.next();!O.done;O=P.next())f.push(CT(Z,O.value));return g.WD.all(f).then(function(){})})}var T=g.VU(I).entityType;
return g.WD.all([Z.L.objectStore("EntityStore").delete(I),Ttg(Z,I)]).then(function(){aF(Z,I,T)})},tk$=function(Z,I){var d,Y,T,f,P,O,a,W,e,B,w,V,N,q,A;
return g.h(function(F){if(F.L==1)return d=g.Es("main_downloads_library_id","mainDownloadsLibraryEntity"),Y=g.Es("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.m(F,KT(Z,{mode:"readonly",OU:!0},function(J){return g.WD.all([dT(J,d,"mainDownloadsLibraryEntity"),dT(J,Y,"mainDownloadsListEntity"),dT(J,g.zN,"mainDownloadsListEntity")])}),2);
T=F.D;f=g.t(T);P=f.next().value;O=f.next().value;a=f.next().value;W=P;e=O;B=a;if(!W)return F.xS(0);if(I===g.zN&&((w=B)==null?0:w.downloads))B.downloads=[];else if((V=e)==null?0:V.downloads)for(N=g.VU(I).entityType,q=0;q<e.downloads.length;q++)if(A=e.downloads[q],N==="mainVideoEntity"&&A.videoItem===I){e.downloads.splice(q,1);break}else if(N==="mainPlaylistEntity"&&A.playlistItem===I){e.downloads.splice(q,1);break}return g.m(F,KT(Z,{mode:"readwrite",OU:!0},function(J){var v=[oF(J,W,"mainDownloadsLibraryEntity")];
e&&v.push(oF(J,e,"mainDownloadsListEntity"));B&&v.push(oF(J,B,"mainDownloadsListEntity"));return g.WD.all(v)}),0)})},NLi=function(Z){return g.h(function(I){return I.return(qyd(Z))})},Ot3=function(Z,I){I.length!==0&&I.forEach(function(d){d=uh(d);
d.retryScheduleIndex<3&&Syu(Z.L,[d])})},A_u=function(){kq.apply(this,arguments)},Dfg=function(){kq.apply(this,arguments)},J_W=function(Z,I,d,Y){Y=Y===void 0?!1:Y;
var T,f,P,O,a,W,e,B,w,V,N,q,A,F,J;return g.h(function(v){switch(v.L){case 1:return T=[],g.m(v,IkW(),2);case 2:return(f=v.D)||Y?g.m(v,MKd(I,d),3):v.return([]);case 3:P=v.D;if((O=P)==null||!O.length)return v.return([]);a={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};W=g.t(P);e=W.next();case 4:if(e.done){v.xS(6);break}w=B=e.value;V=w.actionType;N=w.entityKey;q=w.actionMetadata;if(!(V&&N&&q)||g.y(q,Je$)){v.xS(5);break}V==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(q.offlineLoggingData=
a);A=g.VU(N);F=A.entityId;return g.m(v,hc(Z,[F],"mainVideoEntity",V,q),8);case 8:J=v.D,T=T.concat(J);case 5:e=W.next();v.xS(4);break;case 6:return v.return(T)}})},R_M=function(Z){var I=(Z.L.transferRetryCount||0)<3;
I&&(Z=Z.L,Z.transferRetryCount=(Z.transferRetryCount||0)+1);return I},q7L=function(Z,I,d){var Y,T,f,P,O;
return g.h(function(a){if(a.L==1){if(!I.frameworkUpdates||!g.y(I.frameworkUpdates,DP))return a.return();if(!(g.y(I.frameworkUpdates,DP).mutations&&g.y(I.frameworkUpdates,DP).mutations.length>0&&g.y(I.frameworkUpdates,DP).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return a.xS(2);Y=g.VU(g.y(I.frameworkUpdates,DP).mutations[0].entityKey).entityId;return g.m(a,E9(Z.L,Y),3)}if(a.L!=2){T=a.D;f=g.y(d.actionMetadata,nJ);if(O=(P=f)==null?void 0:P.playlistId)T.playlistId=O;T.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.qN(Z.U)?g.m(a,$d(Y,Z.L,d,Z.Z,T),2):g.vl(Z.U)?g.m(a,pT(Y,Z.L,d,Z.Z),2):a.xS(2)}return g.m(a,BME(g.y(I.frameworkUpdates,DP)),0)})},uqi=function(Z){var I,d;
return g.h(function(Y){if(Y.L==1)return g.m(Y,Tp(Z.D,"transfer"),2);I=Y.D;d=I.filter(cDV).sort(EVL);return d.length===0?Y.return():Y.return(d[0])})},Lci=function(){kq.apply(this,arguments)},y_u=function(Z,I){var d,Y,T,f,P,O,a,W;
return g.h(function(e){switch(e.L){case 1:return d=tP(I),Y=g.VU(I.entityKey).entityId,g.ez(e,2),g.m(e,eu.getInstance(),4);case 4:T=e.D;if(!T)throw Error("prefStorage is undefined");return g.m(e,T.get("psi"),5);case 5:f=e.D;P=g.y(I.actionMetadata,UfE);if(((O=f)==null?void 0:O.isPaused)!==!1||(a=P)==null||!a.lastPlaybackPositionSeconds){e.xS(6);break}W={key:g.Es(Y,"videoPlaybackPositionEntity"),videoId:Y,lastPlaybackPositionSeconds:P.lastPlaybackPositionSeconds};return g.m(e,ih(Z.L,W,"videoPlaybackPositionEntity"),
6);case 6:g.gE(e,3);break;case 2:return g.Bj(e),e.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",d,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return e.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d))}})},iuL=function(Z,I,d,Y,T,f){var P,O,a;
return g.h(function(W){P="STREAM_TYPE_UNKNOWN";d.video&&d.audio?(P="STREAM_TYPE_AUDIO_AND_VIDEO",PL("unexpected stream type")):d.video&&!d.audio?P="STREAM_TYPE_VIDEO":!d.video&&d.audio&&(P="STREAM_TYPE_AUDIO");O=g.Es(I,"offlineVideoStreams");a={numBytesDownloaded:T.toFixed(),numTotalBytes:f.toFixed(),streamType:P,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(Y),itag:P==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(d.itag):void 0};return g.m(W,KT(Z,{mode:"readwrite",OU:!0},
function(e){var B=dT(e,O,"offlineVideoStreams"),w=dT(e,g.Es(I,"transfer"),"transfer");return g.WD.all([B,w]).then(function(V){V=g.t(V);var N=V.next().value;V=V.next().value;if(!V)return CT(e,O).then(function(){});
var q=uOW(N);N=dRd(N,Y,a,O);var A=oF(e,N,"offlineVideoStreams");uOW(N)>q&&(V.lastProgressTimeMs=Date.now().toString());q=[A];V.offlineVideoStreams||(V.offlineVideoStreams=[]);V.offlineVideoStreams.indexOf(O)===-1&&(V.offlineVideoStreams.push(O),q.push(oF(e,V,"transfer")));return g.WD.all(q)})}),0)})},eki=function(Z){return Z!==void 0},vSi=function(){g.NI.apply(this,arguments);
var Z=this;this.events=new g.De(this);this.U=this.player.C();this.A9={mUZ:function(){return Z.L},
hf:function(){return Z.hf()},
a8:function(I){return Z.a8(I)}}},lMt=function(Z,I){if(I)for(var d=0;d<Z.actions.length;d++)if(I==="!*$_ALL_ENTITIES_!*$"&&Z.actions[d].actionId!==I||I!=="!*$_ALL_ENTITIES_!*$"&&Z.actions[d].rootActionId===I&&Z.actions[d].actionId!==I)Z.actions.splice(d,1),d--},uLW=function(Z,I){var d,Y,T,f,P,O,a,W,e,B,w;
return g.h(function(V){if(V.L==1)return d=[],g.m(V,KT(Z.L,{mode:"readonly",OU:!0},function(N){var q=[],A=I.offlineVideoStreams;if(A){A=g.t(A);for(var F=A.next();!F.done;F=A.next())q.push(dT(N,F.value,"offlineVideoStreams"))}return g.WD.all(q)}),2);
if(Y=V.D)for(T=g.t(Y),f=T.next();!f.done;f=T.next())if(P=f.value,O=void 0,(O=P)==null?0:O.streamsProgress)for(a=P.streamsProgress,W=0;W<a.length;W++)e=a[W],B=JSON.parse(e.formatStreamBytes),w={itag:B.itag,lmt:B.lastModified,xtags:B.xtags},d.push(w);return V.return(d)})},G50=function(Z,I){var d,Y;
return g.h(function(T){switch(T.L){case 1:return d=tP(I),g.m(T,BL(Z.L,I.entityKey,"transfer"),2);case 2:if(Y=T.D)return T.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d));g.ez(T,3);return g.m(T,szg(Z,I),5);case 5:g.gE(T,4);break;case 3:return g.Bj(T),T.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",d,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return T.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
d))}})},aLg=function(Z){if(!Z.Z&&!Z.L){var I=z_i();
if(I){Z.Z=!0;var d=g.U0("OfflineLockManager");I.request("woffle_orchestration_leader:"+d,{},function(){var Y,T;return g.h(function(f){switch(f.L){case 1:return g.ez(f,2),Z.D=new g.f2,Z.L=!0,Z.Z=!1,g.m(f,Z.X(),4);case 4:return g.m(f,Z.D.promise,5);case 5:g.gE(f,0);break;case 2:Y=g.Bj(f),Z.f7(),Y instanceof Error&&(T=Y,T.args=[{name:"WoLockManagerError",Xt:Y.name}],g.nl(T)),g.v6(f)}})})}}},PfW=function(Z){Z=Z*1E3-Date.now();
return Z>4E3?4E3:Z},k5E=function(){kq.apply(this,arguments)},mD0=function(Z,I,d){var Y,T,f,P,O,a,W,e;
return g.h(function(B){switch(B.L){case 1:Y=g.Lh();var w=d.refreshData,V=d.isEnqueuedForExpiredStreamUrlRefetch,N=d.Ma,q=d.offlineSourceData,A=d.mediaCapabilities,F={entityKey:Z};w&&(F.refreshData=w);V&&(F.isExpiredStreamUrlRefetch=V);N&&(F.downloadParameters=N);q&&(F.offlineSourceData=q);w={context:g.J5(I),signatureTimestamp:20360,videos:[F]};A&&(w.mediaCapabilities=A);T=w;f=g.R$(X6M);g.ez(B,2);O={H0:!0};return g.m(B,g.L9(Y,T,f,void 0,O),4);case 4:P=B.D;g.gE(B,3);break;case 2:a=g.Bj(B);if(a instanceof
g.lX)throw W="GetPDE network manager error: "+a.message,PL(W,a),Error(W);PL("GetPDE fetch request error",a);throw Error("GetPDE fetch request error");case 3:e=QM(P);if(P)e!==void 0&&O9(e,"PDE");else throw PL("Network request failed for PDE"),Error("Network request failed for PDE");return B.return(P)}})},uZL=function(Z){switch(Z.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},Wsg=function(Z,I,d,Y,T){var f;
return g.h(function(P){return P.L==1?(T||(T=Date.now().toString()),f={id:g.Es(d,"musicTrackDownloadMetadataEntity"),playbackData:g.Es(d,"playbackData"),addedTimestampMillis:T,videoDownloadContextEntity:g.Es(d,"videoDownloadContextEntity")},Y&&(I.albumRelease=Y.id),g.m(P,KT(Z.L,{mode:"readwrite",OU:!0},function(O){var a=[],W=oF(O,f,"musicTrackDownloadMetadataEntity");a.push(W);W=oF(O,I,"musicTrack");a.push(W);Y&&(O=oF(O,Y,"musicAlbumRelease"),a.push(O));return g.WD.all(a)}),2)):P.L!=3?g.m(P,Jc(d,"musicTrackDownloadMetadataEntity",
Z.L,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):P.return({musicTrackEntity:I,
Jr:Y})})},ZI=function(Z){return Z.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!Z.entityKey},rs=function(Z,I){Z.api.D1("woffle",{mcte:I});
PL("missing current transfer entity.")},tJg=function(){kq.apply(this,arguments)},$fg=function(){kq.apply(this,arguments)},Syu=function(Z,I){I=g.t(I);
for(var d=I.next();!d.done;d=I.next())d=d.value,LKt(d,1),Z.actions.push(d);Z.actions.sort(Z.L)},VJ3=function(Z,I,d,Y){g.p.call(this);
var T=this;this.D=Z;this.api=I;this.w4=d;this.kS=Y;this.j=new g.HU;this.N=new g.uX(function(){T.L&&T.L.transferState==="TRANSFER_STATE_TRANSFERRING"&&T.j.QQ()&&((T.L.transferRetryCount||0)<3?VM(T.V,T.B,!1,!1):Yd(T.V,T.B.videoDetails.videoId),T.IM("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.LS=this.fS=0;this.In=this.X=!1;this.sZ=g.Q4(this.api.C().experiments,"html5_transfer_processing_logs_interval");this.Tm=new g.De(this);this.A9={dU4:function(){return T.N},
SKn:function(){return T.kS},
Ti:function(){return T.j}};
this.Ns=this.D.observe(this.Re.bind(this));this.V=new tLp(I,this);this.on=new nSu(I);this.Bj=new tc(this.D);this.mJ=this.j.listen("publicytnetworkstatus-online",this.Nd.bind(this));this.j7=this.j.listen("publicytnetworkstatus-offline",this.zXm.bind(this));this.In=this.api.C().Y("html5_less_transfer_processing_logs");g.z(this,this.Tm);this.Tm.W(I,"offlinetransferpause",this.mIm);if(g.qN(this.api.C()))this.Z="mainVideoDownloadStateEntity";else if(g.vl(this.api.C())||g.B8(this.api.C()))this.Z="musicTrackDownloadMetadataEntity"},
O9=function(Z,I){I=I?" for "+I:"";
if(Z===0)throw Z="Empty response body"+I,PL(Z),Error(Z);Z="Response with error"+I;PL(Z);throw Error(Z);},icu=function(Z,I){var d,Y,T,f,P,O,a,W,e;
return g.h(function(B){if(B.L==1)return d=g.Es("music_downloads_library_id","musicDownloadsLibraryEntity"),g.m(B,BL(Z,d,"musicDownloadsLibraryEntity"),2);(Y=B.D)||(Y={id:d});T=g.VU(I).entityType;T==="musicTrack"?(f=Y.downloadedTracks)!=null&&f.includes(I)||(Y.downloadedTracks=((P=Y.downloadedTracks)!=null?P:[]).concat(I)):T==="musicPlaylist"?(O=Y.downloadedPlaylists)!=null&&O.includes(I)||(Y.downloadedPlaylists=((a=Y.downloadedPlaylists)!=null?a:[]).concat(I)):T!=="musicAlbumRelease"||(W=Y.downloadedAlbumReleases)!=
null&&W.includes(I)||(Y.downloadedAlbumReleases=((e=Y.downloadedAlbumReleases)!=null?e:[]).concat(I));return g.m(B,ih(Z,Y,"musicDownloadsLibraryEntity"),0)})},z_i=function(){try{var Z=g.gZ("ytglobal.locks_");
if(Z)return Z;var I;if(I=navigator){var d=navigator;I="locks"in d&&!!d.locks}if(I)return g.iN.localStorage&&g.iN.localStorage.getItem("noop"),Z=new Nng,g.zb("ytglobal.locks_",Z),Z}catch(Y){}},Ouu=function(Z){var I,d,Y,T,f,P,O,a,W,e,B,w,V,N,q,A,F;
return g.h(function(J){switch(J.L){case 1:if(Z.N)throw Error("Already processing an action");if(Z.OZ())return J.return();I=Z.L.actions.shift();EH0(Z.LS,!I);if(I===void 0)return J.return();I.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&I.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&lMt(Z.L,I.actionId);d="";I.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&I.rootActionId===I.actionId&&(d=I.actionId);Y=[I];Z.N=Y;if(T=Z.Ns[I.entityType]){J.xS(2);break}Z.N=
void 0;return g.m(J,Ouu(Z),3);case 3:return J.return();case 2:f=g.t(Y);for(P=f.next();!P.done;P=f.next())O=P.value,LKt(O,2);g.ez(J,4,5);return g.m(J,p6M(T,Y.map(function(v){return v.action})),7);
case 7:a=J.D,W=g.t(Y),e=W.next();case 8:if(e.done){J.xS(10);break}B=e.value;w=a.get(B.action);return g.m(J,Wcu(Z,B,w),9);case 9:e=W.next();J.xS(8);break;case 10:lMt(Z.L,d);case 5:g.ON(J);Z.N=void 0;g.Bh(J,6);break;case 4:return V=g.Bj(J),PL("Orchestration error",V),g.ez(J,12),g.m(J,L$W(Z,Y),14);case 14:g.gE(J,5);break;case 12:N=g.Bj(J);PL("Orchestration retry error",N);q=g.t(Y);for(A=q.next();!A.done;A=q.next())F=A.value,F.retryScheduleIndex<3&&Syu(Z.L,[F]);J.xS(5);break;case 6:return g.m(J,Ouu(Z),
0)}})},ih=function(Z,I,d){return KT(Z,{mode:"readwrite",
OU:!0},function(Y){return oF(Y,I,d)})},qBg=function(Z,I){var d;
return((d=Z.player)==null?void 0:d.getVideoData().videoId)===I?Z.player:null},xfg=function(Z,I){var d,Y,T,f,P,O,a,W,e,B;
return g.h(function(w){switch(w.L){case 1:return d=tP(I),Y=g.VU(I.entityKey).entityId,g.m(w,KT(Z.L,{mode:"readonly",OU:!0},function(V){var N=dT(V,I.entityKey,"transfer");V=dT(V,g.Es(Y,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.WD.all([N,V])}),2);
case 2:T=w.D;f=g.t(T);P=f.next().value;O=f.next().value;a=P;W=O;if(!a||a.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return w.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d));g.ez(w,3);a.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.m(w,ih(Z.L,a,"transfer"),5);case 5:e=g.VU(a.key).entityId;M8V({videoId:e,bW:a,offlineModeType:(B=W)==null?void 0:B.offlineModeType});g.gE(w,4);break;case 3:return g.Bj(w),w.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
d,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return w.return(new xq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",d))}})},U9=function(Z){var I;
Z.offlineDeleteReason=(I=Z.offlineDeleteReason)!=null?I:"OFFLINE_DELETE_REASON_UNKNOWN";var d;Z.offlineModeType=(d=Z.offlineModeType)!=null?d:"OFFLINE_NOW";g.g6("offlineDeleteEvent",Z)},Jy3=function(Z,I,d){if(!d){var Y=Y===void 0?!1:Y;
d=Z.L.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!d||Y)d=g.LY(16),Z.L.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",d)}Z={flowNonce:d,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:I.eventType};I.metadata&&(Z.flowMetadata=I.metadata);I.statusCode!==void 0&&(Z.flowEventStatus=I.statusCode);I.csn&&(Z.csn=I.csn);I.can&&(Z.can=I.can);g.g6("flowEvent",Z,void 0)},Kc0=function(){kq.apply(this,arguments)},CUW=function(Z,I,d){this.L=Z;
this.U=I;this.Z=d},ZA0=function(Z,I,d){return new g.DX(Z,{cotn:I,
raw_player_response:d,download_media:!0,start:Infinity,disable_watch_next:!0})},ESd=function(){kq.apply(this,arguments)},bGv=function(){kq.apply(this,arguments)},reg=function(){if(Io)return Io();
var Z={};Io=g.da("PersistentEntityStoreDb",{Sn:(Z.EntityStore={mT:1},Z.EntityAssociationStore={mT:2},Z),shared:!1,upgrade:function(I,d){d(1)&&g.Z4(g.l2(I,"EntityStore",{keyPath:"key"}),"entityType","entityType");d(2)&&(I=g.l2(I,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.Z4(I,"byParentEntityKey","parentEntityKey"),g.Z4(I,"byChildEntityKey","childEntityKey"))},
version:3});return Io()},HGi=function(){kq.apply(this,arguments)},OAd=function(Z){Z.L&&(Z.B=!0,XQ(Z))},p6M=function(Z,I){var d,Y,T,f,P,O;
return g.h(function(a){switch(a.L){case 1:d=new Map,Y=g.t(I),T=Y.next();case 2:if(T.done){a.xS(4);break}f=T.value;P=d;O=P.set;return g.m(a,Z.D(f),5);case 5:O.call(P,f,a.D);T=Y.next();a.xS(2);break;case 4:return a.return(d)}})},qyd=function(Z){return g.h(function(I){g.wN(Z,0);
return I.return(QZ0(Z))})},jZd=function(Z,I){this.L=Z;
this.D=I;this.Z={}},D2E=function(Z,I,d,Y){if(!Z.action.entityKey)throw Error("entityKey is missing.");
var T=g.VU(Z.action.entityKey);T={entityType:T.Ur,entityId:T.entityId,offlineOrchestrationActionType:Z.action.actionType,orchestrationAction:{orchestrationActionId:Z.actionId}};I&&(T.offlineOrchestrationActionResult=I.status,T.isRetryable=d?!1:I.L,I.Z&&(T.offlineOrchestrationFailureReason=o0g(I.Z,T.isRetryable)));var f,P;if((f=Z.action.actionMetadata)==null?0:(P=f.offlineLoggingData)==null?0:P.offlineModeType)T.offlineModeType=Z.action.actionMetadata.offlineLoggingData.offlineModeType;Y&&(T.additionalOrchestrationActions=
Y.map(function(O){return{orchestrationActionId:O.actionId}}));
return T},S2L=function(Z,I){Z=g.t(Z.actions);
for(var d=Z.next();!d.done;d=Z.next())if(d.value.actionId===I)return!0;return!1},Cgi=function(Z,I){return g.Vq(Z.L.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(I)},function(d){return g.WD.all([d.delete(),
Ttg(Z,d.cursor.primaryKey)]).then(function(){aF(Z,d.cursor.primaryKey,I);return g.w1(d)})})},c_E=function(Z,I){this.L=Z;
this.U=I},gSV=function(Z,I){var d,Y,T,f,P,O,a,W,e,B,w,V,N,q,A,F,J,v,l,X,H,x,Id,TB;
return g.h(function(dD){switch(dD.L){case 1:return d=I.entityKey,Y=g.VU(d).entityId,g.m(dD,KT(Z.L,{mode:"readonly",OU:!0},function(Qu){var Zr=dT(Qu,d,"playbackData"),sJ=dT(Qu,g.Es(Y,"offlineVideoPolicy"),"offlineVideoPolicy");Qu=dT(Qu,g.Es(Y,"transfer"),"transfer");return g.WD.all([Zr,sJ,Qu])}),2);
case 2:T=dD.D;f=g.t(T);P=f.next().value;O=f.next().value;a=f.next().value;W=P;e=O;B=a;if(!W||!e)return dD.return(zp(I,!0));w=[];q=((N=W)==null?0:N.playerResponseJson)?JSON.parse(W.playerResponseJson):null;if(!(B&&q&&Z.U.Y("html5_refresh_deprecated_downloads"))){dD.xS(3);break}V=tKM(Z,q,B);return g.m(dD,uLW(Z,B),4);case 4:w=dD.D;case 3:A={lastPlayerResponseTimestampSeconds:W.playerResponseTimestamp,offlineToken:e.offlineToken,formatIds:w};F={};if((J=B)==null?0:J.maximumDownloadQuality)F.maximumDownloadQuality=
B.maximumDownloadQuality;g.ez(dD,5);v=void 0;return g.m(dD,hD$(Z,I),7);case 7:return v=dD.D,g.ez(dD,8),g.m(dD,mD0(d,Z.U,{refreshData:A,Ma:F,offlineSourceData:v,mediaCapabilities:V}),10);case 10:l=dD.D;g.gE(dD,9,5);break;case 8:return g.Bj(dD,5),X=tP(I)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",PL("PDE handleRefresh error"),dD.return(zp(I,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",X,"DOWNLOAD_STATE_FAILED"));
case 9:return g.m(dD,q7L(Z,l,I),11);case 11:return dD.return(zp(I,!0,l.orchestrationActions));case 5:return H=g.Bj(dD),x="PDE handleRefresh error",H instanceof Error&&(x="PDE handleRefresh error: "+H.message),Id="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",TB="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",H instanceof g.ox&&H.type==="QUOTA_EXCEEDED"&&(Id="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",TB="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),PL(x),dD.return(zp(I,
!1,void 0,Id,TB,"DOWNLOAD_STATE_FAILED"))}})},MJ3=function(Z){if(Z.includes(":"))throw Error("Invalid user cache name: "+Z);
return Z+":"+g.U0("CacheStorage get")},Ls0=function(Z,I,d,Y){var T,f,P,O,a,W,e,B,w,V,N,q,A,F,J,v,l,X,H,x,Id,TB,dD,Qu,Zr,sJ,bL,TL,jt,yu;
return g.h(function(UJ){switch(UJ.L){case 1:return g.m(UJ,ju(),2);case 2:T=UJ.D;if(!T)return UJ.return([]);f=[];if((P=Y)==null?0:P.length){f=Y;UJ.xS(3);break}return g.m(UJ,Tp(T,"musicPlaylist"),4);case 4:f=UJ.D;case 3:if(!f.length)return UJ.return([]);O=[];a=Date.now()/1E3;W=g.t(f);e=W.next();case 5:if(e.done)return O.length?g.m(UJ,EfV(O),10):UJ.return([]);B=e.value;w=void 0;N=(V=(w=B)==null?void 0:w.entityMetadata)&&V.nextAutoRefreshIntervalSeconds?Number(V.nextAutoRefreshIntervalSeconds):NaN;q=
Number.isNaN(N)?Z:N;F=A=0;J="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!B.downloadMetadata){UJ.xS(8);break}return g.m(UJ,BL(T,B.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:v=UJ.D,X=l=void 0,A=Number((X=(l=v)==null?void 0:l.addedTimestampMillis)!=null?X:"0")/1E3,x=H=void 0,F=Number((x=(H=v)==null?void 0:H.lastModifiedTimestampMillis)!=null?x:"0")/1E3,TB=Id=void 0,J=(TB=(Id=v)==null?void 0:Id.syncState)!=null?TB:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:dD=void 0;if(d||J!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!V||Number((dD=V.lastSyncedTimestampSeconds)!=null?dD:0)+q<=a){Qu=[];Zr=void 0;if((Zr=B.tracks)==null?0:Zr.length)for(sJ=g.t(B.tracks),bL=sJ.next();!bL.done;bL=sJ.next())TL=bL.value,Qu.push(g.VU(TL).entityId);jt={playlistId:B.playlistId,videoIds:Qu,offlineLastModifiedTimestamp:String(F.toFixed()),autoSync:I,offlineDateAddedTimestamp:String(A.toFixed())};O.push(jt)}e=W.next();UJ.xS(5);break;case 10:return yu=UJ.D,UJ.return(yu)}})},cyE=function(){return g.h(function(Z){if(Z.L==1)return g.m(Z,h_p(),
2);
if(!Z.D)return Z.return(void 0);r_d||(r_d=new Q_$);return Z.return(r_d)})},fkV=function(Z,I,d,Y){Y={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!Y};I&&d&&(I=Math.floor(I/1024).toFixed(),d=Math.floor(d/1024).toFixed(),Y.alreadyDownloadedKbytes=I,Y.totalFetchedKbytes=I,Y.totalContentKbytes=d);q8(Y,Z)},gT=function(Z,I,d,Y,T){g.p.call(this);
var f=this;this.D=Z;this.Ns=I;this.LS=d;this.V=Y;this.U=T;this.L=new Zcu;this.j=new g.HU;this.Z=new g.uX(function(){f.retry()});
this.X=NaN;this.B=!1;this.A9={un7:function(){return f.L},
Ti:function(){return f.j},
F7s:function(){return f.Z},
retry:function(){return f.retry()}};
g.z(this,this.Z);this.In=this.D.observe(this.kS.bind(this))},zot=function(Z,I){var d,Y,T,f,P,O;
return g.h(function(a){switch(a.L){case 1:if(Z.X)return a.return();Z.X=!0;Z.L=I;d=g.VU(Z.L.key);Y=d.entityId;T=void 0;if(Z.L.transferState==="TRANSFER_STATE_TRANSFERRING")return g.m(a,Ac(Z,Y),7);if(Z.L.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||Z.L.transferRetryCount||Z.L.hasLoggedFirstStarted){a.xS(3);break}return g.m(a,Ac(Z,Y),5);case 5:return T=a.D,Z.L.hasLoggedFirstStarted=!0,g.m(a,BLE(Z),6);case 6:fkV({videoId:Y,bW:Z.L,offlineModeType:T},void 0,void 0,!0);a.xS(3);break;case 7:T=a.D,
q8({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:Y,bW:Z.L,offlineModeType:T});case 3:return g.m(a,TMv(Z),8);case 8:return f=null,g.ez(a,9),g.m(a,zRW(Z,I),11);case 11:f=a.D;Z.B=f;g.gE(a,10);break;case 9:return P=g.Bj(a),PL("error getting player response",P,I.cotn),g.m(a,Z.IM("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return a.return();case 10:return O=ZA0(Z.api.C(),I.cotn,f),g.m(a,Inv(Z,O),13);case 13:return g.m(a,LUu(O.videoId),
14);case 14:O.LJ=a.D;var W=Z.V,e=O,B=I.maximumDownloadQuality;e.getPlayerResponse();g.wN(e.videoId,2);W.Z=2;W.D=!1;var w;(w=W.player)==null||w.dispose();W.player=W.api.UT(e);e={};W.player.vT((e.localmediachange=W.hQ,e.signatureexpired=W.jz,e.statechange=W.RFr,e),W);W.Y("html5_generate_content_po_token")&&W.player.dH();B=W.Jm(B);W.player.jw(g.J2(B,B,!0,"m"),!1);W.player.va(!1);Z.N.start(108E5);g.v6(a)}})},ZRp=function(Z){return new g.eq(function(I,d){var Y=Z.length,T=[];
if(Y)for(var f=function(W){d(W)},P=function(W,e){Y--;
T[W]=e;Y==0&&I(T)},O,a=0;a<Z.length;a++)O=Z[a],g.L_E(O,g.T9(P,a),f);
else I(T)})},hc=function(Z,I,d,Y,T){var f,P,O;
return g.h(function(a){if(a.L==1)return g.m(a,ju(),2);f=a.D;if(!f)return a.return([]);P=I.map(function(W){var e=g.Es(W,d);e={actionType:Y,entityKey:e,actionMetadata:Object.assign({},xjd(),T)};Y!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(e.actionMetadata.priority=0);W=new CJ(d,W,e);return yM(W)});
O=nVu(f,P);aLg(Z.Z);return a.return(O)})},aMt=function(Z,I,d){var Y,T,f,P,O,a,W,e,B,w,V,N,q,A,F,J,v,l;
return g.h(function(X){Y=[];T=new Set;if((f=d)==null?0:(P=f.downloadedTracks)==null?0:P.length)for(O=g.t(d.downloadedTracks),a=O.next();!a.done;a=O.next())W=a.value,T.add(W);if(Z.tracks){e=g.t(Z.tracks);for(B=e.next();!B.done;B=e.next())w=B.value,T.has(w)||Y.push(w);V=g.t(I);for(N=V.next();!N.done;N=V.next())if(q=N.value,q.id!==Z.id&&(A=q.tracks))for(F=g.t(A),J=F.next();!J.done;J=F.next())v=J.value,l=Y.indexOf(v),l!==-1&&Y.splice(l,1)}return X.return(Y)})};
g.GR.prototype.UT=g.rk(45,function(Z){return this.app.UT(Z)});
g.I_.prototype.UT=g.rk(44,function(Z){return g.fJ$(this,9,Z)});
g.U(kq,N8);g.LQ.Object.defineProperties(kq.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.L.entityMetadata},
set:function(Z){this.L.entityMetadata=Z}}});
g.U(Y73,kq);Y73.prototype.D=function(){return[]};
g.U(SBW,kq);SBW.prototype.D=function(){return[]};
g.U(H7d,kq);H7d.prototype.D=function(){return[]};
g.U(wrg,kq);wrg.prototype.D=function(){return[]};
g.U(ADv,kq);ADv.prototype.D=function(){return[]};
g.U(y6E,kq);y6E.prototype.D=function(){var Z=[];this.L.alternateChannel&&Z.push(this.L.alternateChannel);this.L.alternateChannelList&&Z.push.apply(Z,g.c(this.L.alternateChannelList));this.L.oneofChannelEntity&&Z.push(this.L.oneofChannelEntity);return[].concat(g.c(new Set(Z)))};
g.U(zDE,kq);zDE.prototype.D=function(){var Z=[];this.L.entryCollection&&Z.push(this.L.entryCollection);return[].concat(g.c(new Set(Z)))};
g.U(ve3,N8);ve3.prototype.D=function(){var Z=[];this.L.video&&Z.push(this.L.video);return[].concat(g.c(new Set(Z)))};
g.U(kCp,kq);kCp.prototype.D=function(){var Z=[];this.L.parentPlaylist&&Z.push(this.L.parentPlaylist);if(this.L.entries)for(var I=g.t(this.L.entries),d=I.next();!d.done;d=I.next())Z.push.apply(Z,g.c((new ve3(d.value)).D()));return[].concat(g.c(new Set(Z)))};
g.U(Htt,kq);Htt.prototype.D=function(){var Z=[];this.L.descriptionEntity&&Z.push(this.L.descriptionEntity);this.L.creators&&Z.push.apply(Z,g.c(this.L.creators));this.L.theBiggestFan&&Z.push(this.L.theBiggestFan);return[].concat(g.c(new Set(Z)))};
g.U(jDW,kq);jDW.prototype.D=function(){return[]};
g.U(A_u,kq);A_u.prototype.D=function(){return[]};
g.U(q0L,kq);q0L.prototype.D=function(){return[]};
g.U(nfp,kq);nfp.prototype.D=function(){return[]};
g.U(rb3,kq);rb3.prototype.D=function(){return[]};
g.U(bGv,kq);bGv.prototype.D=function(){return[]};
g.U(WKV,kq);WKV.prototype.D=function(){return[]};
g.U(tJg,kq);tJg.prototype.D=function(){return[]};
g.U(M6t,kq);M6t.prototype.D=function(){return[]};
g.U(HgE,kq);HgE.prototype.D=function(){var Z=[];this.L.downloadsList&&Z.push(this.L.downloadsList);this.L.smartDownloadsList&&Z.push(this.L.smartDownloadsList);this.L.recommendedDownloadsList&&Z.push(this.L.recommendedDownloadsList);this.L.refresh&&Z.push(this.L.refresh);return[].concat(g.c(new Set(Z)))};
g.U(uPu,N8);uPu.prototype.D=function(){var Z=[];this.L.video&&Z.push(this.L.video);this.L.playlist&&Z.push(this.L.playlist);this.L.videoItem&&Z.push(this.L.videoItem);this.L.playlistItem&&Z.push(this.L.playlistItem);return[].concat(g.c(new Set(Z)))};
g.U(xRg,kq);xRg.prototype.D=function(){var Z=[];this.L.refresh&&Z.push(this.L.refresh);if(this.L.downloads)for(var I=g.t(this.L.downloads),d=I.next();!d.done;d=I.next())Z.push.apply(Z,g.c((new uPu(d.value)).D()));return[].concat(g.c(new Set(Z)))};
g.U(iAV,kq);iAV.prototype.D=function(){var Z=[];this.L.localImageEntities&&Z.push.apply(Z,g.c(this.L.localImageEntities));return[].concat(g.c(new Set(Z)))};
g.U(m23,kq);m23.prototype.D=function(){var Z=[];this.L.playbackData&&Z.push(this.L.playbackData);this.L.localImageEntities&&Z.push.apply(Z,g.c(this.L.localImageEntities));this.L.videoDownloadContextEntity&&Z.push(this.L.videoDownloadContextEntity);return[].concat(g.c(new Set(Z)))};
g.U(btg,kq);btg.prototype.D=function(){return[]};
g.U(YB3,kq);YB3.prototype.D=function(){var Z=[];this.L.fakeChildren&&Z.push.apply(Z,g.c(this.L.fakeChildren));return[].concat(g.c(new Set(Z)))};
g.U(NMt,kq);NMt.prototype.D=function(){var Z=[];this.L.video&&Z.push(this.L.video);this.L.playbackData&&Z.push(this.L.playbackData);this.L.offlineVideoPolicy&&Z.push(this.L.offlineVideoPolicy);return[].concat(g.c(new Set(Z)))};
g.U(jC0,kq);jC0.prototype.D=function(){return[]};
g.U(U23,kq);U23.prototype.D=function(){var Z=[];this.L.channelOwner&&Z.push(this.L.channelOwner);this.L.videos&&Z.push.apply(Z,g.c(this.L.videos));this.L.collaboratorChannels&&Z.push.apply(Z,g.c(this.L.collaboratorChannels));this.L.downloadState&&Z.push(this.L.downloadState);this.L.refresh&&Z.push(this.L.refresh);return[].concat(g.c(new Set(Z)))};
g.U(b73,kq);b73.prototype.D=function(){var Z=[];this.L.video&&Z.push(this.L.video);this.L.channelContributor&&Z.push(this.L.channelContributor);return[].concat(g.c(new Set(Z)))};
g.U(rO0,N8);rO0.prototype.D=function(){var Z=[];this.L.localImageEntities&&Z.push.apply(Z,g.c(this.L.localImageEntities));this.L.videoDownloadContextEntity&&Z.push(this.L.videoDownloadContextEntity);return[].concat(g.c(new Set(Z)))};
g.U(PUg,N8);PUg.prototype.D=function(){var Z=[];this.L.recommendedVideoMetadata&&Z.push.apply(Z,g.c((new rO0(this.L.recommendedVideoMetadata)).D()));return[].concat(g.c(new Set(Z)))};
g.U(hQp,N8);hQp.prototype.D=function(){var Z=[];this.L.playbackPosition&&Z.push(this.L.playbackPosition);return[].concat(g.c(new Set(Z)))};
g.U(t80,kq);t80.prototype.D=function(){var Z=[];this.L.owner&&Z.push(this.L.owner);this.L.downloadState&&Z.push(this.L.downloadState);this.L.userState&&Z.push.apply(Z,g.c((new hQp(this.L.userState)).D()));this.L.additionalMetadata&&Z.push.apply(Z,g.c((new PUg(this.L.additionalMetadata)).D()));return[].concat(g.c(new Set(Z)))};
g.U(gfE,kq);gfE.prototype.D=function(){var Z=[];this.L.userChannelDetails&&Z.push(this.L.userChannelDetails);return[].concat(g.c(new Set(Z)))};
g.U(eRE,kq);eRE.prototype.D=function(){var Z=[];this.L.channelOwner&&Z.push(this.L.channelOwner);this.L.playbackPosition&&Z.push(this.L.playbackPosition);this.L.localImageEntities&&Z.push.apply(Z,g.c(this.L.localImageEntities));this.L.downloadStatus&&Z.push(this.L.downloadStatus);return[].concat(g.c(new Set(Z)))};
g.U(HAi,kq);HAi.prototype.D=function(){return[]};
g.U(VkV,kq);VkV.prototype.D=function(){return[]};
g.U(fM$,kq);fM$.prototype.D=function(){return[]};
g.U(lkW,kq);lkW.prototype.D=function(){return[]};
g.U(URE,kq);URE.prototype.D=function(){return[]};
g.U(KsL,kq);KsL.prototype.D=function(){return[]};
g.U($KW,kq);$KW.prototype.D=function(){return[]};
g.U(FKv,kq);FKv.prototype.D=function(){return[]};
g.U(OgW,kq);OgW.prototype.D=function(){return[]};
g.U(g6t,kq);g6t.prototype.D=function(){return[]};
g.U(MqM,kq);MqM.prototype.D=function(){return[]};
g.U(lfW,kq);lfW.prototype.D=function(){return[]};
g.U(mfg,kq);mfg.prototype.D=function(){return[]};
g.U(j_t,kq);j_t.prototype.D=function(){var Z=[];this.L.compositeSourceKeys&&Z.push.apply(Z,g.c(this.L.compositeSourceKeys));return[].concat(g.c(new Set(Z)))};
g.U(Yy3,kq);Yy3.prototype.D=function(){var Z=[];this.L.trackDownloadMetadatas&&Z.push.apply(Z,g.c(this.L.trackDownloadMetadatas));return[].concat(g.c(new Set(Z)))};
g.U(S4v,kq);
S4v.prototype.D=function(){var Z=[];this.L.downloadedTracks&&Z.push.apply(Z,g.c(this.L.downloadedTracks));this.L.smartDownloadedTracks&&Z.push.apply(Z,g.c(this.L.smartDownloadedTracks));this.L.downloadedEpisodes&&Z.push.apply(Z,g.c(this.L.downloadedEpisodes));this.L.downloadedAlbumReleases&&Z.push.apply(Z,g.c(this.L.downloadedAlbumReleases));this.L.smartDownloadedAlbumReleases&&Z.push.apply(Z,g.c(this.L.smartDownloadedAlbumReleases));this.L.downloadedPlaylists&&Z.push.apply(Z,g.c(this.L.downloadedPlaylists));this.L.smartDownloadedPlaylists&&
Z.push.apply(Z,g.c(this.L.smartDownloadedPlaylists));this.L.metadataOnlyTracks&&Z.push.apply(Z,g.c(this.L.metadataOnlyTracks));return[].concat(g.c(new Set(Z)))};
g.U(v0$,kq);v0$.prototype.D=function(){var Z=[];this.L.trackDownloadMetadatas&&Z.push.apply(Z,g.c(this.L.trackDownloadMetadatas));return[].concat(g.c(new Set(Z)))};
g.U($fg,kq);$fg.prototype.D=function(){var Z=[];this.L.playbackData&&Z.push(this.L.playbackData);this.L.localImageEntities&&Z.push.apply(Z,g.c(this.L.localImageEntities));this.L.videoDownloadContextEntity&&Z.push(this.L.videoDownloadContextEntity);return[].concat(g.c(new Set(Z)))};
g.U(hoL,kq);hoL.prototype.D=function(){var Z=[];this.L.musicLibraryStatusEntity&&Z.push(this.L.musicLibraryStatusEntity);this.L.primaryArtists&&Z.push.apply(Z,g.c(this.L.primaryArtists));this.L.details&&Z.push(this.L.details);this.L.userDetails&&Z.push(this.L.userDetails);this.L.tracks&&Z.push.apply(Z,g.c(this.L.tracks));this.L.share&&Z.push(this.L.share);this.L.downloadMetadata&&Z.push(this.L.downloadMetadata);this.L.refresh&&Z.push(this.L.refresh);return[].concat(g.c(new Set(Z)))};
g.U(r6V,kq);r6V.prototype.D=function(){var Z=[];this.L.albumRelease&&Z.push(this.L.albumRelease);this.L.tracks&&Z.push.apply(Z,g.c(this.L.tracks));return[].concat(g.c(new Set(Z)))};
g.U(sKg,kq);sKg.prototype.D=function(){var Z=[];this.L.albumRelease&&Z.push(this.L.albumRelease);return[].concat(g.c(new Set(Z)))};
g.U(W$d,kq);W$d.prototype.D=function(){var Z=[];this.L.details&&Z.push(this.L.details);this.L.userDetails&&Z.push(this.L.userDetails);return[].concat(g.c(new Set(Z)))};
g.U(V8g,kq);V8g.prototype.D=function(){var Z=[];this.L.parentArtist&&Z.push(this.L.parentArtist);return[].concat(g.c(new Set(Z)))};
g.U(F$p,kq);F$p.prototype.D=function(){var Z=[];this.L.parentArtist&&Z.push(this.L.parentArtist);return[].concat(g.c(new Set(Z)))};
g.U(mji,kq);mji.prototype.D=function(){return[]};
g.U(ceL,kq);ceL.prototype.D=function(){return[]};
g.U(oVW,N8);oVW.prototype.D=function(){var Z=[];this.L.creatorEntity&&Z.push(this.L.creatorEntity);return[].concat(g.c(new Set(Z)))};
g.U(WDv,kq);
WDv.prototype.D=function(){var Z=[];this.L.tracks&&Z.push.apply(Z,g.c(this.L.tracks));this.L.refresh&&Z.push(this.L.refresh);this.L.musicLibraryStatusEntity&&Z.push(this.L.musicLibraryStatusEntity);this.L.details&&Z.push(this.L.details);this.L.downloadMetadata&&Z.push(this.L.downloadMetadata);this.L.sideloadMetadata&&Z.push(this.L.sideloadMetadata);this.L.userDetails&&Z.push(this.L.userDetails);this.L.entryCollection&&Z.push(this.L.entryCollection);this.L.share&&Z.push(this.L.share);this.L.podcastShowAdditionalMetadata&&Z.push.apply(Z,
g.c((new oVW(this.L.podcastShowAdditionalMetadata)).D()));return[].concat(g.c(new Set(Z)))};
g.U(UDW,kq);UDW.prototype.D=function(){return[]};
g.U(CxM,kq);
CxM.prototype.D=function(){var Z=[];this.L.musicLibraryStatusEntity&&Z.push(this.L.musicLibraryStatusEntity);this.L.artists&&Z.push.apply(Z,g.c(this.L.artists));this.L.audioModeVersion&&Z.push(this.L.audioModeVersion);this.L.videoModeVersion&&Z.push(this.L.videoModeVersion);this.L.userDetails&&Z.push(this.L.userDetails);this.L.details&&Z.push(this.L.details);this.L.albumRelease&&Z.push(this.L.albumRelease);this.L.share&&Z.push(this.L.share);this.L.libraryEdit&&Z.push(this.L.libraryEdit);this.L.downloadMetadata&&
Z.push(this.L.downloadMetadata);this.L.playbackPosition&&Z.push(this.L.playbackPosition);this.L.lyrics&&Z.push(this.L.lyrics);return[].concat(g.c(new Set(Z)))};
g.U(sC0,kq);sC0.prototype.D=function(){var Z=[];this.L.parentTrack&&Z.push(this.L.parentTrack);return[].concat(g.c(new Set(Z)))};
g.U(e_V,kq);e_V.prototype.D=function(){var Z=[];this.L.parentTrack&&Z.push(this.L.parentTrack);return[].concat(g.c(new Set(Z)))};
g.U(KS$,kq);KS$.prototype.D=function(){return[]};
g.U(HGi,kq);HGi.prototype.D=function(){return[]};
g.U(ESd,kq);ESd.prototype.D=function(){return[]};
g.U(Ijg,kq);Ijg.prototype.D=function(){return[]};
g.U(Y2g,kq);Y2g.prototype.D=function(){var Z=[];this.L.transfer&&Z.push(this.L.transfer);this.L.adsPlaybackData&&Z.push.apply(Z,g.c(this.L.adsPlaybackData));this.L.drmLicense&&Z.push(this.L.drmLicense);this.L.offlineVideoPolicy&&Z.push(this.L.offlineVideoPolicy);this.L.videoDownloadContextEntity&&Z.push(this.L.videoDownloadContextEntity);return[].concat(g.c(new Set(Z)))};
g.U(Dfg,kq);Dfg.prototype.D=function(){return[]};
g.U(sDg,kq);sDg.prototype.D=function(){var Z=[];this.L.offlineVideoStreams&&Z.push.apply(Z,g.c(this.L.offlineVideoStreams));this.L.captionTrack&&Z.push.apply(Z,g.c(this.L.captionTrack));return[].concat(g.c(new Set(Z)))};
g.U(C9p,kq);C9p.prototype.D=function(){return[]};
g.U(Nzu,kq);Nzu.prototype.D=function(){return[]};
g.U($jE,kq);$jE.prototype.D=function(){return[]};
g.U(bud,kq);bud.prototype.D=function(){return[]};
g.U(Kc0,kq);Kc0.prototype.D=function(){return[]};
g.U(k5E,kq);k5E.prototype.D=function(){return[]};
g.U(jzE,kq);jzE.prototype.D=function(){return[]};
g.U(prt,kq);prt.prototype.D=function(){return[]};
g.U(ajM,kq);ajM.prototype.D=function(){return[]};
g.U(GRv,kq);GRv.prototype.D=function(){return[]};
g.U(Zui,kq);Zui.prototype.D=function(){return[]};
g.U(T5d,kq);T5d.prototype.D=function(){return[]};
g.U(wI$,kq);wI$.prototype.D=function(){return[]};
g.U(hRd,kq);hRd.prototype.D=function(){return[]};
g.U(Lci,kq);Lci.prototype.D=function(){return[]};
g.U(bg3,kq);bg3.prototype.D=function(){return[]};
g.U(mVg,kq);mVg.prototype.D=function(){return[]};
g.U(VLM,kq);VLM.prototype.D=function(){return[]};
g.U(t6v,kq);t6v.prototype.D=function(){return[]};
g.U(AyE,kq);AyE.prototype.D=function(){return[]};
g.U(g00,kq);g00.prototype.D=function(){return[]};
g.U(jK$,kq);jK$.prototype.D=function(){return[]};
var dfW=["browse","music/browse","unplugged/browse"],iGd=["offline/playlist_sync_check"],x2V=["offline"],kou=["offline/offline_video_playback_position_sync"],X6M=["offline/get_playback_data_entity"],Io;eu.getInstance=function(){return g.h(function(Z){return Z.return(new Promise(function(I){g.k_().then(function(d){d?(eu.instance||(eu.instance=new eu(d)),I(eu.instance)):I(void 0)})}))})};
eu.prototype.get=function(Z){var I=this,d,Y,T;return g.h(function(f){if(f.L==1)return g.m(f,cOV(I.token),2);if(f.L!=3)return d=f.D,g.m(f,d.get("prefs",Z),3);Y=f.D;if(!Y)return f.return();T=(0,g.o8)();return Y.expirationTimestampMs<=T?f.return():f.return(Y.value)})};
eu.prototype.set=function(Z,I,d){d=d===void 0?31536E3:d;var Y=this,T,f,P;return g.h(function(O){if(O.L==1)return T=(0,g.o8)(),f={key:Z,value:I,expirationTimestampMs:T+d*1E3},g.m(O,cOV(Y.token),2);P=O.D;return g.m(O,g.ay(P,"prefs",f),0)})};
eu.prototype.remove=function(Z){var I=this,d;return g.h(function(Y){if(Y.L==1)return g.m(Y,cOV(I.token),2);d=Y.D;return g.m(Y,d.delete("prefs",Z),0)})};
g.U(F$,g.Wj);g.U(wT,Y4v);wT.prototype.Z=function(Z,I){I=Xrv(I);Z=(new TextEncoder).encode(JSON.stringify(Z));return this.L.encrypt(Z,I)};
wT.prototype.D=function(Z,I){if(!(Z instanceof Uint8Array))throw JOV(1);var d=new TextDecoder;I=Xrv(I);Z=this.L.decrypt(Z,I);return JSON.parse(d.decode(Z))};
var Pxg={accountLinkStatusEntity:q0L,booleanEntity:wrg,buttonEntity:Lci,captionTrack:KS$,channelHandle:Y73,chipEntity:jzE,commerceAcquisitionClientPayloadEntity:mVg,commerceCartListEntity:VLM,compositeSourceEntity:mfg,multiviewStagingEntity:j_t,contextNoteFeedEntityPayload:SBW,contextNoteUserRatingEntityPayload:H7d,continuationTokenEntity:jC0,downloadQualityPickerEntity:WKV,downloadsPageRefreshTokenEntity:M6t,downloadsPageViewConfigurationEntity:HAi,downloadStatusEntity:tJg,dismissState:prt,sfvAudioItemCurrentlyPlayingEntity:bud,
emojiFountainDataEntity:wI$,emojiCustomizationSetEntity:T5d,fakeChannel:y6E,fakePlaylist:zDE,fakePlaylistEntryCollection:kCp,fakeVideo:Htt,fakeVideoDescription:jDW,featuredProductsEntity:g6t,flowStateEntity:A_u,iconBadgeEntity:t6v,interstitialInteractionStateEntity:rb3,likeButtonAnimationEntity:VkV,liveChatPollStateEntity:bGv,dataFreshnessEntity:Zui,liveViewerLeaderboardChatEntryPointStateEntity:Nzu,liveViewerLeaderboardPointsEntity:$jE,liveReactionsDataEntity:hRd,logoEntity:nfp,macroMarkerEntity:fM$,
mainDownloadsLibraryEntity:HgE,mainDownloadsListEntity:xRg,mainPlaylistDownloadStateEntity:iAV,mainPlaylistEntity:U23,mainPlaylistVideoEntity:b73,mainVideoDownloadStateEntity:m23,mainVideoEntity:t80,markersEngagementPanelSyncEntity:lkW,markersVisibilityOverrideEntity:URE,musicAlbumReleaseDetail:r6V,musicAlbumReleaseDownloadMetadataEntity:Yy3,musicAlbumRelease:hoL,musicAlbumReleaseUserDetail:sKg,musicArtistDetail:V8g,musicArtist:W$d,musicArtistUserDetail:F$p,musicDownloadsLibraryEntity:S4v,musicLibraryEdit:mji,
musicLibraryStatusEntity:ceL,musicPlaylist:WDv,musicPlaylistDownloadMetadataEntity:v0$,musicShare:UDW,musicTrackDetail:sC0,musicTrackDownloadMetadataEntity:$fg,musicTrack:CxM,musicTrackUserDetail:e_V,offlineOrchestrationActionWrapperEntity:HGi,offlineVideoPolicy:ESd,offlineVideoStreams:Ijg,offlineabilityEntity:btg,orchestrationWebSamplingEntity:YB3,pageHeaderEntity:ajM,pdpStateEntity:AyE,pinnedProductEntity:MqM,playbackData:Y2g,playerStateEntity:KsL,quantityIncrementerEntity:g00,refresh:Dfg,saveToPlaylistListEntity:Kc0,
selectedChipIndexEntityPayload:$KW,settingEntity:k5E,stringEntity:ADv,suggestedFeedbackChipStateEntity:FKv,transfer:sDg,trendingOfferEntity:lfW,videoDownloadContextEntity:C9p,videoOverviewAsyncDataEntity:jK$,videoPlaybackPositionEntity:bg3,votingEntity:GRv,ytMainChannelEntity:gfE,youchatPendingResponseEntity:OgW,ytMainDownloadedVideoEntity:NMt,ytMainVideoEntity:eRE};g.U(KJ,Y4v);KJ.prototype.Z=function(Z){return Z};
KJ.prototype.D=function(Z){if(Z instanceof Uint8Array)throw JOV(0);return Z};
g.U(Gp,g.p);Gp.prototype.observe=function(Z){var I=this;this.observers.push(Z);return function(){var d=I.observers.indexOf(Z);d>=0&&I.observers.splice(d,1)}};
Gp.prototype.D=function(Z){pIW(this,Z.data)};
Gp.prototype.g4=function(){this.channel.close()};
var yeg,A6d=new g.oZ("elementsCommand");var DP=new g.oZ("entityBatchUpdate");var yOE=new g.oZ("downloadStatusEntity");var zkt=new g.oZ("mainPlaylistEntityActionMetadata");var vL=new g.oZ("mainVideoEntityActionMetadata");var uWu=new g.oZ("musicPlaylistEntityActionMetadata");var Tzu=new g.oZ("musicTrackEntityActionMetadata");var Je$=new g.oZ("localImageEntityActionMetadata");var nJ=new g.oZ("playbackDataActionMetadata");var VqM=new g.oZ("transferEntityActionMetadata");var UfE=new g.oZ("videoPlaybackPositionEntityActionMetadata");var hkW;new g.f2;new g.f2;Nng.prototype.request=function(Z,I,d){I=I===void 0?{}:I;return this.locks.request(Z,I,function(Y){return d(Y)})};var rT=g.iN.caches,M8,r_d;HL.prototype.open=function(Z){return rT.open(MJ3(Z))};
HL.prototype.has=function(Z){return rT.has(MJ3(Z))};
HL.prototype.delete=function(Z){return rT.delete(MJ3(Z))};
HL.prototype.match=function(Z,I){var d=this,Y,T,f,P,O,a;return g.h(function(W){switch(W.L){case 1:return g.m(W,d.keys(),2);case 2:Y=W.D,T=g.t(Y),f=T.next();case 3:if(f.done){W.xS(5);break}P=f.value;return g.m(W,d.open(P),6);case 6:return O=W.D,g.m(W,O.match(Z,I),7);case 7:if(a=W.D)return W.return(a);f=T.next();W.xS(3);break;case 5:return W.return()}})};
g.U(Q_$,HL);Q_$.prototype.keys=function(){var Z,I,d,Y,T,f,P,O,a;return g.h(function(W){if(W.L==1)return Z=[],I=g.U0("CacheStorage keys"),g.m(W,rT.keys(),2);d=W.D;Y=g.t(d);for(T=Y.next();!T.done;T=Y.next()){f=T.value;var e=f.indexOf(":");P=e===-1?{Xt:f}:{Xt:f.substring(0,e),datasyncId:f.substring(e+1)};O=P.Xt;a=P.datasyncId;a===I&&Z.push(O)}return W.return(Z)})};g.U(Su,g.p);Su.prototype.Z=function(Z){this.api.Rn("onOfflineOperationFailure",Z.data)};
Su.prototype.N=function(Z){this.api.publish("offlinetransferpause",Z.data)};
Su.prototype.g4=function(){var Z;(Z=this.L)==null||Z.close();var I;(I=this.D)==null||I.close()};Y0t.prototype.XQ=function(){this.L&&XQ(this)};
Y0t.prototype.f7=function(){this.D&&this.D.resolve();this.Z=this.L=!1;this.In()};var QC3=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var KKi="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var KUv="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.U(oS0,bh);oS0.prototype.D=function(Z){return ZI(Z)?S7d(this,Z):mJ(Z)?gSV(this,Z):Promise.reject(Error("Unsupported action type: "+Z.actionType))};g.U($D$,bh);$D$.prototype.D=function(Z){return mJ(Z)?wv0(this,Z):yyp(Z)?y_u(this,Z):pJ(Z)?p7W(this,Z):Promise.reject(Error("Unsupported action type: "+Z.actionType))};g.n=tLp.prototype;g.n.RFr=function(Z){var I=this,d,Y,T,f;return g.h(function(P){if(!g.b(Z.state,128))return P.xS(0);d=Z.state.Em;var O=(Y=d)==null?void 0:Y.errorCode,a=(T=d)==null?void 0:T.Ne;f=O==="net.connect"&&a===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(O==null?0:O.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.m(P,I.IM(I.player.getVideoData().videoId,f),0)})};
g.n.IM=function(Z,I){var d=this;return g.h(function(Y){if(Y.L==1){if(d.D)return Y.return();d.D=!0;return I==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(VM(d,Z,!1,!0),Y.xS(0)):g.m(Y,Yd(d,Z),3)}g.wN(Z,4);return g.m(Y,d.L.IM(I),0)})};
g.n.hQ=function(Z){Z.status===2?(Z.status!==this.Z&&(TMv(this.L),g.wN(Z.videoId,2)),Z.Xh&&Pgp(this.L,Z.videoId,Z.Xh)):Z.status===4?(Yd(this,Z.videoId),this.IM(Z.videoId,Z.DJ?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):Z.status===1&&o6V(this.L);this.Z=Z.status;this.api.Rn("localmediachange",{videoId:Z.videoId,status:Z.status})};
g.n.jz=function(){var Z=this,I;return g.h(function(d){if(d.L==1){if(Z.D)return d.return();Z.D=!0;I=Z.player.getVideoData().videoId;return g.m(d,Yd(Z,I),2)}return g.m(d,Z.L.jz(),0)})};
g.n.Jm=function(Z){switch(Z){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.n.Y=function(Z){return this.api.C().Y(Z)};g.U(c_E,bh);c_E.prototype.D=function(Z){return ZI(Z)?G50(this,Z):mJ(Z)?kKp(this,Z):yyp(Z)?xfg(this,Z):Promise.reject(Error("Unsupported action type: "+Z.actionType))};Zcu.prototype.L=function(Z,I){var d=Z.action.actionMetadata.priority-I.action.actionMetadata.priority;d===0&&(Z.L<I.L?d=-1:Z.L>I.L&&(d=1));return d};g.U(gT,g.p);gT.prototype.g4=function(){this.In&&this.In();g.p.prototype.g4.call(this)};
gT.prototype.createAction=function(Z,I){var d=g.VU(Z.entityKey).entityType,Y=g.LY(16);return new CJ(d,Y,Z,I.actionId,I.rootActionId)};
gT.prototype.kS=function(Z){var I=this,d,Y,T,f,P,O,a,W,e;return g.h(function(B){if(B.L==1){if(I.OZ())return B.return();Y=(d=Z.offlineOrchestrationActionWrapperEntity)!=null?d:new Set;T=[];f=g.t(Y);for(P=f.next();!P.done;P=f.next())O=P.value,a=g.VU(O),W=a.entityId,S2L(I.L,W)||T.push(O);return g.m(B,q2v(I,T),2)}e=B.D;return g.m(B,AOM(I,e),0)})};
gT.prototype.retry=function(){var Z=this;return g.h(function(I){return g.m(I,DjW(Z),0)})};nSu.prototype.GD=function(Z,I){I=I===void 0?!0:I;var d=this,Y,T,f,P,O,a,W,e;return g.h(function(B){switch(B.L){case 1:if(!d.L)return B.return();Y=[];T=g.a3(d.L.D,I);f=[];for(P={wI:0};P.wI<T.length;P={wI:P.wI},P.wI++)O=T[P.wI],a=d.L.bK(O,"json3"),W=g.WV(a,{withCredentials:!0,format:"RAW"},3,500).then(function(w){return function(V){V={metadata:g.m5(T[w.wI]),trackData:V.xhr.responseText};f.push(V)}}(P)).LA(function(w){PL("Caption fetch error",w)}),Y.push(W);
return g.m(B,ZRp(Y),2);case 2:return g.ez(B,3),g.m(B,cbE(Z,f),5);case 5:g.gE(B,0);break;case 3:e=g.Bj(B),PL("Caption DB transaction error",e),g.v6(B)}})};g.U(tc,g.p);tc.prototype.g4=function(){this.D&&this.D();g.p.prototype.g4.call(this)};
tc.prototype.Z=function(Z){var I=this,d,Y,T,f,P,O,a,W;return g.h(function(e){Y=(d=Z.transfer)!=null?d:new Set;T=[];f=g.t(Y);for(P=f.next();!P.done;P=f.next())O=P.value,a=g.VU(O),W=a.entityId,T.push(W);return T.length===0?e.return():g.m(e,E6g(I,T),0)})};g.U(VJ3,g.p);g.n=VJ3.prototype;g.n.g4=function(){this.Ns&&this.Ns();this.Bj.dispose();this.N.dispose();this.mJ&&g.JX(this.j.Sd,this.mJ);this.j7&&g.JX(this.j.Sd,this.j7);g.p.prototype.g4.call(this)};
g.n.mIm=function(Z){var I=this,d,Y,T;return g.h(function(f){switch(f.L){case 1:d=g.Es(Z,"transfer");if(I.L&&d===I.L.key){VM(I.V,I.B,!0);I.N.stop();f.xS(0);break}return g.m(f,KT(I.D,{mode:"readwrite",OU:!0},function(P){return dT(P,d,"transfer").then(function(O){if(O&&O.transferState!=="TRANSFER_STATE_COMPLETE"&&O.transferState!=="TRANSFER_STATE_FAILED")return O.transferState="TRANSFER_STATE_PAUSED_BY_USER",oF(P,O,"transfer").then(function(){return O})})}),3);
case 3:Y=f.D;if(!Y){f.xS(0);break}if(!Z||!I.Z){f.xS(5);break}return g.m(f,Jc(Z,I.Z,I.D,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.m(f,Ac(I,Z),7);case 7:T=f.D,lL0({videoId:Z,bW:Y,offlineModeType:T}),g.v6(f)}})};
g.n.zXm=function(){var Z=this;if(this.L&&this.B){VM(this.V,this.B,!1);var I=this.L,d=(I==null?0:I.key)?g.VU(I.key).entityId:"";d&&this.Z&&(new Promise(function(Y,T){Jc(d,Z.Z,Z.D,"DOWNLOAD_STATE_PAUSED").catch(function(f){T(f)})})).catch(function(Y){PL("Download state setting error",Y)})}this.N.stop()};
g.n.Nd=function(){this.L?zot(this,this.L):fJ(this)};
g.n.Re=function(Z){var I=this;return g.h(function(d){switch(d.L){case 1:if(!I.L){d.xS(2);break}if(I.L.transferState==="TRANSFER_STATE_COMPLETE"||I.L.transferState==="TRANSFER_STATE_FAILED"||!Z.transfer||!Z.transfer.has(I.L.key)){d.xS(3);break}return g.m(d,BL(I.D,I.L.key,"transfer"),4);case 4:I.L=d.D;if(I.L){d.xS(3);break}return g.m(d,sZp(I),3);case 3:if(I.L)return d.return();case 2:return g.m(d,fJ(I),0)}})};
g.n.IM=function(Z,I){var d=this,Y,T,f,P,O;return g.h(function(a){switch(a.L){case 1:if(!d.L){rs(d,"onTransferFailure: "+Z);a.xS(2);break}Y=d.L;f=((T=Y)==null?0:T.key)?g.VU(Y.key).entityId:"";a:switch(Z){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var W=!1;break a;default:W=!0}return W&&R_M(d)?g.m(a,IF(d,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.m(a,
KD$(d,Z),5);case 5:if(!f||!d.Z){a.xS(2);break}return g.m(a,Jc(f,d.Z,d.D,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.m(a,Ac(d,f),9);case 9:P=a.D;q8({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:f,bW:Y,offlineModeType:P});if(!f||!d.Z){a.xS(2);break}return g.m(a,Jc(f,d.Z,d.D,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:Ms(d),O=fJ(d,!0),I&&I(O),g.v6(a)}})};
g.n.jz=function(Z){var I=this,d,Y,T,f,P,O,a,W,e,B,w,V;return g.h(function(N){switch(N.L){case 1:if(!I.L){rs(I,"onMaybeTransferStreamsExpired");N.xS(2);break}return R_M(I)?g.m(N,IF(I,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.m(N,KD$(I,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!I.Z){N.xS(2);break}d=I.L;T=((Y=d)==null?0:Y.key)?g.VU(d.key).entityId:"";if(!T){N.xS(2);break}return g.m(N,Jc(T,I.Z,I.D,"DOWNLOAD_STATE_FAILED"),2);case 9:return I.L||rs(I,"onMaybeTransferStreamsExpiredRetryAttempting"),
f=I.L,O=((P=f)==null?0:P.key)?g.VU(f.key).entityId:"",g.m(N,Ac(I,O),10);case 10:return a=N.D,q8({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:O,bW:f,offlineModeType:a}),W=xjd(),g.tQ(W,nJ,{isEnqueuedForExpiredStreamUrlRefetch:!0}),e=g.Es(O,"playbackData"),B={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:e,actionMetadata:W},w=yM(new CJ("playbackData",O,B)),g.m(N,ih(I.D,w,"offlineOrchestrationActionWrapperEntity"),2);case 2:Ms(I),V=fJ(I,!0),
Z&&Z(V),g.v6(N)}})};
var I8d={},Hci=(I8d.TRANSFER_STATE_TRANSFERRING=1,I8d.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,I8d);g.n=WL.prototype;g.n.ZK=function(){return this.B.promise};
g.n.ST=function(){if(this.D&&this.V)return this.B.promise;FcL(this).then(this.B.resolve).catch(this.B.reject);return this.B.promise};
g.n.WH=function(Z){var I={};return I.playbackData=new oS0(Z,this.U,this.L),I.transfer=new c_E(Z,this.U),I.videoPlaybackPositionEntity=new $D$(Z,this.U),I};
g.n.o3=function(){var Z=this;return g.h(function(I){return Z.D?g.m(I,bAv(Z.D),0):I.xS(0)})};
g.n.Yg=function(){var Z=this,I,d;return g.h(function(Y){if(Y.L==1)return Z.D||Z.V?g.m(Y,Z.ZK(),2):Y.return();Z.X!==void 0&&(g.g0(Z.X),Z.X=void 0);Z.N!==void 0&&(g.g0(Z.N),Z.N=void 0);(I=Z.D)==null||I.dispose();Z.D=void 0;(d=Z.V)==null||d.dispose();Z.V=void 0;Z.api.Rn("onOrchestrationLostLeader");Z.B=new g.f2;g.v6(Y)})};
g.n.isOrchestrationLeader=function(){return this.Z.L};
g.n.dk=function(){return g.h(function(Z){return Z.return(!1)})};
g.n.yv=function(Z){var I=this.L;I.api.publish("offlinetransferpause",Z);var d;(d=I.D)==null||d.postMessage(Z)};
g.n.Nd=function(Z){var I,d;return g.h(function(Y){if(Y.L==1)return g.m(Y,ju(),2);I=Y.D;if(!I)return Y.return();d=g.Es(Z,"transfer");return g.m(Y,KT(I,{mode:"readwrite",OU:!0},function(T){var f=dT(T,d,"transfer"),P=dT(T,g.Es(Z,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.WD.all([f,P]).then(function(O){O=g.t(O);var a=O.next().value;var W=O.next().value;return a&&a.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(a.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",oF(T,a,"transfer").then(function(){q8({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:Z,bW:a,offlineModeType:W==null?void 0:W.offlineModeType});return g.WD.resolve(null)})):g.WD.resolve(null)})}),0)})};
g.n.f4=function(Z){Z=Z===void 0?43200:Z;var I=this,d,Y,T,f,P,O,a,W;return g.h(function(e){if(e.L==1)return I.j.QQ()?g.m(e,ju(),2):e.return(DV3());if(e.L!=3){d=e.D;if(!d)return e.return([]);Y=Date.now()/1E3;return g.m(e,Tp(d,"offlineVideoPolicy"),3)}T=e.D;f=[];P=g.t(T);for(O=P.next();!O.done;O=P.next())a=O.value,Number(a.lastUpdatedTimestampSeconds)+Z<=Y&&(W=g.VU(a.key).entityId,f.push(W));return f.length?e.return(hc(I,f,I.In,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):e.return([])})};
g.n.deleteAll=function(){return hc(this,["!*$_ALL_ENTITIES_!*$"],this.In,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.n.refreshAllStaleEntities=function(Z){var I=this;return g.h(function(d){return d.L==1?g.m(d,I.f4(Z),2):d.return(d.D)})};
g.n.setUpPositionSyncInterval=function(Z){var I=this;this.N!==void 0&&(g.g0(this.N),this.N=void 0);var d=Z!=null?Z:864E5;this.N=g.ly(function(){I.LI(d)},d)};
g.n.LI=function(Z){var I=this,d,Y,T,f,P,O;return g.h(function(a){switch(a.L){case 1:return g.ez(a,2),g.m(a,eu.getInstance(),4);case 4:d=a.D;if(!d)throw Error("prefStorage is undefined");return g.m(a,d.get("psi"),5);case 5:Y=a.D;f=((T=Y)==null?0:T.VY)?Number(Y.VY)/1E3:0;P=Date.now();if(!(f+Z<=P)){a.xS(6);break}return g.m(a,hc(I,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.gE(a,0);break;case 2:O=g.Bj(a),PL("Offline manager error",O),
g.v6(a)}})};
g.n.wg=function(){var Z=this,I,d,Y,T,f,P,O;return g.h(function(a){if(a.L==1)return g.m(a,ju(),2);if(a.L!=3)return(I=a.D)?g.m(a,Tp(I,"transfer"),3):a.return([]);d=a.D;Y=[];T=g.t(d);for(f=T.next();!f.done;f=T.next())P=f.value,P.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&P.key&&(O=g.VU(P.key).entityId,Y.push(O));return a.return(K$d(Z,Y))})};
g.n.QG=function(){return g.h(function(Z){return Z.return([])})};
g.n.aP=function(){return g.h(function(Z){g.v6(Z)})};
g.n.sJ=function(){return g.h(function(Z){g.v6(Z)})};g.U(E00,bh);E00.prototype.D=function(Z){return ZI(Z)?VKu(this,Z):mJ(Z)?kx0(this,Z):pJ(Z)?$2g(this,Z):Promise.reject(Error("Unsupported action type: "+Z.actionType))};
var xd=[10];g.U(CUW,bh);CUW.prototype.D=function(Z){return ZI(Z)?QDg(this,Z):mJ(Z)?Cf$(this,Z):pJ(Z)?X7g(this,Z):Promise.reject(Error("Unsupported action type: "+Z.actionType))};
var Prg=[10];g.U(S0V,bh);S0V.prototype.D=function(Z){return mJ(Z)?RkE(this,Z):Promise.reject(Error("Unsupported action type: "+Z.actionType))};g.U(C_$,WL);g.n=C_$.prototype;g.n.WH=function(Z){var I=WL.prototype.WH.call(this,Z);I.mainVideoEntity=new CUW(Z,this.U,this.L);I.mainPlaylistEntity=new E00(Z,this.U,this.L);I.mainDownloadsListEntity=new S0V(Z,this.U,this.L);return I};
g.n.refreshAllStaleEntities=function(Z,I){var d=this,Y,T,f,P,O,a,W,e,B,w,V;return g.h(function(N){switch(N.L){case 1:Y=[];if(!d.U.Y("web_player_offline_playlist_auto_refresh")){N.xS(2);break}return g.m(N,ge0(d,Z,I),3);case 3:Y=N.D;case 2:return g.m(N,eu.getInstance(),4);case 4:return T=N.D,g.m(N,(f=T)==null?void 0:f.get("sdois"),5);case 5:return P=N.D,g.m(N,(O=T)==null?void 0:O.get("lmqf"),6);case 6:a=N.D;if(!P){N.xS(7);break}e=Y;B=e.concat;return g.m(N,J_W(d,P,(W=a)!=null?W:"SD",Z===0),8);case 8:Y=
B.call(e,N.D);case 7:return w=Y,V=w.concat,g.m(N,WL.prototype.refreshAllStaleEntities.call(d,Z,I),9);case 9:return Y=V.call(w,N.D),N.return(Y)}})};
g.n.dk=function(Z){var I,d,Y,T,f,P,O,a;return g.h(function(W){if(W.L==1)return g.m(W,ju(),2);if(W.L!=3)return(I=W.D)?g.m(W,BL(I,g.zN,"mainDownloadsListEntity"),3):W.return(!1);d=W.D;if((Y=d)==null?0:(T=Y.downloads)==null?0:T.length)for(f=g.Es(Z,"mainVideoEntity"),P=g.t(d.downloads),O=P.next();!O.done;O=P.next())if(a=O.value,a.videoItem===f)return W.return(!0);return W.return(!1)})};
g.n.QG=function(){var Z=this,I,d,Y,T,f,P,O,a;return g.h(function(W){if(W.L==1)return g.m(W,ju(),2);if(W.L!=3)return(I=W.D)?g.m(W,Tp(I,"downloadStatusEntity"),3):W.return([]);d=W.D;Y=[];T=g.t(d);for(f=T.next();!f.done;f=T.next())P=f.value,P.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&P.key&&(O=g.VU(P.key).entityId,Y.push(O));return Y.length?(a={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},W.return(hc(Z,Y,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
a))):W.return([])})};
g.n.sJ=function(){var Z;return g.h(function(I){return I.L==1?g.m(I,ju(),2):(Z=I.D)?g.m(I,KT(Z,{mode:"readwrite",OU:!0},function(d){return ZP(d,"mainVideoEntity").then(function(Y){var T=[];Y=g.t(Y);for(var f=Y.next();!f.done;f=Y.next()){f=f.value;var P=void 0;(P=f.userState)!=null&&P.playbackPosition||(P=g.VU(f.key).entityId,P={key:g.Es(P,"videoPlaybackPositionEntity"),videoId:P,lastPlaybackPositionSeconds:"0"},T.push(oF(d,P,"videoPlaybackPositionEntity")),f.userState={playbackPosition:P.key},T.push(oF(d,
f,"mainVideoEntity")))}return g.WD.all(T)})}),0):I.return()})};
g.n.aP=function(){var Z,I,d,Y,T,f,P,O,a,W,e,B,w,V,N,q,A,F,J,v,l,X,H,x,Id,TB,dD,Qu,Zr,sJ,bL,TL,jt,yu,UJ,X0,Ag,vE;return g.h(function(oS){if(oS.L==1)return g.m(oS,ju(),2);if(oS.L!=3){Z=oS.D;if(!Z)return oS.return();I=g.Es("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.m(oS,KT(Z,{mode:"readonly",OU:!0},function(Ci){return g.WD.all([dT(Ci,I,"mainDownloadsListEntity"),dT(Ci,g.zN,"mainDownloadsListEntity"),ZP(Ci,"mainVideoEntity"),ZP(Ci,"mainPlaylistEntity")])}),3)}d=oS.D;
Y=g.t(d);T=Y.next().value;f=Y.next().value;P=Y.next().value;O=Y.next().value;a=T;W=f;e=P;B=O;w=new Set;if((V=a)==null?0:(N=V.downloads)==null?0:N.length)for(q=g.t(a.downloads),A=q.next();!A.done;A=q.next())F=A.value,J=void 0,(v=(J=F.videoItem)!=null?J:F.playlistItem)&&w.add(v);if((l=W)==null?0:(X=l.downloads)==null?0:X.length)for(H=g.t(W.downloads),x=H.next();!x.done;x=H.next())Id=x.value,Id.videoItem&&w.add(Id.videoItem);TB=new Set;dD=[];Qu=g.t(B);for(Zr=Qu.next();!Zr.done;Zr=Qu.next()){sJ=Zr.value;
if(sJ.videos)for(bL=g.t(sJ.videos),TL=bL.next();!TL.done;TL=bL.next())jt=TL.value,(yu=JSON.parse(g.VU(jt).entityId).videoId)&&TB.add(yu);sJ.key&&!w.has(sJ.key)&&dD.push(sJ.key)}UJ=g.t(e);for(X0=UJ.next();!X0.done;X0=UJ.next())Ag=X0.value,Ag.key&&!w.has(Ag.key)&&(vE=g.VU(Ag.key).entityId,TB.has(vE)||dD.push(Ag.key));return dD.length?g.m(oS,B5g(Z,dD),0):oS.xS(0)})};g.U(FUd,bh);FUd.prototype.D=function(Z){return ZI(Z)?P_g(this,Z):mJ(Z)?Gxi(this,Z):pJ(Z)?Bt3(this,Z):Promise.reject(Error("Unsupported action type: "+Z.actionType))};
var bH=[10];g.U(itp,bh);itp.prototype.D=function(Z){return ZI(Z)?RDd(this,Z):mJ(Z)?w6i(this,Z):pJ(Z)?LDE(this,Z):Promise.reject(Error("Unsupported action type: "+Z.actionType))};
var kd=[10];g.U(WUE,bh);WUE.prototype.D=function(Z){return ZI(Z)?fj0(this,Z):mJ(Z)?$Rg(this,Z):pJ(Z)?dVg(this,Z):Promise.reject(Error("Unsupported action type: "+Z.actionType))};
var igi=[10];g.U(cL,WL);cL.prototype.WH=function(Z){var I=WL.prototype.WH.call(this,Z);I.musicTrack=new WUE(Z,this.L);I.musicPlaylist=new itp(Z,this.L);I.musicAlbumRelease=new FUd(Z,this.L);return I};
cL.prototype.refreshAllStaleEntities=function(Z,I){var d=this,Y,T,f;return g.h(function(P){if(P.L==1)return g.m(P,yDi(d,Z,I),2);if(P.L!=3)return T=Y=P.D,f=T.concat,g.m(P,WL.prototype.refreshAllStaleEntities.call(d,Z,I),3);Y=f.call(T,P.D);return P.return(Y)})};g.U(vSi,g.NI);g.n=vSi.prototype;g.n.create=function(){var Z=this;g.z(this,this.events);if(g.qN(this.U))this.L=new C_$(this.U,this.player);else if(g.vl(this.U)||g.B8(this.U))this.L=new cL(this.U,this.player);this.events.W(this.player,"onPlaybackStartExternal",function(){Z.hf()});
this.events.W(this.player,"videodatachange",function(){Z.hf()});
this.U.Y("html5_offline_playback_position_sync")&&this.events.W(this.player,"presentingplayerstatechange",this.a8)};
g.n.bV=function(){return!1};
g.n.US=function(Z,I,d,Y){var T=this;return g.h(function(f){return T.L?f.return(hc(T.L,Z,I,d,Y)):f.return(Promise.reject())})};
g.n.deleteAll=function(){return this.L.deleteAll()};
g.n.f4=function(Z){return this.L.f4(Z)};
g.n.refreshAllStaleEntities=function(Z){return this.L.refreshAllStaleEntities(Z)};
g.n.setUpPositionSyncInterval=function(Z){this.L.setUpPositionSyncInterval(Z)};
g.n.yv=function(Z){this.L.yv(Z)};
g.n.Nd=function(Z){return this.L.Nd(Z)};
g.n.hf=function(){var Z=this,I;return g.h(function(d){I=Z.player.getVideoData();return g.aC(I)?lj0(I)&&Z.D!==I.clientPlaybackNonce?g.m(d,GY$(Z,I),0):d.xS(0):d.return()})};
g.n.a8=function(Z){var I=this,d,Y,T,f,P,O,a;return g.h(function(W){if(W.L==1)return d=I.player.getVideoData(),Y=d.Gv,g.Nw(Z,2)||g.Nw(Z,512)?g.m(W,ju(),2):W.return();if(W.L!=3){T=W.D;if(!T)return PL("PES is undefined"),W.return();f=d.videoId;return g.m(W,BL(T,g.Es(f,"mainVideoEntity"),"mainVideoEntity"),3)}P=W.D;if(!P)return W.return();O=Math.floor(Y).toString();a={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:O}};return g.m(W,I.US([f],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
a),0)})};
g.n.isOrchestrationLeader=function(){return this.L.isOrchestrationLeader()};
g.n.updateDownloadState=function(Z,I){var d,Y,T,f;return g.h(function(P){if(P.L==1)return g.m(P,ju(),2);d=P.D;if(!d)return PL("PES is undefined"),P.return();Y=g.VU(Z);T=Y.entityType;f=Y.entityId;return g.m(P,Jc(f,T,d,I,!0),0)})};g.cI("offline",vSi);})(_yt_player);
